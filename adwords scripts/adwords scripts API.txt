sources:
https://developers.google.com/adwords/scripts/docs/reference/adwordsapp/index
https://developers.google.com/adwords/scripts/docs/reference
https://developers.google.com/adwords/scripts/

======== GENERAL ======================================================================

METRICS
-------
* CPC 
  Cost per Click
  [Total Cost / Total Clicks]
  the cost of a single click

* CPM
  Cost per Thousand Impressions (aka: Cost per Mille)
  [Total Cost / number of Impressions] x 1000
  the cost of 1000 impressions

* CTR
  Click through rate
  [Total Clicks / Total Impressions]
  the clicking-on-ad rate. how often people who see your ad end-up clicking it.

* CPA
  Cost per Acquisition (aka: Cost per Conversion)
  [Total Cost / Total Conversions]
  the cost of a lead/sale

* CR
  Conversion Rate
  [Total Conversions / Total Clicks] x 100
  how often an ad click results in a desired action.

* ROI
  Return on Investment
  [(Revenue - Cost) / Investment Cost X 100(%)]
  how much benefit a business is getting from a specific ad campaign.

* TERMS:
  SKAG = Single Keyword Ad Groups
  SQR = Search Query Report
  ROAS - Return On Advertising Spend (ConversionValue/Cost)
         e.g: you invested 2000$ and earned 4000% - roas is 2 

NEW SCRIPT
----------
* (left pane)Bulk operations -> (Scripts tab)Create and manage scripts
* + Script 
  notice! each new script needed to be authorized to access  the current account

SAVED SCRIPTS
-------------
* (left pane)Bulk operations -> Scripts 

LIMITS
------
more info: 
https://developers.google.com/apps-script/guides/services/quotas?hl=en 

* max script execution time before canceled - 30 minutes
* max entities per single iterator - 50,000 entities

LOOP
----
* structure : 
  for(index in array) 
    // code here ...

* example:
  var arr = [ 17, 2, 56, 777, 83, 22, 801 ];
    for(i in arr)           
      Logger.log(arr[i]);

notice! the same with iterators

FOR Loop syntax
---------------
// additional way for using the FOR loops

var arr = ['A', 'B', 'C'];
for(i in arr) // index
    Logger.log('%s -> %s', i, arr[i]);

LOG
---
* Logger.log([message])
* parameters : 
  [message] string

* %s // placeholders
  Logger.log('%s,%s', account.getCustomerId(), accountName); // placeholder

* %% // percent symbol:
  var grade = 89;
  Logger.log('%s%%', grade); // 89%

JSON STRUCTURE 
--------------
[{ [name]:[value] },{ [name]:[value] }]

example:
[
	{ "Id": 1, "Name": "Roby", "age": 35 },
	{ "Id": 2, "Name": "Avi", "age": 33 },
	{ "Id": 3, "Name": "Shirly", "age": 36 },
	{ "Id": 4, "Name": "Mia", "age": 1 }
]

isPreview
---------
// indicates whether this execution is preview or not 
AdWordsApp.getExecutionInfo().isPreview()

dateFormat
----------
// use this method to format dates to the correct format needed for filtering ('DURING' clauses, forDateRange(), getStatsFor() etc.) 
function dateFormat(date){
  var year = date.getFullYear().toString();
  var month = (date.getMonth() + 1).toString();
  var day = date.getDate().toString();
  
  if(month.length == 1) month = '0' + month; // return yyyyMMdd
  if(day.length == 1) day = '0' + day;
  
  return year + month + day;
}

example:
var report = AdWordsApp.report(
   'SELECT Query,Clicks,Conversions,AverageCpc ' +
   'FROM SEARCH_QUERY_PERFORMANCE_REPORT ' +
   'WHERE Conversions > 0 ' + 
   'DURING 20130101,20140101');

example:
AdWordsApp.keywords().forDateRange('20130324', '20130326').get();

GetLastXDays
------------
// based on dateFormat
function GetLastXDays(days){
	var from = new Date();
	from.setDate(from.getDate() - days);
	return dateFormat(from) + ',' + dateFormat(new Date());
}

using:

var PERIOD = GetLastXDays(3); // LAST_30_DAYS, LAST_WEEK .... GetLastXDays(X)


account email 
-------------
--- NOT SUPPORTED !!! ---

// get active account details (name, email etc.)
var account = 
Logger.log(account.getName() + ' - ' + account.getLoginEmail());

======== CONSTS =======================================================================

DATE RANGE
----------
* TODAY
* YESTERDAY
* LAST_7_DAYS
* THIS_WEEK_SUN_TODAY
* LAST_WEEK
* LAST_14_DAYS
* LAST_30_DAYS
* LAST_BUSINESS_WEEK
* LAST_WEEK_SUN_SAT
* THIS_MONTH
* LAST_MONTH
* ALL_TIME

TODAY, YESTERDAY, LAST_7_DAYS, THIS_WEEK_SUN_TODAY, LAST_WEEK, LAST_14_DAYS, LAST_30_DAYS, LAST_BUSINESS_WEEK, LAST_WEEK_SUN_SAT, THIS_MONTH, LAST_MONTH, ALL_TIME

DIRECTION
---------
* DESC
* ASC

OPERATORS
---------
* <  
* <=  
* >  
* >=
* =  
* !=  
* STARTS_WITH  
* STARTS_WITH_IGNORE_CASE
* CONTAINS  
* CONTAINS_IGNORE_CASE
* DOES_NOT_CONTAIN
* DOES_NOT_CONTAIN_IGNORE_CASE
* IN[] (only on enums)
* NOT_IN[] (only on enums)

STATUS (enum)
-------------
* ENABLED
* PAUSED
* DELETED
* ACTIVE
* DISABLED

KEYWORD MATCH TYPE (enum)
-------------------------
* BROAD
* EXPANDED
* PHRASE
* NEAR_PHRASE
* EXACT
* NEAR_EXACT

APPROVAL STATUS (enum)
----------------------
* APPROVED
* DISAPPROVED
* FAMILY_SAFE
* NON_FAMILY_SAFE
* PORN
* UNCHECKED

AD TYPE (enum)
--------------
* EXPANDED_TEXT_AD (new)
* IMAGE_AD
* MOBILE_AD
* MOBILE_IMAGE_AD
* PRODUCT_AD
* RICH_MEDIA_AD
* TEMPLATE_AD
* TEXT_AD

XML CONTENT TYPE (enum)
-----------------------
* CDATA
* COMMENT
* DOCTYPE
* ELEMENT
* ENTITYREF
* PROCESSINGINSTRUCTION
* TEXT

CHART POINT STYLE (enum)
------------------------
* NONE
* TINY
* MEDIUM
* LARGE
* HUGE

CHART CURVE STYLE (enum)
------------------------
* NORMAL
* SMOOTH

CHART TYPE (enum)
-----------------
* AREA
* BAR
* COLUMN
* LINE
* PIE
* SCATTER
* TABLE

MIME TYPE (enum)
----------------
https://developers.google.com/apps-script/reference/base/mime-type#properties

GOOGLE_APPS_SCRIPT
GOOGLE_DRAWINGS
GOOGLE_DOCS
GOOGLE_FORMS
GOOGLE_SHEETS
GOOGLE_SLIDES
FOLDER
BMP
GIF
JPEG
PNG
SVG
PDF
CSS
CSV
HTML
JAVASCRIPT
PLAIN_TEXT
RTF
OPENDOCUMENT_GRAPHICS
OPENDOCUMENT_PRESENTATION
OPENDOCUMENT_SPREADSHEET
OPENDOCUMENT_TEXT
MICROSOFT_EXCEL
MICROSOFT_EXCEL_LEGACY
MICROSOFT_POWERPOINT
MICROSOFT_POWERPOINT_LEGACY
MICROSOFT_WORD
MICROSOFT_WORD_LEGACY
ZIP

PolicyApprovalStatus
--------------------
Ad Approval Status
https://developers.google.com/adwords/api/docs/reference/v201809/AdGroupAdService.PolicyApprovalStatus

Ad.getPolicyApprovalStatus();

UNKNOWN	
APPROVED	
APPROVED_LIMITED	
ELIGIBLE	
UNDER_REVIEW	
DISAPPROVED	
SITE_SUSPENDED

ServingStatus
-------------
campaign serving status:
AdWordsApp.campaigns().withCondition('ServingStatus = ENDED').get();

SERVING
NONE 
ENDED
PENDING
SUSPENDED

======== AdWordsApp ===================================================================

* adGroups(); 
* adParams();
* ads();
* budgets();
* campaigns();
* createLabel([name], [description], [backgroundColor]);
* currentAccount();
* extensions();
* getExecutionInfo();
* keywords();
* labels();
* report([query], [args]);
* targeting();

======== Account Details ==============================================================

var currentAccount = AdWordsApp.currentAccount();

Methods
-------
getCustomerId()
getCurrencyCode()
getTimeZone()
getName()
getStatsFor()
getLoginEmail()

======== Network Type =================================================================

1st level
---------
AdNetworkType1 // network type

types(enum):
[SEARCH] Search Network
[CONTENT] Display Network
[YOUTUBE_SEARCH] YouTube Search
[YOUTUBE_WATCH] YouTube Videos

2nd level
---------
AdNetworkType2 // network type (includes search partners)

types(enum):
[SEARCH] Google search
[CONTENT] Display Network
[SEARCH_PARTNERS]Search partners
[YOUTUBE_SEARCH] YouTube Search
[YOUTUBE_WATCH] YouTube Videos

USING
-----
var dataByNetwork = [];
dataByNetwork.push({ type: 'SEARCH', clicks: 0 });
dataByNetwork.push({ type: 'CONTENT', clicks: 0 });
dataByNetwork.push({ type: 'SEARCH_PARTNERS', clicks: 0 });
  
var report = AdWordsApp.report(
    'SELECT Cost, Impressions, Clicks, Date, AdNetworkType2 ' +
    'FROM   ACCOUNT_PERFORMANCE_REPORT ' +
    'WHERE  AdNetworkType2 IN [SEARCH, CONTENT, SEARCH_PARTNERS] ' +
    'DURING THIS_MONTH');
  
var rows = report.rows(); // get rows iterator 
while (rows.hasNext()) { // loop the rows to read data
	var row = rows.next();
    
	var networkType = row['AdNetworkType2'];
	var index = -1; 
	if(networkType == 'Google search')
		index = 0;
	else if(networkType == 'Display Network')
		index = 1;
	else if(networkType == 'Search partners')  
		index = 2;
    
	if(index == -1)
		Logger.log('UNKNOWN TYPE: %s', networkType);
	else
		dataByNetwork[index].clicks += parseInt(row['Clicks']);
}
  
for(var i=0;i<dataByNetwork.length;i++)
{
	var item = dataByNetwork[i];
	Logger.log('%s -> %s', item.type, item.clicks);
}

======== SHARED CODE ==================================================================
- we can use 'eval' to import js prior code from outer sources such as website, google drive... 
- note! the 'eval' command MUST locate within the execution function (for security porpuses)

var Import = {
  Init: function (namespace){
    var root = DriveApp.getRootFolder();
    return root.getFilesByName(namespace).next().getBlob().getDataAsString();
  },
  MyCodeA: function() { 
    /*
    // closure
    var serviceA = function(){
       var name = 'serviceA';
    
       return{
          funA: function(){ Logger.log('FUN A'); },
          funB: function(){ Logger.log(name); },
          funC: function(p1){ Logger.log(p1); }
       }	
    };
    */
    
    var sourceCode = this.Init('MyCodeA.code');
    return sourceCode;
  },
  MyCodeB: function() { 
    /*
    // object
    function ServiceB(){
       this.funA = function(){ Logger.log('FUN A'); },
       this.funB = function(){ Logger.log('FUN B'); },
       this.funC = function(p1){ Logger.log(p1); }
    }
    */
    
    var sourceCode = this.Init('MyCodeB.code');
    return sourceCode;
  }, 
  MyCodeC: function() { 
    /*
    // literal
    var serviceC = {
       funA: function(){ Logger.log('FUN A'); },
       funB: function(){ Logger.log('FUN B'); },
       funC: function(p1){ Logger.log(p1); }
    };
    */
    
    var sourceCode = this.Init('MyCodeC.code');
    return sourceCode;
  } 
};

function main() {  
  // eval MUST locate within the execution function
  
  var sourceCodeA = Import.MyCodeA();
  eval(sourceCodeA);   
  
  var aa = eval('serviceA()');  
  aa.funA(); 
  aa.funB();
  aa.funC('SERVICE A');
  
  // ----------------------------------
  
  var sourceCodeB = Import.MyCodeB();
  eval(sourceCodeB);   
  
  var bb = eval('new ServiceB()');  
  bb.funA(); 
  bb.funB();
  bb.funC('SERVICE B');
  
  // ----------------------------------
  
  var sourceCodeC = Import.MyCodeC();
  eval(sourceCodeC);   
  
  serviceC.funA(); 
  serviceC.funB();
  serviceC.funC('SERVICE C');
}


======== XML DOCUMENT =================================================================

XmlService
----------
* Cdata createCdata([value])  // create cdata node
  - [value] string 
 
* Comment createComment([value])  // create comment node
  - [value] string 

* DocType createDocType([name])  // create documentType node
  - [name] string 

* Document createDocument()  // create new xml document
* Document createDocument([element])  // create new xml document with root element node
  - [element] Element (see 'Element')

* Element createElement([name])  // create new element node
  - [name] string

* Element createElement([name], [namespace])  // create new element node with specific namespace
  - [name] string
  - [namespace] Namespace (see 'Namespace')

* TextNode createText([value])  //  create text element node
  - [value] string

* Namespace getNamespace([uri])  // create namespace 
  - [uri] string

* Namespace getNamespace([prefix], [uri])  // create namespace 
  - [prefix] string
  - [uri] string

* Namespace getNoNamespace()  // create namespace represents no namespace
* Namespace getXmlNamespace()  // create standard namespace 
* Format getCompactFormat()  // format xml - output xml for reading
* Format getPrettyFormat()  // format xml - output xml for reading (recommended)
* Format getRawFormat()  // format xml - output xml for reading
* Document parse([xml])  // string to xml document
  - [xml] string

Cdata
-----
* TextNode append(string)  // add text to node
* Content detach()  // detach from parent
* Element getParentElement()  // get parent element node
* string getText()  // get node text 
* string getValue()  // get all childern nodes text  
* TextNode setText(string)  // set node text

Comment
-------
* Content detach()  // detach from parent
* Element getParentElement()  // get parent element node
* string getText()  // get node text 
* string getValue()  // get all childern nodes text  
* TextNode setText(string)  // set node text

DocType
-------
* Content detach()  // detach from parent
* Element getParentElement()  // get parent element node
* string getValue()  // get all childern nodes text  
* string getElementName()  // get the name of the root Element node specified in the DocType declaration
* DocType setElementName(string)  //set the root element node to specify in the DocType declaration

Document
--------
* Document addContent([content]) // add content to the end of the document
  - [content] Content (see 'Content')
 
* Document addContent(index, [content])  // add content to specific index of the document
  - [content] Content (see 'Content')

* Content[] cloneContent()  // clone all children nodes
* Element detachRootElement()  // detach the root element and return it
* Content[] getAllContent()  // get all children nodes
* Content getContent(index)  // get specific content by index 
* int getContentSize()  // count nodes
* Content[] getDescendants()  // get all descendants 
* DocType getDocType()  // get the document type
* Element getRootElement()  // get the document root element
* bool hasRootElement()  // determines whether the document has root element
* Content[] removeContent()  // remove all children nodes 
* bool removeContent([content])  // remove given node from the document 
  - [content] Content (see 'Content')

* Content removeContent(index)  // remove specific content by index 
* Document setDocType([docType])  // set the document type 
  - [content] Content (see 'DocType')

* Document setRootElement([element])  // set the document root element
  - [content] Content (see 'Element')

Element
-------
* Element addContent([content])  // add content to the end of the document
  - [content] Content (see 'Content')

* Element addContent(index, [content])  // add content to specific index of the document 
  - [content] Content (see 'Content')

* Content[] cloneContent()  // clone all children nodes
* Content detach()  // detach the root element
* Content[] getAllContent()  // get all children nodes
* Attribute getAttribute([name])  // get specific element attribute
  - [name] string

* Attribute getAttribute([name], [namespace])  // get specific element attribute
  - [name] string
  - [namespace] Namespace (see 'Namespace')

* Attribute[] getAttributes()  // get all element attributes
* Element getChild([name])  // get the first child match the specified name 
  - [name] string

* string getChildText([name])  // get the text of the first child match the specified name 
  - [name] string

* Element[] getChildren()  // get all element childs nodes
* Element[] getChildren([name])  // get element childs nodes match the specified name
  - [name] string

* Content getContent(index)  // get specific content by index 
* int getContentSize()  // count nodes
* Content[] getDescendants()   // get all descendants 
* Document getDocument()  // get the document
* string getName()  // get the element name 
* Namespace getNamespace()  // get the element namespace 
* Element getParentElement()  // get parent element node
* string getText()  // get the element text
* string getValue()  / get all childern nodes text 
* bool isAncestorOf([other])  // determines whether the current element is ancestor of the other element
  - [other] Element

* bool isRootElement()  // determines whether the current element is the document root element
* bool removeAttribute([attribute])  // remove the given attribute
  - [attribute] Attribute (see 'Attribute')

* bool removeAttribute([attributeName])  // remove attribute by name 
  - [attributeName] string

* Content[] removeContent()  // remove all nodes 
* bool removeContent([content])  // remove the given node
  - [content] Content (see 'Content')

* Content removeContent(index)  // remove specific node by index
* Element setAttribute([attribute])  // set attribute 
  - [attribute] Attribute (see 'Attribute')

* Element setAttribute([name], [value])  // set attribute 
  - [name] string
  - [value] string 

* Element setName([name])  // set element name 
  - [name] string

* Element setNamespace([namespace])   // set element namespace
  - [namespace] Namespace (see 'Namespace')

* Element setText(string)  // set element text 

Attribute
---------
* string getName()  // get attribute name 
* Namespace getNamespace()   // get attribute namespace 
* string getValue()   // get attribute text 
* Attribute setName(name)   // set attribute name 
* Attribute setNamespace(namespace)  // set attribute namespace
* Attribute setValue(value)  // set attribute text 

TextNode
--------
* TextNode append(string)  // add text to node
* Content detach()  // detach from parent
* Element getParentElement()  // get parent element node
* string getText()  // get node text 
* string getValue()  // get all childern nodes text  
* TextNode setText(string)  // set node text

Namespace
---------
* string getPrefix()  // return the namespace prefix 
* string getURI()   // return the namespace uri 

Format
------
* string format([document])  // output the given document as formatted string
  - [document] Document (see 'Document')

* string format([element])  // output the given element as formatted string
  - [element] Element (see 'Element')

* Format setEncoding([encoding])  // set encoding 
  - [encoding] string

* Format setLineSeparator([separator])  // set the new row char
  - [separator] string (default: \r\n)

* Format setIndent([indent]) // set the spacer between each parent node to its childs
  - [indent] string (recommended: '  ')

* Format setOmitDeclaration([omitDeclaration])  // add/remove the document declaration 
  - [omitDeclaration] bool (true to remove, false to include)

Content
-------
notice! this interface can be implemented by the following xml entites : 
Cdata, Comment, DocType, Element, TextNode

* Cdata asCdata()  // cast as Cdata node 
* Comment asComment()  // cast as Cdata node 
* DocType asDocType()  // cast as DocType node 
* Element asElement()  // cast as Element node 
* TextNode asText()  // cast as Text node 
* Content detach()   // detach from parent
* Element getParentElement()  // get parent element 
* ContentType getType()  // get the document content type (see 'XML CONTENT TYPE (enum)')
* string getValue()  // get all childern nodes text 


Load XML file from URL
----------------------
var XML_URI = 'http://mobileshop.ae/liveupdate-cs.xml';

function main() { 
  var xml_service = new XMLService(XML_URI);
  ...
  ...
}

var XMLService = function(uri) { 
  var _document = null;
  
  var _init = function(){	
    var response = UrlFetchApp.fetch(uri);
    var status_code = response.getResponseCode();
    
    if(status_code != 200) // 200 = OK
    {
      Logger.log('status code %s', status_code);
      return;
    }
    
    _document =  XmlService.parse(response.getContentText());
   };
  
   _init();
  
   return { 
     document: function(){ return _document; }
   }; 
}

USING
-----

// create xml document from string and format it in several ways
var xml = '<root><a><b>Text!</b><b>More text!</b></a></root>'; 
var document = XmlService.parse(xml); 
var output1 = XmlService.getCompactFormat().format(document); 
var output2 = XmlService.getRawFormat().format(document); 
var output3 = XmlService.getPrettyFormat().format(document); 
var output4 = XmlService.getCompactFormat().setLineSeparator('\n').setEncoding('UTF-8').setIndent('     ').format(document); // explicit
  
Logger.log(output1);
Logger.log(output2);
Logger.log(output3);
Logger.log(output4);

- result -
<?xml version="1.0" encoding="UTF-8"?>
<root><a><b>Text!</b><b>More text!</b></a></root>

<?xml version="1.0" encoding="UTF-8"?>
<root><a><b>Text!</b><b>More text!</b></a></root>

<?xml version="1.0" encoding="UTF-8"?>
<root>
  <a>
    <b>Text!</b>
    <b>More text!</b>
  </a>
</root>

<?xml version="1.0" encoding="UTF-8"?>
<root>
     <a>
          <b>Text!</b>
          <b>More text!</b>
     </a>
</root>

--------------------

// create an xml document, read and write attributes from and to it
var xml = '<users>
			<user firstName="Roby" lastName="Cohen" />
            <user firstName="Avi" lastName="Cohen" />
			<user firstName="Shirly" lastName="Massa" />
		   </users>';

var document = XmlService.parse(xml);
var users = document.getRootElement().getChildren('user');
for (var i = 0; i < users.length; i++) {   
	var user = users[i];   
	var firstName = user.getAttribute('firstName').getValue();   
	var lastName = user.getAttribute('lastName').getValue();   
	user.setAttribute('fullName', firstName + ' ' + lastName); 
} 
 
var formatted_xml = XmlService.getPrettyFormat().format(document); 
Logger.log(formatted_xml);

- result --
<?xml version="1.0" encoding="UTF-8"?>
<users>
  <user firstName="Roby" lastName="Cohen" fullName="Roby Cohen" />
  <user firstName="Avi" lastName="Cohen" fullName="Avi Cohen" />
  <user firstName="Shirly" lastName="Massa" fullName="Shirly Massa" />
</users>

--------------------

// create xml document with cdata, text and elements
var cdata = XmlService.createCdata('<span style="font-weight:bold;color:red;">HELLO WORLD</span>'); 
var text = XmlService.createText('HELLO WORLD');
  
var root = XmlService.createElement('root');
var elem1 = XmlService.createElement('elem1').setText('HELLO WORLD');
var elem2 = XmlService.createElement('elem2').addContent(text);
var elem3 = XmlService.createElement('elem3').addContent(cdata);
  
root.addContent(elem1).addContent(elem2).addContent(elem3);
  
var document = XmlService.createDocument(root);
  
var formatted_xml = XmlService.getPrettyFormat().format(document); 
Logger.log(formatted_xml);

- result --
<?xml version="1.0" encoding="UTF-8"?>
<root>
  <elem1>HELLO WORLD</elem1>
  <elem2>HELLO WORLD</elem2>
  <elem3><![CDATA[<span style="font-weight:bold;color:red;">HELLO WORLD</span>]]></elem3>
</root>

--------------------

// add elements from array of data
var xml = '<root></root>'; 
var document = XmlService.parse(xml); 
  
var root = document.getRootElement();
  
var arr = [ 17, 2, 56, 777, 83, 22, 801 ];
root.setAttribute('total', arr.length);
for(i in arr)           
root.addContent(XmlService.createElement('value').setText(arr[i]));
  
var formatted_xml = XmlService.getPrettyFormat().format(document); 
Logger.log(formatted_xml);

- result --
<?xml version="1.0" encoding="UTF-8"?>
<root total="7">
  <value>17</value>
  <value>2</value>
  <value>56</value>
  <value>777</value>
  <value>83</value>
  <value>22</value>
  <value>801</value>
</root>

--------------------

// read from xml
_arr_jobs = [];
      
var root = _document.getRootElement();
var jobs_root = root.getChild('vacancies');

var jobs = xml_service.getElements('vacancy', jobs_root);
      
for (var i = 0; i < jobs.length; i++) {   
var job = jobs[i];   

_arr_jobs.push({
	id: job.getAttribute('id').getValue(),
    specialisme: job.getChild('Taxonomy').getChild('specialisme').getChildText('value'),
    location: job.getChild('Taxonomy').getChild('location').getChildText('value'),
    name: job.getChild('Position').getChildText('JobTitle'),
    link: job.getChild('Contact').getChildText('VacancyURL'),
    salaris: job.getChild('Taxonomy').getChild('salaris').getChildText('value')
});               
}

return _arr_jobs;     

======== Shared Library ==============================================================

NegativeKeywordLists
--------------------
* shared lists for negative keywords which can later apply on desired campaign/s
* Shared Library menu (left pane) -> Campign negative keywords
* to apply list to a campaign: 
  go to the campaign pane -> keywords (tab) -> negative keywords (sub tab) -> lists (tab) on the right pane -> use the + button

* example: // loading List keywords
  
  var listSource = 'List1';
  var negativeKeywordListSource = AdWordsApp.negativeKeywordLists().withCondition('Name = "' + listSource + '"').get().next();

  var arrKeywords = [];
  
  Logger.log('Loading "%s" keywords....', listSource);
  var keywords = negativeKeywordListSource.negativeKeywords().get();
  while(keywords.hasNext())
  {
    var keyword = keywords.next();
    var keywordText = keyword.getText();
    
    Logger.log('keyword: %s', keywordText);
    arrKeywords.push(keywordText);
  }   

* example: // create new List and add it to a campaign 
    
  var listDestination = 'List2';
  var negativeKeywordListDestinationIterator = AdWordsApp.negativeKeywordLists().withCondition('Name = "' + listDestination + '"').get();
  var negativeKeywordListDestination = null;

  // list was not found - create it now
  if(!negativeKeywordListDestinationIterator.hasNext()) 
  {
    Logger.log('Destination List "%s" is not exists - creating it.....', listDestination);
    var result = AdWordsApp.newNegativeKeywordListBuilder().withName(listDestination).build();
    if(!result.isSuccessful())
    {
      Logger.log('ERROR: %s', result.getErrors());
      return;
    }       
    
    negativeKeywordListDestination = result.getResult(); // get the new created list
    campaign.addNegativeKeywordList(negativeKeywordListDestination); // add the created list to the current campaign
    
    Logger.log('Done!');    
  }
  
excludedPlacementLists
----------------------

* shared lists for excluded placements which can later apply on desired campaigns
* Shared Library menu (left pane) -> Campaign placement exclusions

* example: // create blacklist

  var list = null;
  var listIterator = AdWordsApp.excludedPlacementLists()
  .withCondition('Name = "MyBlackList"')
  .get();
  
  if(listIterator.hasNext()) // list exists 
    list = listIterator.next();
  else // new 
    list = AdWordsApp.newExcludedPlacementListBuilder().withName("MyBlackList").build().getResult();
  
  var report = AdWordsApp.report(
    'SELECT Criteria, CampaignId, AdGroupId ' + 
    'FROM PLACEMENT_PERFORMANCE_REPORT ' + 
    'WHERE Criteria DOES_NOT_CONTAIN_IGNORE_CASE ".com" ' + 
    'AND IsNegative = false ' +
    'DURING YESTERDAY');
  
  var rows = report.rows();
  
  var campaignIds = [];

  while(rows.hasNext()) {
    var row = rows.next();
    
    var placement = row['Criteria'];
    var campaignId = row["CampaignId"];
   
    try{                
      list.addExcludedPlacement(placement);      

      if(campaignIds.indexOf(campaignId) == -1)        
        campaignIds.push(campaignId);
    }
    catch(e){
      Logger.log('EXCEPTION: ' + e.message);
    } 
  }
  
  for(var i=0;i<campaignIds.length;i++)
  {
    var campaign = AdWordsApp.campaigns().withIds([campaignIds[i]]).get().next();       

    var isListAttached = campaign.excludedPlacementLists().withCondition('Name = "'+ BLACK_LIST + '"').get().hasNext();
    if(isListAttached) continue;
    campaign.addExcludedPlacementList(list);
  }

Shared Budget
-------------
not supported, can only READ the campaigns associated with a shared budget but can NOT add campaigns to it!  

var budget = AdWordsApp.budgets().withCondition('BudgetName = "MyBudget1"').get().next();       
Logger.log('#%s SHARED: %s', budget.getId(), budget.isExplicitlyShared());

var campaigns = budget.campaigns() // get the shared budget campaigns

======== Match Types =================================================================

also see 'KEYWORD MATCH TYPE (enum)'



* NEAR_PHRASE

* NEAR_EXACT


* keywords support the following match types:
  1. BROAD (default)
     - widest audience, the least strict option.
	 - any word in your key phrase, in any order!
	 - including synonyms 
	 - e.g: 
	   keyword: luxury car 
	   ad display: fast car, luxury apartment, expensive vehicles etc.

  2. MODIFIED BROAD or EXPANDED
     - more restrictive than BROAD but less then PHRASE and EXACT
     - use a '+' sign. 
     - allows you to anchor/lock a keyword for better control of the BROAD match.	 
	 - an addition '+' sign in front of a term indicates that this work MUST be included.  
     - e.g: 
	   keyword: +luxury car
	   ad display: luxury car, luxury apartment, european luxury cruise etc.
	   luxury must be included within the search phrase! 

  3. PHRASE	
     - wrap the key phrase with "" sign. 
     - allows you to anchor/lock a key phrase which HAVE to be presented fully in the search but may include other content in front or at the end of it.	 
	 - the exact phrase, in the exact order but may include content!
     - e.g: 
	   keyword: "luxury car"
	   ad display: luxury car, common luxury car, luxury car for sale etc.
	   luxury car phrase must be fully included within the search phrase! 

  4. NEAR_PHRASE
     similar to PHRASE but also includes variations that share the same meaning. 

     - e.g: 
	   keyword: "yosemite camping"
	   ad display: yosemite campground

  5. EXACT
	 - most specific and restrictive option.
	 - wrap the key phrase with [] sign. 
	 - the exact phrase, in the exact order with no addition content!
	 - only searches using the EXACT defined keyword will trigger the ad!
     - e.g: 
	   keyword: [luxury car]
	   ad display: luxury car.	   
 
  6. NEAR_EXACT
     similar to EXACT but also includes variations that share the same meaning. 

     - e.g: 
	   keyword: [yosemite camping]
	   ad display: yosemite campground
note! 
use negative keywords to exclude keywords, excluded keywords will NEVER trigger the ad 


e.g:
BROAD: 'word'
PHRASE: '"word"'
EXACT: '[word]'   

======== DISPLAY =====================================================================

entities
--------
* use display to work with the following entities : 
  placements, display keywords, audiences and topics.
  can be reached from the root level, campaign or adgroup level

* structure:
  - AdWordsApp. display()
  - [campaign]. display()
  - [adgroup]. display()
 
* entities:
  - AdWordsApp.display().placements()  // AdWordsApp.Placement entity
  - AdWordsApp.display().excludedPlacements()  
  - AdWordsApp.display().keywords()
  - AdWordsApp.display().audiences()
  - AdWordsApp.display().topics()

* e.g: 
  // get root placements:
  var placements = AdWordsApp.display().placements().get();
  while (placements.hasNext()) {
	var placement = placements.next();
  }

builders
--------

* types:
  - var audienceBuilder = adGroup.display().newAudienceBuilder()
  - var keywordBuilder = adGroup.display().newKeywordBuilder()
  - var placementBuilder = adGroup.display().newPlacementBuilder()
  - var topicBuilder = adGroup.display().newTopicBuilder()

* actions:
  - build()
  - exclude()

* exclude placement:
  // source : https://developers.google.com/adwords/scripts/docs/reference/adwordsapp/adwordsapp_placementbuilder#exclude_0
  [adGroup].display().newPlacementBuilder().withUrl([placementUrl]).exclude();

* excluded placements:
  // get excluded placement for specific adgroup
  var excluded_placements = [adGroup].display().excludedPlacements().get();

* e.g: 
  //create placement from specific domain
  var adGroup = AdWordsApp.adGroups().get().next(); 
  var placementBuilder = adGroup.display().newPlacementBuilder().withUrl('http://www.site.com').build();

* e.g: 
  // exclude placement for specific adgroup
  var adGroup = AdWordsApp.adGroups().withIds([10365971711]).get().next(); 
  var result = adGroup.display().newPlacementBuilder().withUrl('http://www.site.com').exclude();

  var excluded_placements = adGroup.display().excludedPlacements().get();
  while (excluded_placements.hasNext()) {
    var placement = excluded_placements.next(); 
    Logger.log(placement.getUrl());
  } 

important! 
Google BUG : newPlacementBuilder exp do not save changes in preview mode!

USING
-----
// create an excluded placement for any non converting placement (in this exp: 1000 imp with no click)
var report = AdWordsApp.report(
    'SELECT Id, PlacementUrl, DisplayName, Clicks, Conversions, CampaignId, AdGroupId ' +
    'FROM PLACEMENT_PERFORMANCE_REPORT ' + 
    'WHERE Impressions > 1000 AND Clicks = 0 ' + 
    'DURING 20000101,' + dateFormat(new Date()));
  
  var rows = report.rows();
  
  while(rows.hasNext()) {
    var row = rows.next();
     
    var clicks = row['Clicks'];
    var conversions = row['Conversions'];  
    
    var placementUrl = row['PlacementUrl'];
    var displayName = row['DisplayName'];
    var adGroupId = row["AdGroupId"];
    
    try{      
      var adGroup = AdWordsApp.adGroups().withIds([adGroupId]).get().next();
      var result = adGroup.display().newPlacementBuilder().withUrl(placementUrl).exclude(); 
      Logger.log(adGroupId + '.' + adGroup.getName() + ' : ' + placementUrl + ' -> ' + result.isSuccessful());
    }
    catch(e){}
  }


======== SELECTORS & ITERATORS =======================================================

selector
--------
* notice! 
  services such as 'AdWordsApp' returns selectors
  we can filter those selectors using 'withCondition' clause
  in each condition we can use the columns below        
  e.g: var keywordSelector = AdWordsApp.keywords().withCondition("Impressions > 100");

* we can use multiple queries and not neccessarily at a single clause 
  each query will return a filtered selector while we don't use the get() method! 

* example:   
  // in this example we filter our keywords and then execute another filter on the previous filter  
  var keywords_filter1 = AdWordsApp.keywords().withCondition("ConversionRate > 0.1").forDateRange("ALL_TIME");
  var keywords_filter2 = keywords_filter1.withCondition("AveragePosition > 1.5").forDateRange("LAST_30_DAYS");
  ...
  ...

get
---
* get() // select - this will return an iterator object from the selector

* AdWordsApp.campaigns().get(); // return all campaigns
* AdWordsApp.adGroups().get(); // return all ad groups
* AdWordsApp.keywords().get(); // return all keywords
* AdWordsApp.ads().get(); // return all ads (also see ads) 

orderBy
-------
* orderBy([column + direction])
* parameters : 
  [column] string
  [direction] string (see 'DIRECTION')
* example :	AdWordsApp.keywords().orderBy("Impressions DESC").get() // order keywords by Impressions desc

forDateRange
------------
* forDateRange([range]) // get by date range 
* parameters :
  [range] string (see 'DATE RANGE')
* example : AdWordsApp.keywords().forDateRange("YESTERDAY").get() // all keywords from yesterday

* forDateRange([dateFrom], [dateTo]) // get by date range 
* parameters :
  [dateFrom] string (YYYYMMDD) 
  [dateTo] string (YYYYMMDD) 
* example : AdWordsApp.keywords().forDateRange('20130324', '20130326').get()
* notice! see 'dateFormat' custom function

withLimit
---------
* withLimit([number]) // top x clause
* parameters :
  [number] int (row count to fetch)
* example : AdWordsApp.keywords().withLimit(10).get() // top 10 keywords

withCondition
-------------
* withCondition([condition]) // where clause
* parameters :
  [condition] string (see 'OPERATORS')
* example : 
  AdWordsApp.keywords().withCondition("Clicks > 100").get() // all keywords with more than 100 clicks
  AdWordsApp.adGroups().withCondition("Name STARTS_WITH 'forex'").get() // all adGroups starts with 'forex' prefix
  AdWordsApp.keywords().withCondition("Text CONTAINS_IGNORE_CASE 'forex'").get() // all keywords contains 'forex' phrase
  AdWordsApp.campaigns().withCondition("Status = ENABLED"); // all enabled campaigns
  AdWordsApp.ads().withCondition("Type IN [TEXT_AD, MOBILE_AD]"); // all text and mobile ads 

withIds
-------
* withIds([ids]) // where id in ( ... )
* parameters :
  [ids] int[]
* example : 
  AdWordsApp.campaigns().withIds([123123, 234234, 345345]).get() // campaigns with ids 123123, 234234 or 345345
* extra : we can generate an ids array dynamically (see 'EXAMPLES')           
* keywords: the keywords entity consists of AdGroupId + keywordId

hasNext and next
----------------
* hasNext() // has next item 
* next() // next item 

* example : // foreach keyword
  var keywords = AdWordsApp.keywords().get() // return iterator
  while (keywords.hasNext()) { 
	 var keyword = keywords.next();
	 /// code ... 
  } 

* example 
  var ids = [];
  var rows = report.rows(); 
  while (rows.hasNext()) { 
	var row = rows.next();
	ids.push([row["AdGroupId"], row["Id"]]);    	
  }   
  var keywords = AdWordsApp.keywords().withIds(ids);

======== SELECTORS COLUMNS ===========================================================

AdGroup
-------
* AverageCpc double
* AverageCpm double
* AveragePageviews double
* AveragePosition double
* AverageTimeOnSite double
* BounceRate double
* Clicks long
* ConversionRate double
* Conversions long 
* Cost double
* Ctr double
* Impressions long 
* Status enum (see 'STATUS (enum)')
* Name string 
* CampaignName string 
* KeywordMaxCpc double
* CampaignStatus enum (see 'STATUS (enum)')
* LabelNames string[]

Ad
--
* AverageCpc double
* AverageCpm double
* AveragePageviews double
* AveragePosition double
* AverageTimeOnSite double
* BounceRate double
* Clicks long
* ConversionRate double
* Conversions long 
* Cost double
* Ctr double
* Impressions long
* Status enum (see 'STATUS (enum)')
* ApprovalStatus enum (see 'APPROVAL STATUS (enum)')
* Type enum (see 'AD TYPE (enum)')
* Headline string
* Description1 string
* Description2 string
* DisplayUrl string
* DestinationUrl string
* AdGroupName string
* AdGroupStatus enum (see 'STATUS (enum)')
* CampaignName string
* CampaignStatus enum (see 'STATUS (enum)')
* LabelNames string[]

ExpandedTextAd
--------------
replace the 'Text' Ad Entity (Deprecated since October 26, 2016)

Budget
------
* AverageCpc double
* AverageCpm double
* AveragePageviews double
* AveragePosition double
* AverageTimeOnSite double
* BounceRate double
* Clicks long 
* ConversionRate double
* Conversions long 
* Cost double
* Ctr double
* Impressions long 
* Name string 
* Amount double
* IsBudgetExplicitlyShared bool 
* ReferenceCount int

Campaign
--------
* AverageCpc double
* AverageCpm double
* AveragePageviews double
* AveragePosition double
* AverageTimeOnSite double
* BounceRate double
* Clicks long
* ConversionRate double
* Conversions long
* Cost double
* Ctr double
* Impressions long
* Status enum (see 'STATUS (enum)')
* Name string 
* Budget double
* LabelNames string[] 

Keyword
-------
* AverageCpc double
* AverageCpm double
* AveragePageviews double
* AveragePosition double
* AverageTimeOnSite double
* BounceRate double
* Clicks long
* ConversionRate double
* Conversions long
* Cost double 
* Ctr double
* Impressions long
* Status enum (see 'STATUS (enum)')
* Text string
* KeywordMatchType enum (see 'KEYWORD MATCH TYPE (enum)')
* MaxCpc double 
* DestinationUrl string
* QualityScore int 
* FirstPageCpc double
* TopOfPageCpc double
* AdGroupName string
* AdGroupStatus enum (see 'STATUS (enum)')
* CampaignName string
* CampaignStatus enum (see 'STATUS (enum)')
* LabelNames string[]

Label
-----
* Name string
* CampaignsCount long
* AdGroupsCount long
* AdsCount long
* KeywordsCount long

======== UTILITIES ===================================================================

formatDate
----------
var temp = new Date();
temp.setDate(temp.getDate() - 1);
  
var timeZone = AdWordsApp.currentAccount().getTimeZone();
  
var today = Utilities.formatDate(new Date(), timeZone, "MMM dd yyyy");
var yesterday = Utilities.formatDate(temp, timeZone, "MM/dd");

Encode/Decode
-------------
* base64Decode([encoded]);
  parameters : 
  - [encoded] byte[] // encoded value (use Utilities.newBlob(decoded).getDataAsString()) to convert as string)

* base64Decode([encoded], [charset]);
  parameters : 
  - [encoded] byte[] // encoded value (use Utilities.newBlob(decoded).getDataAsString()) to convert as string)
  - [charset] Charset (see 'Charset')
   
* base64Encode([data]);
  parameters : 
  - [data] string // value to encode

* base64Encode([data], [charset]);
  parameters : 
  - [data] string // value to encode
  - [charset] Charset (see 'Charset')

Blob
----
* Blob newBlob([data]);
  parameters : 
  - [data] string // the blob value	

* Blob newBlob([data], [contentType]);
  parameters : 
  - [data] string // the blob value	
  - [contentType] string // the content type of the blob 

* Blob newBlob([data], [contentType], [name]);
  parameters : 
  - [data] string // the blob value	
  - [contentType] string // the content type of the blob 
  - [name] string // the blob name

Charset
-------
enum - use Utilities.Charset.UTF_8

* US_ASCII 
* UTF_8 

Zip
---
* Blob[] unzip([blob]);
  parameters : 
  - [blob] BlobSource (see 'BlobSource') // blob zip file 

* Blob zip([blob_sources]);
  parameters : 
  - [blob_sources] BlobSource[] (see 'BlobSource') // array of BlobSource to zip

* Blob zip([blob_sources], [name]);
  parameters : 
  - [blob_sources] BlobSource[] (see 'BlobSource') // array of BlobSource to zip
  - [name] string // the zip file name to create

Helper
------
* formatDate([date], [timeZone], [format]);
  parameters : 
  - [date] Date // the date to format -> new Date()
  - [timeZone] string // the result timezone 
  - [format] string // date format ('yyyy-MM-dd HH:mm:ss' etc.)

* formatString([template], [args]);
  parameters : 
  - [template] string // string format (use % as place holders)
  - [args] params object[] // the place holders replacements  

* parseCsv([csv]);
  parameters : 
  - [csv] string // csv value separated by comma char

* parseCsv([csv], [delimiter]);
  parameters : 
  - [csv] string // csv value separated by comma char
  - [delimiter] char // the seperator char (default : ',')

* sleep([milliseconds]);
  parameters : 
  - [milliseconds] int // time to sleep in milliseconds (1000 per 1 second)

* object jsonParse(string) // parse string as json object
  - json structure: (see 'JSON STRUCTURE')
    

USING
-----

// format date
var dt = new Date();
var sDate1 = Utilities.formatDate(dt, 'GMT', 'yy-MM-dd HH:mm:ss'); // 14-02-16 07:02:28
var sDate2 = Utilities.formatDate(dt, 'GMT', 'dd/MM/yyyy'); // 16/02/2014
var sDate3 = Utilities.formatDate(dt, 'GMT', 'HH:mm'); // 07:02

--------------------

// encode and decode values
var encoded = Utilities.base64Encode('Hello World'); 
Logger.log(encoded);
  
var decoded = Utilities.base64Decode(encoded); 
Logger.log(Utilities.newBlob(decoded).getDataAsString());

--------------------

// format string 
Utilities.formatString('%6s', 'abc'); // "   abc"

--------------------

// convert string to csv 
var csvString = "a,b,c\nd,e,f\ng,h,i";

var data = Utilities.parseCsv(csvString);
for (var i in data)
   Logger.log(data[i]); 

var blob = Utilities.newBlob(csvString, 'text/csv')
blob.setName('Report.csv');
MailApp.sendEmail('roby@sarltd.com', 'HELLO FROM ADWORDS SCRIPTS', 'ATTACHED CSV FILE', {attachments: [blob]});

--------------------

var csvString = "a|b|c\nd|e|f\ng|h|i";
var data = Utilities.parseCsv(csvString, '|'); // print [a, b, c], [d, e, f]

for (var i in data)
   Logger.log(data[i][1]); // print 'b', 'e', 'h'

--------------------

// create blobs from images 
var image1 = UrlFetchApp.fetch('http://www.myDomain.com/images/image1.jpg').getBlob();
var image2 = UrlFetchApp.fetch('http://www.myDomain.com/images/image2.jpg').getBlob();

// zip images to file 
var zip = Utilities.zip([image1, image2], "myimages.zip");

// unzip images file
var files = Utilities.unzip(zip);

--------------------

// working with json
var str_json = '[' +
		'{ "Id": 1, "Name": "Roby", "age": 35 },' +
		'{ "Id": 2, "Name": "Avi", "age": 33 },' +
		'{ "Id": 3, "Name": "Shirly", "age": 36 },' +
		'{ "Id": 4, "Name": "Mia", "age": 1 }' +
	']'; 

var users  = Utilities.jsonParse(str_json);

for(i in users)           
	Logger.log(users[i].Name);
  

======== DriveApp ====================================================================

Google Drive for account files storage
allow you to add, update, find and manage files ...

Methods
-------
Folder addFile([file])
Folder addFolder([folder])
File createFile(blob)
File createFile([name], [content])
File createFile([name], [content], [mimeType])
Folder createFolder([name])
File getFileById([id])
File[] getFiles()
File[] getFilesByName([name])
File[] getFilesByType([mimeType])
Folder getFolderById([id])
Folder[] getFolders()
Folder[] getFoldersByName([name])
Folder getRootFolder()
int getStorageLimit()
int getStorageUsed()
File[] getTrashedFiles()
Folder[] getTrashedFolders()
Folder removeFile([file])
Folder removeFolder([folder])
File[] searchFiles([params])
Folder[] searchFolders([params])

Folder & File
-------------
DriveApp.getRootFolder(); // returns the root folder
DriveApp.getFoldersByName([folderName]); // return all folders with [folderName] name located within the root folder
[folder].getFoldersByName([folderName]); // return all folders with [folderName] name located within the [folder]
[folder].getFilesByName([fileName]); // return all files with [fileName] name located within the [folder]
[folder].addFile([file]); // add file to folder
[folder].removeFile([file]); // remove file from folder

USING
-----
var FILE_NAME = 'myFile1';

var test_file = null;
var test_files_iterator = DriveApp.getFilesByName(FILE_NAME);

if(test_files_iterator.hasNext()) // file exists - get the first one
	test_file = test_files_iterator.next();
else  // no file in google drive - create it!
	test_file = DriveApp.createFile(FILE_NAME, 'HELLO FROM GOOGLE DRIVE'); 
  
Logger.log('Id = ' + test_file.getId() + '\nContent = ' + test_file.getBlob().getDataAsString());

------------------------------------------------
// reset file
var FILE_NAME = 'SCRIPT_NEW_CONVERSION_DATA';

var file_to_reset = DriveApp.getFilesByName(FILE_NAME).next();
file_to_reset.setContent(' ');
DriveApp.removeFile(file_to_reset);

------------------------------------------------

// move file 'blabla' from root to 'TEST' folder
var root_folder = DriveApp.getRootFolder();
var folder = root_folder.getFoldersByName('TEST').next();

var file = root_folder.getFilesByName('blabla').next();
folder.addFile(file);

root_folder.removeFile(file);

------------------------------------------------

var FILE_NAME = 'SCRIPT_NEW_CONVERSION_DATA';

var data_file = null;
var temp = DriveApp.getFilesByName(FILE_NAME);
var fileExists = temp.hasNext();

// first execution - create file at google drive
if(!fileExists) {
	data_file = DriveApp.createFile(FILE_NAME, ' .... ');
	return;
}

// file exists - read content
data_file = temp.next();
var content = data_file.getBlob().getDataAsString();

// code ...

// update file
data_file.setContent(content); 



more info:
https://developers.google.com/apps-script/reference/drive/drive-app

======== MAIL ========================================================================

EMAIL OPTIONS
-------------
* attachments  // array of blob source to attach ('see blob')
* bcc  // a comma-separated email addresses to BCC
* cc  // a comma-separated email addresses to CC
* htmlBody  // html with place holders for inlineImages
* inlineImages  // mapping from image key (cid) to attached image
* name  // sender name
* noReply // true/false
* replyTo  // email address to reply to
* subject // email subject


SIMPLE
------
* MailApp.sendEmail([to], [subject], [body])
* parameters : 
  [to] string
  [subject] string
  [body] string
* example : MailApp.sendEmail('roby@sarltd.com', 'HELLO FROM ADWORDS SCRIPTS', 'TEXT TEXT TEXT TEXT')

HTML BODY
---------

var body = '<p>Daily Report Attached!</p><p>for the full report <a href="' + spreadsheetURL + '">click here</a></p>'
MailApp.sendEmail(account_email, 'Account Statistics Report', '', {
        attachments: [reportPDF], 
        htmlBody: body
});

HTML/PDF ATTACHMENT
-------------------
* MailApp.sendEmail([to], [subject], [body], [options])
* parameters : 
  [to] string
  [subject] string
  [body] string
  [options] json (see 'EMAIL OPTIONS')
* example : 
  var html = "<h1>Report Header</h1>" + 
			 "<p>this report created via adsense script</p>" +
             "<p>" + new Date() + "</p>"+  
             "<p>word A : 300 clicks</p>"+  
             "<p>word B : 263 clicks</p>"+  
             "<p>word C : 109 clicks</p>"+  
			 "<p>END OF THE REPORT</p>";

  var blob = Utilities.newBlob(html, MimeType.HTML);
  MailApp.sendEmail('roby@sarltd.com', 'HELLO FROM ADWORDS SCRIPTS', 'ATTACHED HTML FILE', {attachments: [blob]});
 
* notice!
  to convert the HTML file to PDF file use 'getAs([mimeType])' method
  e.g: var pdfBlob = blob.getAs(MimeType.PDF);

* convert html content into pdf blob method

  HTML2PDF: function(strHtml, pdfName){
    var blob = Utilities.newBlob(strHtml, MimeType.HTML);
    var pdf = blob.getAs(MimeType.PDF);  
    pdf.setName(pdfName);
    return pdf
  }

ADVANCED
--------
* MailApp.sendEmail([message])
* parameters : 
  [message] object (see 'EMAIL OPTIONS')
* example : 
  var logo_url = "http://www.mydomain.com/images/logo.png";
  var blob = UrlFetchApp.fetch(logo_url).getBlob().setName("logo");

  MailApp.sendEmail({
	 to:'roby@sarltd.com',
	 subject: 'HELLO FROM ADWORDS SCRIPTS',
	 htmlBody: 'inline  image example<br /><img src='cid:myImagePH'>',
	 inlineImages:{
		myImagePH: blob
	 }
  })

* notice!
  use UrlFetchApp to create blob from image url 
  e.g: var logo_url = "http://www.mydomain.com/images/logo.png";
       var blob = UrlFetchApp.fetch(logo_url).getBlob().setName("logo");

REPORT ATTACHMENT
-----------------
* structure :
  var spreadsheet = SpreadsheetApp.create([name]); // create new spreadsheet
  var sheet = spreadsheet.getActiveSheet(); // get active sheet
  var report = AdWordsApp.report([query]); // execute report
  report.exportToSheet(sheet); // fill sheet with the report data
	
  // find sheet data boundaries
  var last_row = sheet.getLastRow(); // last row index
  var last_column = sheet.getLastColumn(); // last column index

  // convert sheet data to pure html content
  var HTML = ....

  // create html blob based on the html data we created above 
  var blob = Utilities.newBlob(HTML, MimeType.HTML);

  // convert html 2 pdf
  var pdfBlob = blob.getAs(MimeType.PDF);
  pdfBlob.setName([fileName]);

  // send pdf created report!
  MailApp.sendEmail([to], [subject], [body], {attachments: [pdfBlob]});

* example :
  var spreadsheet = SpreadsheetApp.create("My Report"); // create new spreadsheet
  var sheet = spreadsheet.getActiveSheet(); // get active sheet
  var report = AdWordsApp.report("SELECT AdGroupId, Impressions, Cost FROM SEARCH_QUERY_PERFORMANCE_REPORT DURING LAST_30_DAYS"); // execute report
  report.exportToSheet(sheet); // fill sheet with the report data

  var last_row = sheet.getLastRow();
  var last_column = sheet.getLastColumn();
      
  var range = sheet.getRange(1, 1, last_row, last_column); // all data 
  var values = range.getValues();
 
  var HTML = '<table cellpadding="4" cellspacing="4">';
  for(r in values)
  {
    HTML += '<tr>';  
    for(c in values[r])
      HTML += '<td>' + values[r][c] + '</td>';
    HTML += '</tr>';    
  }
  HTML += '</table>';   
  
  var blob = Utilities.newBlob(HTML, MimeType.HTML);
  var pdfBlob = blob.getAs(MimeType.PDF);
  pdfBlob.setName('Report.pdf');
  MailApp.sendEmail('rcbuilder@walla.com', 'HELLO FROM ADWORDS SCRIPTS', 'ATTACHED REPORT FILE', {attachments: [pdfBlob]});

CHART ATTACHMENT
----------------
* structure :
  var data = ...
  var chart = Charts.newAreaChart().setDataTable(data).build();
  MailApp.sendEmail([to], [subject], [body], {attachments: chart.getBlob()});

* example :
  var data = Charts.newDataTable()
  .addColumn(Charts.ColumnType.STRING, 'Name')
  .addColumn(Charts.ColumnType.NUMBER, 'Views')
  .addColumn(Charts.ColumnType.NUMBER, 'Clicks')           
  .addRow(['campaign1', 320, 97])      
  .addRow(['campaign2', 601, 58])      
  .addRow(['campaign3', 150, 45])    
  .addRow(['campaign4', 202, 15])    
  .addRow(['campaign5', 69, 2])    
  .addRow(['campaign6', 566, 104])    
  .addRow(['campaign7', 178, 19])    
  .addRow(['campaign8', 9, 0])    
  .build();  
  
  var chart = Charts.newAreaChart()      
  .setDataTable(data)      
  .setStacked()      
  .setRange(0, 1000)   
  .setDimensions(1000, 400)
  .setTitle('Campaigns')      
  .build();  
  
  var blob = chart.getBlob();
  MailApp.sendEmail('rcbuilder@walla.com', 'HELLO FROM ADWORDS SCRIPTS', 'ATTACHED CHART FILE', {attachments: [blob]});

inlineImages Example
--------------------
see 'ADVANCED' example

CSV ATTACHMENT
--------------
* structure :
	var csvString = "..."; // use ',' for columns and '\n' for rows
	var blob = Utilities.newBlob(csvString, 'text/csv')
	blob.setName([FileName]);
	MailApp.sendEmail([to], [subject], [body], {attachments:[blob]});

* example :
	var csvString = "a,b,c\nd,e,f\ng,h,i";
	var blob = Utilities.newBlob(csvString, 'text/csv')
	blob.setName('Report.csv');
	MailApp.sendEmail('roby@sarltd.com', 'HELLO FROM ADWORDS SCRIPTS', 'ATTACHED HTML FILE', {attachments: [blob]});


======== TERMS =======================================================================
//TODO

* cpa - Cost per acquisition (acquisition = purchase)
* Cpc - cost per click
* Cpm - cost per thousand impressions
* Ctr - click through rate (clicks / impressions)
* conversion rate - conversions / clicks
* ROI - return of investment
* converisionvalue - the amount in $ etc (e.g: you spend $5 to get a $20 sale, so the conversion value is $20 and the CPA is $5)
* AWQL - AdWords Query Language (SQL-like language for performing queries against most common AdWords API services)
* DKI - dynamic keywords insertion // inject a dynamic kw into your ad (search phrase etc.)

======== REGEX =======================================================================

* structure:
  var input = UrlFetchApp.fetch(server).getContentText();
  var pattern = '...';
  var regex = new RegExp(pattern, flags); 
  var match = regex.exec(input); 

* example:
  // p1000
  var input = UrlFetchApp.fetch(server).getContentText();
  var pattern = 'itemprop="price">([.,0-9]{1,})</em>';
  var regex = new RegExp(pattern, 'gi'); // i = ignore case,  g = global
  var match = regex.exec(input); 
  Logger.log(match[1]);

* example:
  // fattal
  var input = UrlFetchApp.fetch(server).getContentText();
  var pattern = '<div\\s+class="moredetails">\\s+'+
                  '<a\\s+href="http://www.fattal.co.il/([a-zA-Z\-]+)">[\\s\\w]+</a>\\s+'+
                  '</div>\\s+'+
                  '<input\\s+type="hidden"\\s+class="sort-values"\\s+data-lowestprice="(\\d+)"\\s+data-abc=".+"\\s+data-avrate="[0-9\.]+"\\s+value="\\d+"\\s*/>\\s+'+
                  '<input\\s+type="hidden"\\s+class="filter-values"\\s+data-lowestprice="[0-9\.]+"\\s+data-highestprice="[0-9\.]+"\\s+data-resort="[0-9_]+"\\s+data-brand="\\d+"\\s+data-region="(\\d+)"';
      
  var regex = new RegExp(pattern, 'gi'); // flags: i = ignore case, g = global
  var match;
  while(match = regex.exec(input))
  	hotels.push({ name: match[1], price: match[2], region: match[3] });    
  Logger.log('%s hotels were loaded!', hotels.length);

* example:
  /*
    <h1 class="product-name">
    <a href="http://www.karaoke4free.com/singers/someSinger" title="">bla bla</a>&nbsp;|&nbsp;someSong				
    </h1>    
  */   

  var input = UrlFetchApp.fetch(server).getContentText();    
  var pattern = '<h1\\s+class="product-name">\\s*<a .*?>(.*?)</a>&nbsp;\\|&nbsp;(.*?)\\s*</h1>';    
  var regex = new RegExp(pattern, 'i'); // i = ignoreCase
  var matchA = regex.exec(input);
  Logger.log('%s %s', matchA[1], matchA[2]);

  --

  /*
	<p itemprop="price" content="48">48 </p>
    <p itemprop="price" content="32">32 </p>
  */

  var input = UrlFetchApp.fetch(server).getContentText();    
  var pattern = '<p\\s+itemprop="price"\\s+content="(\\d+)">.*?</p>';      
  var regex = new RegExp(pattern, 'gim'); // m = multilines, g = global

  var prices = [];        
  while ((match = regex.exec(input)) != null) {
    prices.push(match[1]);
  }
  Logger.log('%s', prices);  

  var price = 0;
  if(prices.length > 0){
    prices.sort(); // sort the array by price
    price = prices[0]; // take the lower price
  }

======== ENTITIES ====================================================================
* moreinfo : https://developers.google.com/adwords/scripts/docs/features/entities

ENTITIES
--------
* campaigns
* keywords
* adGroups // groups of ads
* sitelinks // extra links apprear below the ads (in addition to the display url) 

BASIC METHODS
-------------
var campaign = ....
* campaign.adGroups().get(); // return all ad groups belonging to the campaign
* campaign.keywords().get(); // return all keywords belonging to the campaign
* campaign.ads().get(); // return all ads belonging to the campaign
* campaign.enable(); // enable the campaign
* campaign.pause(); // pause the campaign
* campaign.setBudget([amount]); // set budget to campaign

var keyword = ...
* keyword.getAdGroup(); // return the keyword ad group
* keyword.getCampaign(); // return the keyword campaign
* keyword.enable(); // enable the keyword
* keyword.pause(); // pause the keyword
* keyword.setMaxCpc([amount]); // set keyword maximum CPC
* keyword.setDestinationUrl([url]); // set keyword destination URL
* keyword.getText(); // get keyword name

var adGroup = ...
* adGroup.enable(); // enable the adGroup
* adGroup.pause(); // pause the adGroup
* adGroup.setKeywordMaxCpc([amount]); //set adGroup maximum CPC
* adGroup.createKeyword([keyword], [bid (optional)], [url (optional)]); // create new keyword to adGroup [deprecated, use createKeyword function instead]

Account
-------
* string getCurrencyCode(); 
* string getCustomerId();
* string getLoginEmail();
* string getName();

Extensions
----------
* mobileApps(); // all mobile apps in the account
* phoneNumbers(); // all phone numbers in the account
* callouts
* mobileApps
* phoneNumbers
* reviews
* sitelinks

======== Extensions  =================================================================
- AdWordsApp.Extensions
- types:
  callouts
  mobileApps
  phoneNumbers
  reviews
  sitelinks

- builders:
  newCalloutBuilder
  newMobileAppBuilder
  newPhoneNumberBuilder
  newReviewBuilder
  newSitelinkBuilder

- example:  
  var apps = AdWordsApp.extensions().mobileApps().get();
    while(apps.hasNext()) { 
      var app = apps.next();
      Logger.log('%s', app.getId());
    }

  // campaign level 
  var campaign_apps = campaign.extensions().mobileApps().get();
  ...


---
Phone calls 
https://developers.google.com/adwords/scripts/docs/reference/adwordsapp/adwordsapp_phonenumber

- example:

  var phoneNumbers = AdWordsApp.extensions()
     .phoneNumbers()
     .withCondition("Impressions > 100")
     .forDateRange("ALL_TIME")
     .orderBy("Clicks DESC")
     .get();
  
  while (phoneNumbers.hasNext()) {
    var phoneNumber = phoneNumbers.next();
    Logger.log(phoneNumber.getPhoneNumber());
  }

======== Ads =========================================================================

- also see 'AD MANAGER SERVICE'

- with params:
  {param<num>:<default value>}

  e.g:
  product {param1: 'some product'} for only {param2: 0} $ - buy now!

- types:
  EXPANDED_TEXT_AD, 
  GMAIL_IMAGE_AD, 
  GMAIL_SINGLE_PROMOTION_AD, 
  GMAIL_MULTI_PRODUCT_AD, 
  HTML5_AD, 
  IMAGE_AD, 
  MOBILE_AD, 
  MOBILE_IMAGE_AD, 
  PRODUCT_AD, 
  RESPONSIVE_DISPLAY_AD, 
  RICH_MEDIA_AD, 
  TEMPLATE_AD, 
  TEXT_AD

- create expandedText ad:
var operation = adGroup.newAd().expandedTextAdBuilder()
      .withHeadlinePart1(header1) // 30 characters      
      .withHeadlinePart2(header2) // 30 characters
      .withDescription(description) // 80 characters      
      .withFinalUrl(destinationURL) // 255 characters    
      .withMobileFinalUrl(destinationURL).build();

- read expandedText ads:
var ads = campaign.ads().get();
while(ads.hasNext())
{
	var adBase = ads.next();
	var textAd = adBase.asType().expandedTextAd(); 
	Logger.log(textAd.getHeadlinePart1());
}

-------------------------

[Deprecated]

types:
- ImageAd
  https://developers.google.com/adwords/scripts/docs/reference/adwordsapp/adwordsapp_imagead

- ResponsiveDisplayAd
  https://developers.google.com/adwords/scripts/docs/reference/adwordsapp/adwordsapp_responsivedisplayad

- Html5Ad
  https://developers.google.com/adwords/scripts/docs/reference/adwordsapp/adwordsapp_html5ad

---

ImageBuilder:
- use the ImageBuilder service to upload images to ads

---

creating adMedia:
- e.g: 
 
// [from URL] create adMedia
var imageUrl = "http://www.example.com/example.png";
var imageBlob = UrlFetchApp.fetch(imageUrl).getBlob();
var mediaOperation = AdWordsApp.adMedia().newImageBuilder()
    .withName("IMAGE_NAME")
    .withData(imageBlob)
    .build();

// [from google DRIVE] create adMedia
var imageFileId = "IMAGE_FILE_ID";
var imageBlob = DriveApp.getFileById(imageFileId).getBlob();
var mediaOperation = AdWordsApp.adMedia().newImageBuilder()
    .withName("IMAGE_NAME")
    .withData(imageBlob)
    .build();

======== Blob ========================================================================
more info : 
https://developers.google.com/apps-script/reference/base/blob-source


* Blob copyBlob();

* Blob getAs([contentType]);
  parameters : 
  - [contentType] string // convert to ('application/pdf', 'image/bmp', 'image/gif' etc.)

* Byte[] getBytes();

* string getContentType();

* string getDataAsString();

* string getDataAsString([charset]);
  parameters :
  - [charset] string (see 'UTILITIES')

* string getName();

* Blob setBytes([data]);
  parameters :
  - [data] Byte[] // the data to load

* Blob setContentType([contentType]);
  parameters :
  - [contentType] string // determine the blob content type

* Blob setDataFromString([data]);
  parameters :
  - [data] string // the data to load 

* Blob setDataFromString([data], [charset]);
  parameters :
  - [data] string // the data to load
  - [charset] string 

* Blob setName([name]);
  parameters :
  - [name] string // the blob new name


BlobSource
----------
* Blob getAs([contentType]);
* Blob getBlob();

* Attachment class
* Blob class
* Chart class
* Document class
* EmbeddedChart class
* File class
* GmailAttachment class
* HTTPResponse class
* HtmlOutput class
* InlineImage class
* JdbcBlob class
* JdbcClob class
* Spreadsheet class
* StaticMap class


CHART AS BLOB
-------------
see 'CHART AS BLOB' in 'CHARTS' section

NEW BLOB
--------
see 'Blob' in 'UTILITIES' section

ZIP BLOBS ARRAY
---------------
see 'zip' in 'UTILITIES' section
see 'IMAGE 2 BLOB' for using example

IMAGE 2 BLOB
------------

* example:
  // create blobs from images 
  var image1 = UrlFetchApp.fetch('http://www.myDomain.com/images/image1.jpg').getBlob();
  var image2 = UrlFetchApp.fetch('http://www.myDomain.com/images/image2.jpg').getBlob();

  // zip images to file 
  var zip = Utilities.zip([image1, image2], "myimages.zip");

  // unzip images file
  var files = Utilities.unzip(zip);

MAIL BLOB ATTACHMENTS
---------------------
see examples in 'MAIL' section

======== LABELS =====================================================================
more info:
https://developers.google.com/adwords/scripts/docs/reference/adwordsapp/adwordsapp_label

* get labels
  var labels = AdWordsApp.labels().get();

* get label/s by name
  var labels = AdWordsApp.labels().withCondition('Name = "[labelName]"').get();

* available entities: 
  - adGroups()	// returns an adGroups selector
  - ads()	// returns an ads selector
  - campaigns()	// returns a campaigns selector
  - keywords()	// returns a keywords selector

  - e.g: 
    label.keywords().get()

* more functions:
  - getColor()
  - getDescription()
  - getName()
  - remove()
  - setColor([sting])
  - setDescription([sting])
  - setName([sting])

* e.g:
  // get keywords labeled with the 'MyLabel' label 
  var labelName = 'MyLabel';
  var label = AdWordsApp.labels().withCondition('Name = "' + labelName + '"').get();
  if(!label.hasNext()) {
		Logger.log('error: label "%s" is not found!', labelName);
		return;
  }
  
  Logger.log('label "%s" loaded', labelName);
  var keywords = label.next().keywords().withCondition('Status = ENABLED').get();
  while(keywords.hasNext()) {
		var keyword = keywords.next();
		Logger.log('%s', keyword.getText());
  }


function createLabel(labelName){
  if(isLabelExists(labelName)) 
    return;
  
  // createLabel(<name>, <description>, <backgroundColor>);
  AdWordsApp.createLabel(labelName);
}

function isLabelExists(labelName){
	return campaign.labels()
      .withCondition('Name = "' + labelName + '"')      
      .get()
      .hasNext();
}

======== STATISTICS =================================================================

* use [Entity].getStatsFor() method to get statistics on the specified [Entity] object
* supported entites : 
  Campaign, AdGroup, Ad, Keyword, AdSchedule, Platform, TargetedLocation, TargetedProximity, Budget
* return AdWordsApp.Stats object (see 'STATS object')

getStatsFor
-----------
* AdWordsApp.Stats getStatsFor([range]);
* parameters :
  [range] string (see 'DATE RANGE')

* AdWordsApp.Stats getStatsFor([dateFrom], [dateTo]);
* parameters :
  [dateFrom] string (YYYYMMDD)
  [dateTo] string (YYYYMMDD)
* notice! see 'dateFormat' custom function

STATS object
------------
* double getAverageCpc() // average cost per click
* double getAverageCpm() // average cost per 1000 impressions
* double getAveragePageviews() // average number of pages viewed per visit
* double getAveragePosition() // average position
* double getAverageTimeOnSite() // average time a visitor spent on site, in seconds
* double getBounceRate() // bounce rate (0..1 range)
* long getClicks() // number of clicks
* double getConversionRate() // conversion rate (0..1 range)
* long getConversions() // number of conversions
* double getCost() // cost of the account (in the default currency)
* double getCtr() // click through rate (0..1 range)
* long getImpressions() // number of impressions

USING
-----
// get the keyword statistics for the last 14 days 
var keyword = AdWordsApp.keywords().get().next();
var stat = keyword.getStatsFor("LAST_14_DAYS");
  
Logger.log('keyword = ' + keyword.getText()); 
Logger.log('CLICKS = ' + stat.getClicks());

--------------------

// get the keyword statistics from 01/01/2014 to 10/01/2014
var keyword = AdWordsApp.keywords().get().next();
var stat = keyword.getStatsFor("20140101", "20140110");
  
Logger.log('keyword = ' + keyword.getText()); 
Logger.log('CLICKS = ' + stat.getClicks());

======== REPORTS ====================================================================

notice! 
use AdWordsApp class to execute report (AdWordsApp.report([query]))

note!
reports do not support ORDER BY and LIMIT! 

LIST
----
go to https://developers.google.com/adwords/api/docs/appendix/reports

* Account Performance
* Account Reach Frequency
* Ad Performance
* Ad Extensions Performance
* Ad Group Performance
* Ad Group Reach Frequency
* Age Range Performance
* Audience Performance
* Automatic Placements Performance
* Bid Goal Performance v201402
* Budget Performance
* Call Metrics Call Details
* Campaign Performance
* Campaign Ad Schedule Target
* Campaign Location Target
* Campaign Negative Keywords Performance
* Campaign Negative Locations
* Campaign Negative Placements Performance
* Campaign Platform Target
* Campaign Reach Frequency
* Click Performance
* Creative Conversion
* Criteria Performance
* Destination URL
* Display Keyword Performance
* Display Topics Performance
* Gender Performance
* Geo Performance
* Keywordless Category
* Keywordless Query
* Keywords Performance
* Paid and Organic Query v201402
* Placeholder Feed Item
* Placement Performance
* Product Partition v201402
* Search Query Performance
* Shopping Performance v201402
* URL Performance

METHODS
-------
* void exportToSheet([spreadsheet]);
* AdWordsApp.ReportRowIterator rows();

STRUCTURE
---------
var reportConfig = {
    includeZeroImpressions: false
};
var query =  'SELECT ... FROM ... WHERE... DURING..';
var report = AdWordsApp.report(query, reportConfig); 


e.g:
function GetReport(dateRange){
  var reportConfig = {
    includeZeroImpressions: true
  };
  
  var query =  'SELECT CampaignId, CampaignName, Week, Date, Impressions, Clicks, Ctr, Cost, AverageCpc, AveragePosition, Conversions, ConversionRate, CostPerConversion ' + 
    'FROM CAMPAIGN_PERFORMANCE_REPORT ' + 
    'WHERE CampaignStatus IN [ENABLED] ' +    
    'DURING ' + dateRange;

  return AdWordsApp.report(query, reportConfig); 
}

VERSION
-------
use the config apiVersion to set a specific version

e.g:
var reportConfig = {
    apiVersion: 'v201702'
};

var report = AdWordsApp.report(query, reportConfig); 


SLICED BY
---------
// report can be sliced by day, week, month or year

when we ask for Date - the report will be sliced by day
when we ask for Week - the report will be sliced by week
when we ask for Month - the report will be sliced by month
when we ask for Year - the report will be sliced by year

// e.g: sliced by week
var reportConfig = {
    includeZeroImpressions: true
  };
  
  var query =  'SELECT CampaignId, CampaignName, Week, Impressions.... ' + 
    'FROM CAMPAIGN_PERFORMANCE_REPORT ' + 
    'WHERE CampaignStatus IN [ENABLED] ' +    
    'DURING ' + dateRange;

  var report = AdWordsApp.report(query, reportConfig); 

EXPORT TO SHEET
---------------
export a report into sheet

* structure:
  report.exportToSheet([sheet])

* example:
  var report = AdWordsApp.report(
     'SELECT Cost, Impressions, Clicks, ConversionRate, Date ' +
     'FROM   ACCOUNT_PERFORMANCE_REPORT ' +
     'DURING THIS_MONTH');

  report.exportToSheet(sheet);

READ DATA FROM REPORT
---------------------
* structure : 
  var report = AdWordsApp.report([query]); // execute report
  var rows = report.rows(); // get rows iterator 
  while (rows.hasNext()) { // loop the rows to read data
	var row = rows.next();
	// code ...
  }

* notice!  
  use row[column] to get value

* example :
  var report = AdWordsApp.report(
					"SELECT AdGroupId, Impressions, Cost " + 
					"FROM SEARCH_QUERY_PERFORMANCE_REPORT " + 
					"WHERE  Impressions < 10 " +    
					"DURING LAST_30_DAYS"); 
  var rows = report.rows(); 
  while (rows.hasNext()) { 
	var row = rows.next();

	var cost = row["Cost"];    
	var impressions = row["Impressions"];
  }

WHERE
-----
we can use the WHERE clause in the report on any of the report fields

example:
var report = AdWordsApp.report(
					"SELECT Date, CampaignName, Impressions, Cost " + 
					"FROM CAMPAIGN_PERFORMANCE_REPORT " + 
					"WHERE  CampaignName = 'MyCampaign' " +    
					"DURING LAST_30_DAYS");

ORDER BY
--------
NOT SUPPORTED!

LIMIT
-----
NOT SUPPORTED!

GROUP BY
--------
reports returns row per day, therefore, if we ask for LAST_WEEK report it will include row per day per the report selected entity (campaign etc.)
e.g: if we execute the ACCOUNT_PERFORMANCE_REPORT for the previous month which supply a data about the current account - we will received 31 rows (one per day)
we then can use the 'Month', 'Week', 'MonthOfYear' ... properties to group the data. 
the 'Month' will return the first day of the month, formatted as yyyy-MM-dd
the 'Week' will return the date for the Monday of the week, formatted as yyyy-MM-dd
the 'MonthOfYear' will return the name of the month of the year, e.g., 'December'
and so on...

example using:

// group data by month

var numOfMonthsToPresent = 6; 
  
var now = new Date();
var startDate = HELPER.dateAdd(HELPER.getFirstDayOfMonth(now), -numOfMonthsToPresent, 'MM');
var dateRange = HELPER.dateFormat(startDate) + ',' + HELPER.dateFormat(now);
Logger.log(dateRange); 
  
var report = AdWordsApp.report(
'SELECT Date, MonthOfYear, Cost ' +
'FROM   ACCOUNT_PERFORMANCE_REPORT ' +
'DURING ' + dateRange
);
  
// { monthName [date, cost] }
var result = [];
result.IndexOf = function(monthName){
for(var i = 0; i < this.length; i++)
    if(this[i].monthName == monthName)
    return i;
return -1;
}
  
var rows = report.rows();
while(rows.hasNext())
{
var row = rows.next();
var monthName = row['MonthOfYear'];
    
var index = result.IndexOf(monthName);
if(index == -1)
{
    result.push({ monthName: monthName, rows:[] });
    index = result.length - 1;
}
    
var currentItem = result[index];
currentItem.rows.push({ date: row['Date'], cost: row['Cost'] });        
}

for(var i = 0; i < result.length; i++)
Logger.log('%s -> %s rows', result[i].monthName, result[i].rows.length);
  
output: 
20150901,20160303
February -> 29.0 rows
January -> 31.0 rows
December -> 31.0 rows
November -> 30.0 rows
September -> 30.0 rows
March -> 3.0 rows
October -> 31.0 rows

CONFIG
------
var reportConfig = {
	includeZeroImpressions: false
};
  
var report = AdWordsApp.report('[query]', reportConfig); 

AutomaticContent Issue
----------------------
report: 
KEYWORDS_PERFORMANCE_REPORT

issue:
'AutomaticContent' in keyword performance report

answer:
The AutomaticContent rows correspond to stats associated with Display Campaign Optimizer (criteria/keyword ID 3000006).

EXTRA
-----
* DURING [DATE RANGE] 
  - [DATE RANGE] string (see 'DATE RANGE')
  - any data in 'DATE RANGE' except of ALL_TIME
  - can set specific dates using the format yyyyMMdd	
  - notice! see 'dateFormat' custom function

  - examples:
  // specific dates, 01/02/2014 - 08/02/2014 
  var report = AdWordsApp.report(
					"SELECT AdGroupName, AverageCpc, CampaignName " +
					"FROM   PLACEMENT_PERFORMANCE_REPORT " +
					"DURING 20140201,20140208"
  );

* 2 FILTERS REPORT:
  - example: 
	var report_f1 = AdWordsApp.report(
	'SELECT Id ' + 
	'FROM AUDIENCE_PERFORMANCE_REPORT ' + 
	'WHERE Conversions > 0 ' + 
	'AND AveragePosition > 1.5 ' +  
	'DURING LAST_30_DAYS');
  
	var rows = report_f1.rows(); 
  
	var ids = [];
	while (rows.hasNext()) { 
	ids.push(rows.next()['Id']);
	}

	if(ids.length == 0) return;
  
	//Logger.log(ids.toString()); 
  
	var report = AdWordsApp.report(
	'SELECT Id, Criteria, Cost, Conversions, CostPerConversion, MaxCpc ' + 
	'FROM AUDIENCE_PERFORMANCE_REPORT ' + 
	'WHERE Id IN [' + ids.toString() + '] ' + 
	'DURING 20140201,20140208');

	rows = report.rows();

	while (rows.hasNext()) { 
		var row = rows.next();

		// code ...
	}

* date Range - from x till now 
  - example:	
  
	var report = AdWordsApp.report(
		'SELECT Id, Criteria, Cost, Conversions, CostPerConversion, MaxCpc ' + 
		'FROM AUDIENCE_PERFORMANCE_REPORT ' + 
		'DURING 20000101,' + dateFormat(new Date())
	);

	function dateFormat(date){
	  var year = date.getFullYear().toString();
	  var month = (date.getMonth() + 1).toString();
	  var day = date.getDate().toString();
  
	  if(month.length == 1) month = '0' + month; // return yyyyMMdd
	  if(day.length == 1) day = '0' + day;
  
	  return year + month + day;
	}

* BUGS
  - Column 'KeywordText' is not valid for report type KEYWORDS_PERFORMANCE_REPORT 
    Solution: use 'Criteria' instead of 'KeywordText' 
	e.g: 
	var report = AdWordsApp.report(
     'SELECT AdGroupId, Id, Criteria, Impressions, Clicks ' +
     'FROM   KEYWORDS_PERFORMANCE_REPORT ' +
     'DURING 20130101,20130301');

  - Cost filter doesn't seems to work
    issue: Report with wrong cost calculation in the Where Clause	   
	reason: Cost field in the report filter is in micros 
	Solution: multiple/devide by 1,000,000 in order to transform the value to a numeric
	e.g:
	var report = AdWordsApp.report(
	  'SELECT Id, Criteria, CostPerConversion, Cost, Conversions ' +
	  'FROM KEYWORDS_PERFORMANCE_REPORT ' +
	  'WHERE Status = ENABLED ' +  
	  'AND IsNegative = FALSE ' + 	  
	  'AND Cost > ' + (avarageCPA * 1000000) + ' ' + // Cost in micros - convert the avarageCPA to micros as well
	  'AND Criteria != AutomaticContent ' +   
	  'DURING TODAY');

USING
-----

// placement performance report
var report = AdWordsApp.report(
				"SELECT AdGroupName, AverageCpc, CampaignName " +
				"FROM   PLACEMENT_PERFORMANCE_REPORT " +
				"DURING LAST_7_DAYS "
);

---

var reportConfig = {
    includeZeroImpressions: false
  };
  
  var query =  'SELECT QualityScore, Id, Criteria, CampaignId, CampaignName, AdGroupId, AdGroupName ' + 
    'FROM KEYWORDS_PERFORMANCE_REPORT ' + 
    'WHERE  HasQualityScore = TRUE ' +    
    'AND IsNegative = FALSE ' + 
    'AND Status = ENABLED ' + 
    'AND AdGroupStatus = ENABLED ' +     
    'AND CampaignStatus = ENABLED '+
    'AND Id IN [35788032927, 138620395943] '+
    'DURING TODAY';

  var report = AdWordsApp.report(query, reportConfig);  

---

// search queries performance report
var report = AdWordsApp.report(
    'SELECT AdGroupName, Query, Impressions ' +
    'FROM SEARCH_QUERY_PERFORMANCE_REPORT ' +
    "WHERE  Impressions > 1 " +
    'DURING LAST_30_DAYS ', {
      includeZeroImpressions: false
    });
  
var rows = report.rows();
while(rows.hasNext()){
	var row = rows.next();
	Logger.log(row['Query'])
}


SEND REPORT TO EMAIL
--------------------
* see 'REPORT ATTACHMENT' in the 'MAIL' chapter

======== CHARTS =====================================================================
* source : https://developers.google.com/apps-script/reference/charts/
* more info: https://developers.google.com/chart/interactive/docs/
			 https://developers.google.com/chart/

* Important! 
  the first column data represents the xAxis and all the others represent the yAxis!

Enum ChartType
--------------
AREA
BAR
COLUMN
LINE
PIE
SCATTER
TABLE

e.g: ChartType.LINE

Chart Types
-----------
* AreaChartBuilder
* BarChartBuilder 
* ColumnChartBuilder 
* LineChartBuilder 
* PieChartBuilder 
* ScatterChartBuilder 
* TableChartBuilder 

ChartBuilder - COMMON
---------------------
* Chart build() // build the chart
* reverseCategories()  // reverse
* setBackgroundColor([colors]) // set background color
  parameters : 
  - [colors] string[] // 'red', '#ddd' ...

* setColors([colors]) // set chart lines colors
  parameters : 
  - [colors] string[] // 'red', '#ddd' ...

* setOption([option], [value]) // add chart option 
  parameters : 
  - [option] string (see 'https://developers.google.com/chart/interactive/docs/gallery')
  - [value] object

* setDataSourceUrl([url]) // data source url to fill the chart (google sheet etc.)
  parameters : 
  - [url] string 

* setDataTable([data])
  parameters : 
  - [data] can use DataTableBuilder or DataTableSource as data source (see 'DataTableBuilder' and 'DataTableSource')

* setDimensions([width], [height]) // set chart size
  parameters : 
  - [width] int
  - [height] int 


Dashboards
----------
https://developers.google.com/chart/interactive/docs/gallery/controls#dashboardobject
// TODO ..

Categories
----------
https://developers.google.com/chart/interactive/docs/gallery/controls#categoryfilter
// TODO ..

ChartBuilder - COMMON AXIS
--------------------------
* see 'ChartBuilder - COMMON'

* setRange([start], [end]) // set the chart range
  parameters : 
  - [start] int
  - [end] int 

* setStacked() // Uses stacked lines, meaning that line and bar values are stacked 
* setTitle([title]) // set the chart title
  parameters : 
  - [title] string 

* setTitleTextStyle([text_style]) // set title style
  parameters : 
  - [text_style] TextStyle (see 'TextStyle')

* setXAxisTextStyle([text_style]) // set axis style (x)
  parameters : 
  - [text_style] TextStyle (see 'TextStyle')

* setXAxisTitle([title]) // set axis title (x)
  parameters : 
  - [title] string 

* setXAxisTitleTextStyle([text_style]) // set axis title style (x)
  parameters : 
  - [text_style] TextStyle (see 'TextStyle')
  
* setYAxisTextStyle([text_style]) // set axis style (y)
  parameters : 
  - [text_style] TextStyle (see 'TextStyle')

* setYAxisTitle([title]) // set axis title (y)
  parameters : 
  - [title] string 

* setYAxisTitleTextStyle([text_style]) // set axis title style (y)
  parameters : 
  - [text_style] TextStyle (see 'TextStyle')

AreaChartBuilder
----------------
* see 'ChartBuilder - COMMON AXIS'

* setPointStyle([style]) // set the line points style
  parameters : 
  - [style] PointStyle (see 'CHART POINT STYLE (enum)') // e.g: Charts.PointStyle.LARGE

BarChartBuilder 
---------------
* see 'ChartBuilder - COMMON AXIS'

* reverseDirection() // reverses the direction in which the bars grow along the horizontal axis

ColumnChartBuilder 
------------------
* see 'ChartBuilder - COMMON AXIS'

LineChartBuilder 
----------------
* see 'ChartBuilder - COMMON AXIS'

* setCurveStyle([style])  // set the curve style
  parameters : 
  - [style] CurveStyle (see 'CHART CURVE STYLE (enum)') // e.g: Charts.CurveStyle.SMOOTH

PieChartBuilder 
---------------
* see 'ChartBuilder - COMMON'

* set3D() // set the chart to be three dimensional

ScatterChartBuilder 
-------------------
* see 'ChartBuilder - COMMON AXIS'

* setPointStyle([style]) // set the line points style
  parameters : 
  - [style] PointStyle (see 'CHART POINT STYLE (enum)') // e.g: Charts.PointStyle.LARGE

* setXAxisRange([start], [end])  // set the axis range (x)
  parameters : 
  - [start] int
  - [end] int

* setYAxisRange([start], [end])  // set the axis range (y)
  parameters : 
  - [start] int
  - [end] int

TableChartBuilder 
-----------------
* see 'ChartBuilder - COMMON'

* enablePaging([paging]) // enable/disable paging
  parameters : 
  - [paging] bool // default page size = 10

* enablePaging([page_size]) // enable/disable paging
  parameters : 
  - [page_size] int // page size

* enablePaging([page_size], [start]) // enable/disable paging
  parameters : 
  - [page_size] int // page size
  - [start] int // start page index

* enableRtlTable([rtl]) // set table as rtl direction
  parameters : 
  - [rtl] bool

* enableSorting([sorting]) // enable/disable sorting
  parameters : 
  - [sorting] bool 

* setFirstRowNumber([row_number]) // set the first row index 
  parameters : 
  - [row_number] int // row index

* setInitialSortingAscending([column]) // sort by column asc
  parameters : 
  - [column] int // column index

* setInitialSortingDescending([column]) // sort by column desc
  parameters : 
  - [column] int // column index

* useAlternatingRowStyle([alternate])  // enable/disable alternate row style
  parameters : 
  - [alternate] bool

Charts
------
* AreaChartBuilder newAreaChart() // area chart
* BarChartBuilder newBarChart() // bar chart
* ColumnChartBuilder newColumnChart() // columns chart
* LineChartBuilder newLineChart() // line chart
* PieChartBuilder newPieChart() // pie chart
* ScatterChartBuilder newScatterChart() // scatter chart
* TableChartBuilder newTableChart() // table chart

* DataTableBuilder newDataTable()  // chart data table

* CategoryFilterBuilder newCategoryFilter()
* DashboardPanelBuilder newDashboardPanel()
* DataViewDefinitionBuilder newDataViewDefinition()
* NumberRangeFilterBuilder newNumberRangeFilter()
* StringFilterBuilder newStringFilter()
* TextStyleBuilder newTextStyle()

Chart
-----
* Blob getAs(contentType) // return data as blob converted to the specific content type
* Blob getBlob() // return data as blob
* string getId() // get chart id
* Chart setId(id) // set chart id
* ChartOptions getOptions() // get chart style properties (height, color etc.)

ChartOptions
------------
* object get(string) // get property 

OPTIONS
-------
* available options:
  https://developers.google.com/chart/interactive/docs/gallery
  note! choose the chart type from the left pane

* setOption([key], [value])

Create New Chart
----------------
* example:
  var data = Charts.newDataTable() .... (see 'Create Chart DataTable')
  var chart = Charts.newAreaChart().setDataTable(data).setStacked().setRange(0, 40).setDimensions(800, 400).setTitle("Sales per Month").build();

Create Chart DataTable
----------------------
* structure:
  var data = Charts.newDataTable()
					.addColumn([type], [value])
					......
					......     
					.addRow([columns value seperated by ','])       
					......
					......
					.build();

* important!
  when using multiple ranges, each column represents the delta from the previous one!
  in the example below the first column is for the xAxis, and the rest represents the yAxis ranges (2 ranges - In Store and Online) 
  so the actual values of column 'Online' are the delta from the previous column (In Store) and will look as follow: 
  January = 9 // 10 - 1
  February = 13  // 12 + 1
  ...
  May = 34 // 30 + 4

* example:  
  var data = Charts.newDataTable()
					.addColumn(Charts.ColumnType.STRING, "Month")
					.addColumn(Charts.ColumnType.NUMBER, "In Store")
					.addColumn(Charts.ColumnType.NUMBER, "Online")       
					.addRow(["January", 10, -1])       
					.addRow(["February", 12, 1])       
					.addRow(["March", 20, 2])       
					.addRow(["April", 25, 3])       
					.addRow(["May", 30, 4])       
					.build();


STACKED COLUMN
--------------
set isStacked to be true in order to stack the data
note! only on column type chart

e.g:
chartBuilder.setOption('isStacked', true); 

SEND CHART TO EMAIL
-------------------
* see 'CHART ATTACHMENT' in the 'MAIL' chapter

EMBEDDED CHART
--------------
use an embedded chart to add a chart into a spreadSheet. 
the embedded chart gets as data source a data ranges on the same sheet and therefore it act as a 'live' 
chart which changes on each data change within the sheet (even manually changes)

see 'USING THE CHART SERVICE'
see 'CHART SERVICE'

USING THE CHART SERVICE
-----------------------
* see also 'CHART SERVICE'
* var chartService = ChartService();
-----

methods:
addLineChartToSheet
addAreaChartToSheet
addBarsChartToSheet

signature:
void FUNCTION(_sheet, arrRanges, vAxisData, width, height, rowPosition, columnPosition, chartTitle)
  
params:
arrRanges: range format ('B15:B24' etc.) 
vAxisData: { title, ticks, lines[{color, legend}] }
 
using:
chartService.addLineChartToSheet(
sheetService.sheet,
['A1:A5', 'B1:B5', 'C1:C5'], 
{ lines: [ // vAxis data      
    {color:'#AA4643', legend:'clicks'},
	{color:'#00FF00', legend:'cost'}
]},
700, 200, // chart size (width,height)
2, 7, // chart location (row, column)
'chart Title'
);
  
chartService.addAreaChartToSheet(
sheetService.sheet,
['A1:A5', 'B1:B5', 'C1:C5'], 
{ lines: [ // vAxis data      
    {color:'#AA4643', legend:'clicks'},
	{color:'#00FF00', legend:'cost'}
]},
700, 200, // chart size (width,height)
12, 7, // chart location (row, column)
'chart Title'
);
  
chartService.addBarsChartToSheet(
sheetService.sheet,
['A1:A5', 'B1:B5', 'C1:C5'], 
{ lines: [ // vAxis data      
    {color:'#AA4643', legend:'clicks'},
	{color:'#00FF00', legend:'cost'}
]},
700, 200, // chart size (width,height)
22, 7, // chart location (row, column)
'chart Title'
);

-----
  
methods:
addBarsLineChartDualYToSheet
addLineChartDualYToSheet
addBarsChartDualYToSheet

signature:
void FUNCTION(_sheet, arrRanges, vAxisDataLeft, vAxisDataRight, width, height, rowPosition, columnPosition, chartTitle)
  
params:
arrRanges: range format ('B15:B24' etc.) 
vAxisDataLeft:  { title, ticks, color, legend }
vAxisDataRight: { title, ticks, color, legend }
    
using:
chartService.addLineChartDualYToSheet(
sheetService.sheet,
['A1:A5', 'B1:B5', 'C1:C5'],
{ 
    title: 'LEFT',
    color:'#00FF00', 
    legend:'cost'
},
{ 
    title: 'RIGHT', 
    ticks: [0, 5, 10],
    color:'#FF0000', 
    legend:'clicks'
},
700, 200, // chart size (width,height)
2, 7, // chart location (row, column)
'chart Title'
); 
  
chartService.addBarsChartDualYToSheet(
sheetService.sheet,
['A1:A5', 'B1:B5', 'C1:C5'],
{ 
    title: 'LEFT',
    color:'#00FF00', 
    legend:'cost'
},
{ 
    title: 'RIGHT', 
    ticks: [0, 5, 10],
    color:'#FF0000', 
    legend:'clicks'
},
700, 200, // chart size (width,height)
12, 7, // chart location (row, column)
'chart Title'
); 
  
chartService.addBarsLineChartDualYToSheet(
sheetService.sheet,
['A1:A5', 'B1:B5', 'C1:C5'],
{ 
    title: 'LEFT',
    color:'#00FF00', 
    legend:'cost'
},
{ 
    title: 'RIGHT', 
    ticks: [0, 5, 10],
    color:'#FF0000', 
    legend:'clicks'
},
700, 200, // chart size (width,height)
22, 7, // chart location (row, column)
'chart Title'
); 

-----

methods:
createLineChart
createBarsChart
createAreaChart
createPieChart
  
signature:
Blob FUNCTION(columns, rows, vAxisData, width, height, chartTitle)
  
params:
columns: [{ name, type }]
rows: [[value1,value2...valueN]] 
vAxisData: { title, ticks, lines[{color, legend}]
  
using:
var lineChartBlob = chartService.createLineChart( 
[
    { name: 'Date', type: 'datetime' },
    { name: 'clicks', type: 'number' },
    { name: 'cost', type: 'number' }      
],
[
    [new Date(2016,03,04), 12, 30], 
    [new Date(2016,03,03), 9, 32],
    [new Date(2016,03,02), 12, 25],
    [new Date(2016,03,01), 20, 30],
    [new Date(2016,02,29), 8, 20]
],
{ lines: [ // vAxis data      
    {color:'#AA4643', legend:'clicks'},
	{color:'#00FF00', legend:'cost'}
]},
700, 200, // chart size (width,height)
'chart Title'
);
sheetService.sheet.insertImage(lineChartBlob, 7, 2); // (column, row)
 
var barsChartBlob = chartService.createBarsChart( 
[
    { name: 'Date', type: 'datetime' },
    { name: 'clicks', type: 'number' },
    { name: 'cost', type: 'number' }      
],
[
    [new Date(2016,03,04), 12, 30], 
    [new Date(2016,03,03), 9, 32],
    [new Date(2016,03,02), 12, 25],
    [new Date(2016,03,01), 20, 30],
    [new Date(2016,02,29), 8, 20]
],
{ lines: [ // vAxis data      
    {color:'#AA4643', legend:'clicks'},
	{color:'#00FF00', legend:'cost'}
]},
700, 200, // chart size (width,height)
'chart Title'
);
sheetService.sheet.insertImage(barsChartBlob, 7, 12); // (column, row)
  
var areaChartBlob = chartService.createAreaChart( 
[
    { name: 'Date', type: 'datetime' },
    { name: 'clicks', type: 'number' },
    { name: 'cost', type: 'number' }      
],
[
    [new Date(2016,03,04), 12, 30], 
    [new Date(2016,03,03), 9, 32],
    [new Date(2016,03,02), 12, 25],
    [new Date(2016,03,01), 20, 30],
    [new Date(2016,02,29), 8, 20]
],
{ lines: [ // vAxis data      
    {color:'#AA4643', legend:'clicks'},
	{color:'#00FF00', legend:'cost'}
]},
700, 200, // chart size (width,height)
'chart Title'
);
sheetService.sheet.insertImage(areaChartBlob, 7, 22); // (column, row)

var pieChartBlob = chartService.createPieChart( 
[
    { name: 'Task', type: 'string' },
    { name: 'Value', type: 'number' }
],
[
    ['A', 30],
	['B', 100],
	['C', 320]
],
{
    lines: [ // vAxis data      
    {color:'#4D90FE', legend:'A'},
    {color:'#00FF00', legend:'B'},
    {color:'#AA4643', legend:'C'}
]},
450, 330, // chart size (width,height)
'chart Title'
);
sheetService.sheet.insertImage(pieChartBlob, 9, 3, 50, 0); // (column, row, left, top)

-----
  
methods:  
createLineChartChartDualY
createBarsChartDualY
createBarsLineChartDualY
createBarsScatterChartDualY
createBarsAreaChartDualY

signature:
Blob FUNCTION(columns, rows, vAxisDataLeft, vAxisDataRight, width, height, chartTitle)
  
params:
columns: [{ name, type }] 
rows: [[value1,value2...valueN]]   
vAxisDataLeft:  { title, ticks, color, legend }
vAxisDataRight: { title, ticks, color, legend }
  
using:
var lineChartBlob = chartService.createLineChartChartDualY( 
[
    { name: 'Date', type: 'datetime' },
    { name: 'clicks', type: 'number' },
    { name: 'cost', type: 'number' }      
],
[
    [new Date(2016,03,04), 12, 30], 
    [new Date(2016,03,03), 9, 32],
    [new Date(2016,03,02), 12, 25],
    [new Date(2016,03,01), 20, 30],
    [new Date(2016,02,29), 8, 20]
],
{ 
    title: 'LEFT',
    color:'#00FF00', 
    legend:'cost'
},
{ 
    title: 'RIGHT', 
    ticks: [0, 15, 30, 45],
    color:'#FF0000', 
    legend:'clicks'
},
700, 200, // chart size (width,height)
'chart Title'
);
sheetService.sheet.insertImage(lineChartBlob, 1, 2, -20, 0); // (column, row, left top)
  
var barsChartBlob = chartService.createBarsChartDualY( 
[
    { name: 'Date', type: 'datetime' },
    { name: 'clicks', type: 'number' },
    { name: 'cost', type: 'number' }      
],
[
    [new Date(2016,03,04), 12, 30], 
    [new Date(2016,03,03), 9, 32],
    [new Date(2016,03,02), 12, 25],
    [new Date(2016,03,01), 20, 30],
    [new Date(2016,02,29), 8, 20]
],
{ 
    title: 'LEFT',
    color:'#00FF00', 
    legend:'cost'
},
{ 
    title: 'RIGHT', 
    ticks: [0, 15, 30, 45],
    color:'#FF0000', 
    legend:'clicks'
},
700, 200, // chart size (width,height)
'chart Title'
);
sheetService.sheet.insertImage(barsChartBlob, 1, 12); // (column, row)
  
var barsLineChartBlob = chartService.createBarsLineChartDualY( 
[
    { name: 'Date', type: 'datetime' },
    { name: 'clicks', type: 'number' },
    { name: 'cost', type: 'number' }      
],
[
    [new Date(2016,03,04), 12, 30], 
    [new Date(2016,03,03), 9, 32],
    [new Date(2016,03,02), 12, 25],
    [new Date(2016,03,01), 20, 30],
    [new Date(2016,02,29), 8, 20]
],
{ 
    title: 'LEFT',
    color:'#00FF00', 
    legend:'cost'
},
{ 
    title: 'RIGHT', 
    ticks: [0, 15, 30, 45],
    color:'#FF0000', 
    legend:'clicks'
},
700, 200, // chart size (width,height)
'chart Title'
);
sheetService.sheet.insertImage(barsLineChartBlob, 1, 22); // (column, row)
 
var barsScatterChartBlob = chartService.createBarsScatterChartDualY( 
[
    { name: 'Date', type: 'datetime' },
    { name: 'clicks', type: 'number' },
    { name: 'cost', type: 'number' }      
],
[
    [new Date(2016,03,04), 12, 30], 
    [new Date(2016,03,03), 9, 32],
    [new Date(2016,03,02), 12, 25],
    [new Date(2016,03,01), 20, 30],
    [new Date(2016,02,29), 8, 20]
],
{ 
    title: 'LEFT',
    color:'#00FF00', 
    legend:'cost'
},
{ 
    title: 'RIGHT', 
    ticks: [0, 15, 30, 45],
    color:'#FF0000', 
    legend:'clicks'
},
700, 200, // chart size (width,height)
'chart Title'
);
sheetService.sheet.insertImage(barsScatterChartBlob, 1, 32); // (column, row)
  
var barsAreaChartBlob = chartService.createBarsAreaChartDualY( 
[
    { name: 'Date', type: 'datetime' },
    { name: 'clicks', type: 'number' },
    { name: 'cost', type: 'number' }      
],
[
    [new Date(2016,03,04), 12, 30], 
    [new Date(2016,03,03), 9, 32],
    [new Date(2016,03,02), 12, 25],
    [new Date(2016,03,01), 20, 30],
    [new Date(2016,02,29), 8, 20]
],
{ 
    title: 'LEFT',
    color:'#00FF00', 
    legend:'cost'
},
{ 
    title: 'RIGHT', 
    ticks: [0, 15, 30, 45],
    color:'#FF0000', 
    legend:'clicks'
},
700, 200, // chart size (width,height)
'chart Title'
);
sheetService.sheet.insertImage(barsAreaChartBlob, 1, 42); // (column, row)

vAxis vs vAxes
--------------
// single 
var vAxis = {ticks: null, title: 'aaa'};
chartBuilder.setOption('vAxis', vAxis);

// multiple
var vAxisSeries = [];
vAxes.push({ticks: null, title: 'aaa'});
vAxes.push({ticks: [1,5,10], title: 'bbb'});
chartBuilder.setOption('vAxes', vAxes);

DUAL-Y (vAxis)
--------------
* in order to add two different and independent vAxes in the same chart
  we need to use the combination of the 'series' property along with the 'vAxes' property
  we can then set a differernt vAxis ticks, titles etc.
  the property 'targetAxisIndex' is the indicator of each series 

* example:
  see 'USING THE CHART SERVICE'
  see 'CHART SERVICE'

ADD CHART WITHIN A SHEET BASED ON RANGE DATA
--------------------------------------------
see 'EMBEDDED CHART'

DRAW EMBEDDED CHART
-------------------
* see also 'CHART SERVICE'
  see also 'USING THE CHART SERVICE'

* EmbeddedChartBuilder entity
  https://developers.google.com/apps-script/reference/spreadsheet/embedded-chart-builder

* note! 
  sheet.newChart() returns EmbeddedChartBuilder instead of a specific ChartBuilder 
  e.g: Charts.newLineChart() which returns LineChartBuilder

* to draw chart and insert it as Image use chart.getBlob() method on any created chart and use the InsertImage sheet method 
  important: use ChartBuilder instead of EmbeddedChartBuilder!
  see 'CHART AS BLOB'

* available options:
  linechart: https://developers.google.com/chart/interactive/docs/gallery/linechart#Configuration_Options	       
  for full list see 'OPTIONS'

// draw a chart based on sheet range data 
var range = sheet.getRange([range]); // the chart data 
var chartBuilder = sheet.newChart(); // EmbeddedChartBuilder
chartBuilder.addRange(range)
    .setChartType(Charts.ChartType.LINE)  // chart type - line
    .setOption('title', [title]) // chart title 
    .setOption('animation.duration', [duration]) // animation 
    .setPosition([rowIndex],[columnIndex],[rowOffset],[columnOffset])  
sheet.insertChart(chartBuilder.build());

example: 
var service = SpreadsheetLoader.loadSheetService('TEST_SHEET');
var sheet = service.getSheet();
 
var range = sheet.getRange('A2:B5'); // the chart data (from cell A2 to cell B5)

var chartBuilder = sheet.newChart();
chartBuilder.addRange(range)
    .setChartType(Charts.ChartType.LINE)  // chart type - line
    .setOption('title', 'My Line Chart!') // chart title 
    .setOption('animation.duration', 500) // animation 
    .setPosition(2,4,0,0)  // chart location row 2 column 4
sheet.insertChart(chartBuilder.build());

example:

// arrRanges, vAxisData, width, height, rowPosition, columnPosition, chartTitle 
// vAxisData: { title, ticks, lines[]{ color, legend} }
DrawLineChartSingleY(
	/* 
		chart data
		hAxis - column A (always the first range!)
		vAxis - column B, Column F and Column G - from row 2 to 11	 	
	*/
	['A2:A11', 'B2:B11','F2:F11', 'G2:G11'], 
	{ lines: [ // vAxis data
      {color:'#4572A7', legend:'impressions'},
      {color:'#AA4643', legend:'clicks'},
	  {color:'#00FF00', legend:'cost'}
    ]},
	800, 200, // chart size - 800x200
	24, 1, // chart location - row 24, column 1
	'chart Title'); 
);

// arrRanges, vAxisDataLeft, vAxisDataRight, width, height, rowPosition, columnPosition, chartTitle 
// vAxisData: { title, ticks, color, legend }
DrawLineChartDualY(
    ['A2:A26', 'B2:B26', 'C2:C26'],
    { // left vAxis data 
      title: 'LEFT',
      color:'#00FF00', 
      legend:'impressions'
    },
    { // right vAxis data
      title: 'RIGHT', 
      ticks: [0, 5, 10],
      color:'#FF0000', 
      legend:'clicks'
    },
    700, 160, 3, 7, // chart location - row 3, column 7
    'chart Title'
  ); 

function DrawLineChartSingleY(arrRanges /* range format: 'B15:B24' */, vAxisData /* { title, ticks, lines[]{color, legend}  } */, width, height, rowPosition, columnPosition, chartTitle){  
    var series = [];
    for (var i in vAxisData.lines)         
        series.push({ 
        color: vAxisData.lines[i].color, 
        labelInLegend : vAxisData.lines[i].legend,
        pointShape: 'square',
        pointSize: 4,
        type: 'line',
        targetAxisIndex: 0 // only one vAxis (index 0)
        });
       
    var minValue = 0;
    if(vAxisData.ticks) // custom vAxis values      
        // set minimum value to be the minimum tick value
        minValue = Math.min.apply(null, vAxisData.ticks).toFixed(0);
       
    var vAxis = { 
        ticks: vAxisData.ticks, // null for default
        title: vAxisData.title,
        minValue: minValue, 
        viewWindow: { min: minValue }
    };

    var vAxes = [];
    vAxes.push(vAxis); // only one vAxis (index 0)
       
    buildChart(arrRanges, series, vAxes, width, height, rowPosition, columnPosition, chartTitle);
}

function DrawLineChartDualY(arrRanges /* range format: 'B15:B24' */, vAxisDataLeft /* { title, ticks, color, legend } */, vAxisDataRight, width, height, rowPosition, columnPosition, chartTitle){  
    var series = [];
       
    series.push({ 
        color: vAxisDataLeft.color, 
        labelInLegend : vAxisDataLeft.legend,
        pointShape: 'square',
        pointSize: 4,
        type: 'line',
        targetAxisIndex: 0 // vAxis (index 0)
    });
             
    series.push({ 
        color: vAxisDataRight.color, 
        labelInLegend : vAxisDataRight.legend,
        pointShape: 'square',
        pointSize: 4,
        type: 'line',
        targetAxisIndex: 1 // vAxis (index 1)
    });
       
    var minValueLeft = 0;
    if(vAxisDataLeft.ticks) // custom vAxis values      
        // set minimum value to be the minimum tick value
        minValueLeft = Math.min.apply(null, vAxisDataLeft.ticks).toFixed(0);
       
    var vAxisLeft = { 
        ticks: vAxisDataLeft.ticks, // null for default
        title: vAxisDataLeft.title,
        minValue: minValueLeft, 
        viewWindow: { min: minValueLeft }
    };
       
    var minValueRight = 0;
    if(vAxisDataRight.ticks) // custom vAxis values      
        // set minimum value to be the minimum tick value
        minValueRight = Math.min.apply(null, vAxisDataRight.ticks).toFixed(0);
       
    var vAxisRight = { 
        ticks: vAxisDataRight.ticks, // null for default
        title: vAxisDataRight.title,
        minValue: minValueRight, 
        viewWindow: { min: minValueRight }
    };

    var vAxes = [];
    vAxes.push(vAxisLeft); // vAxis (index 0)
    vAxes.push(vAxisRight); // vAxis (index 1)
       
    buildChart(arrRanges, series, vAxes, width, height, rowPosition, columnPosition, chartTitle);
}

function addChartBarsLineDualY(arrRanges /* range format: 'B15:B24' */, vAxisDataLeft /* { title, ticks, color, legend } */, vAxisDataRight, width, height, rowPosition, columnPosition, chartTitle){  
	var series = [];
       
	series.push({ 
		color: vAxisDataLeft.color, 
		labelInLegend : vAxisDataLeft.legend,
		pointShape: 'square',
		pointSize: 4,
		type: 'bars',
		targetAxisIndex: 0 // vAxis (index 0)
	});
             
	series.push({ 
		color: vAxisDataRight.color, 
		labelInLegend : vAxisDataRight.legend,
		pointShape: 'square',
		pointSize: 4,
		type: 'line',
		targetAxisIndex: 1 // vAxis (index 1)
	});
       
	var minValueLeft = 0;
	if(vAxisDataLeft.ticks) // custom vAxis values      
		// set minimum value to be the minimum tick value
		minValueLeft = Math.min.apply(null, vAxisDataLeft.ticks).toFixed(0);
       
	var vAxisLeft = { 
		ticks: vAxisDataLeft.ticks, // null for default
		title: vAxisDataLeft.title,
		minValue: minValueLeft, 
		viewWindow: { min: minValueLeft }
	};
       
	var minValueRight = 0;
	if(vAxisDataRight.ticks) // custom vAxis values      
		// set minimum value to be the minimum tick value
		minValueRight = Math.min.apply(null, vAxisDataRight.ticks).toFixed(0);
       
	var vAxisRight = { 
		ticks: vAxisDataRight.ticks, // null for default
		title: vAxisDataRight.title,
		minValue: minValueRight, 
		viewWindow: { min: minValueRight }
	};

	var vAxes = [];
	vAxes.push(vAxisLeft); // vAxis (index 0)
	vAxes.push(vAxisRight); // vAxis (index 1)
       
	buildChart(arrRanges, series, vAxes, width, height, rowPosition, columnPosition, chartTitle);
}


function DrawChart(arrRanges, series, vAxes, width, height, rowPosition, columnPosition, chartTitle){
	Logger.log('Drawing Chart ... ')

	var chartBuilder = _sheet.newChart();
              
    for (var i in arrRanges)         
        chartBuilder.addRange(_sheet.getRange(arrRanges[i]));       
       
    chartBuilder             
    .setPosition(rowPosition, columnPosition, 0, 0)  // chart location row X column Y       
                            
    .setOption('animation.duration', 500) // animation                 
    .setOption('width', width)        
    .setOption('height', height)                                    
    .setOption('legend', { position: 'bottom', alignment: 'center' })                 
    .setOption('hAxis.textPosition', 'none') // hide hAxis labels (options: out, in, none)     
    .setOption('series', series)  // parameter       
    .setOption('vAxes', vAxes) // parameter              
       
    if(chartTitle)
        chartBuilder.setOption('title', chartTitle); 

    _sheet.insertChart(chartBuilder.build());
    
	Logger.log('Done!')
}

CHART AS BLOB
-------------
var data = Charts.newDataTable()
			.addColumn(Charts.ColumnType.STRING, 'Month')
			.addColumn(Charts.ColumnType.NUMBER, 'A')
			.addColumn(Charts.ColumnType.NUMBER, 'B')
			.addRow(['January', 10, 1])
			.addRow(['February', 12, 1])
			.addRow(['March', 20, 1])
			.addRow(['April', 25, 1])
			.addRow(['May', 30, 1])
			.build();

var chart = Charts.newAreaChart()
			   .setDataTable(data)
			   .setStacked()
			   .setRange(0, 40)
			   .setTitle('bla bla')
			   .build();
       
var blob = chart.getBlob(); // get as blob
sheet.insertImage(blob,1,1);

USING
-----
var data = Charts.newDataTable()
				.addColumn(Charts.ColumnType.STRING, 'Name')
				.addColumn(Charts.ColumnType.NUMBER, 'Cost')
				.addColumn(Charts.ColumnType.NUMBER, 'Impressions')
				.addColumn(Charts.ColumnType.NUMBER, 'Clicks');  
  
var date_range = 'ALL_TIME';
var chart_Title = 'TOP 10 Most Expensive Keywords';
   
var keywords = AdWordsApp.keywords().orderBy('Cost DESC').forDateRange(date_range).withLimit(10).get();
while (keywords.hasNext()) {    
	var keyword = keywords.next();    
	var stat = keyword.getStatsFor(date_range);
	data.addRow([keyword.getText(), stat.getCost(), stat.getImpressions(), stat.getClicks()]);     
	//Logger.log(keyword.getText()  + ',' + stat.getCost()  + ',' + stat.getImpressions() + ',' + stat.getClicks());
}

data.build();  
  
var chart_area = Charts.newAreaChart()      
					  .setDataTable(data)      
					  .setStacked()      
					  .setRange(0, 1000)   
					  .setDimensions(1000, 400)
					  .setTitle(chart_Title)      
					  .build();  
  
var chart_bar = Charts.newBarChart()     
					  .setDataTable(data)      
					  .setStacked()      
					  .setRange(0, 1000)   
					  .setDimensions(1000, 400)
					  .setTitle(chart_Title)      
					  .build();  
  
var chart_column = Charts.newColumnChart()     
					  .setDataTable(data)      
					  .setStacked()      
					  .setRange(0, 1000)   
					  .setDimensions(1000, 400)
					  .setTitle(chart_Title)      
					  .build();  
  
var chart_line = Charts.newLineChart()     
					  .setDataTable(data)          
					  .setRange(0, 1000)   
					  .setDimensions(1000, 400)
					  .setTitle(chart_Title)      
					  .build(); 
  
var chart_pie = Charts.newPieChart()     
					  .setDataTable(data)      
					  .setDimensions(1000, 400)
					  .setTitle(chart_Title)  
					  .set3D()
					  .build();
  
var chart_table = Charts.newTableChart()     
					  .setDataTable(data)         
					  .setDimensions(1000, 400)     
					  .build();
  
var blob_area = chart_area.getBlob();
var blob_bar = chart_bar.getBlob();
var blob_column = chart_column.getBlob();
var blob_line = chart_line.getBlob();
var blob_pie = chart_pie.getBlob();
var blob_table = chart_table.getBlob();
  
MailApp.sendEmail('rcbuilder@walla.com', 'HELLO FROM ADWORDS SCRIPTS', 'ATTACHED CHART FILE', {attachments: [blob_area, blob_bar, blob_column, blob_line, blob_pie, blob_table]});


======== URL FETCH ==================================================================
* use UrlFetchApp to fetch resources from url 
* use UrlFetchApp to create an http requests

UrlFetchApp
-----------
* HTTPResponse fetch(url) // get resource from url
* HTTPResponse fetch(url, http_params) // get resource from url (advanced mode)
* Object getRequest(url)
* Object getRequest(url, http_params)
* OAuthConfig addOAuthService(serviceName)
* void removeOAuthService(serviceName)

http_params
-----------
* contentType - string // set request content type
* headers - Object  // key/value
* method - string // 'post', 'get', 'put', 'delete', etc
* payload - string // json structure
* useIntranet - bool 
* validateHttpsCertificates - bool
* followRedirects - bool
* oAuthServiceName - string
* oAuthUseToken - string
* muteHttpExceptions - bool
* escaping - bool

HTTPResponse
------------
* Object getAllHeaders() // return the response headers (plus multiple values headers)
* blob getAs(contentType) // return data to blob converted to the specific content type
* blob getBlob() // return data as blob
* Byte[] getContent() // return the http response binary raw content
* String getContentText() // return the http response content as string
* String getContentText(charset) // return the http response content as string encoded by the supplied charset
* Object getHeaders() //  return the response headers
* Integer getResponseCode() // get the response status code (200, 404, 500 etc.)

OAuthConfig
-----------
* Represents configuration settings for an OAuth-enabled remote service.
* for more information : https://developers.google.com/apps-script/reference/url-fetch/

USING
-----

// create simple request
var response = UrlFetchApp.fetch('http://mydomain.co.il');
Logger.log(response.getResponseCode()) 
Logger.log(response.getContentText())

--------------------

// create advanced request 
var payload =   { 'firstName' : 'Roby', 'lastName' : 'Cohen' };
var options =   { 'method' : 'post', 'payload' : payload };

var response = UrlFetchApp.fetch('http://mydomain.co.il', options);
Logger.log(response.getResponseCode()) 


--------------------

// disable the fetch exceptions in order to get the http status codes 
// muteHttpExceptions option
var options =   { muteHttpExceptions: true };

var response = UrlFetchApp.fetch('http://mydomain.co.il', options);
Logger.log('status code: %s', response.getResponseCode());   

   
--------------------

// create blob from image url
var logo_url = "http://www.mydomain.com/images/logo.png";
var blob = UrlFetchApp.fetch(logo_url).getBlob().setName("logo");

--------------------

// create request and parse it as json
var response = UrlFetchApp.fetch('http://mydomain.co.il/getUsersAsJson');
var users  = Utilities.jsonParse(response.getContentText()); 

--------------------

// get url status code - check url
var statusCode = -1;
var adURL = 'http://mydomain.co.il/pageA';
try{
var response = UrlFetchApp.fetch(adURL, { muteHttpExceptions: true });
statusCode = response.getResponseCode();      
Logger.log('[status %s] %s', statusCode, adURL);      
}
catch(e){
Logger.log('[exception %s] %s', e.message, adURL);      
}

======== SPREADSHEET ================================================================
* more info : https://developers.google.com/apps-script/reference/spreadsheet/

getActiveSheet() // return the active sheet
getSheets() // return an array of sheets

OPEN BY URL
-----------
we can work on a shared spreadsheet which NOT located within our drive using the openByUrl

structure:
Spreadsheet SpreadsheetApp.openByUrl([filePath]);

example:
var filePath = 'https://docs.google.com/spreadsheets/d/1NcAAEoIaMbM7Pw0XNr2K-4U5SYPKhfDMp0GjUIfsujo/edit#gid=946751041';
var sheet = SpreadsheetApp.openByUrl(filePath).getActiveSheet();
Logger.log(sheet.getRange('A1').getValue());

OPEN BY ID
----------
structure:
Spreadsheet openById([id]);

SHEET
-----
* activate()
* appendRow(row)  // see 'ADD ROW AT INDEX'
* autoResizeColumn(col_index)
* clear()
* clear(options)
* clearContents()
* deleteColumn(col_index)
* deleteColumns(col_index, Quantity)
* deleteRow(row_index)
* deleteRows(row_index, Quantity)
* getLastColumn()
* getLastRow()
* getName()
* getCharts()
* getParent()
* getRange(string) // 'A1:A8', 'B1:D3' etc.         
* getRange(row, column) 
* getRange(row, column, row, column)
* getValues() 
* getLastColumn()
* getLastRow() 
* getRange(string) 
* insertChart(chart)
* insertColumnAfter(col_index)
* insertColumnBefore(col_index)
* insertColumns(col_index)
* insertColumns(col_index, Quantity)
* insertColumnsAfter(col_index, Quantity)
* insertColumnsBefore(col_index, Quantity)
* insertImage(url, col_index, row_index)
* insertImage(url, col_index, row_index, left, top)
* insertRowAfter(row_index)
* insertRowBefore(row_index)
* insertRows(row_index)
* insertRows(row_index, Quantity)
* insertRowsAfter(row_index, Quantity)
* insertRowsBefore(row_index, Quantity)
* removeChart(chart)
* setColumnWidth(col_index, width)
* setName(name)
* sort(col_index)
* sort(col_index, ascending)
* insertSheet(sheet_name)

full : https://developers.google.com/apps-script/reference/spreadsheet/sheet

CREATE NEW
----------
* in order to create new spreadsheet for exporting reports we'll use 'create()' method of the 'SpreadsheetApp' class
  - SpreadsheetApp.create([sheetName])
  - parameters : [sheetName] string
* example : 
  var spreadsheet = SpreadsheetApp.create("My Report");
  var sheet = spreadsheet.getActiveSheet(); 

GET RANGE BY NAME
-----------------
// get all cells in A1 to A8 (A1, A2, A3 .... A8)
var range = sheet.getRange('A1:A8');    

// get all cells in A1 to B3 (A1, A2, A3, B1, B2, B3)
var range = sheet.getRange('A1:B8');    

// get all cells in A1 to D1 (A1, B1, C1, D1)
var range = sheet.getRange('A1:D1');    

CLEAR SHEET
-----------
function clear(format, contents){
	format = format || false; // clear formats
	contents = contents || true; // clear contents
	       
	sheet.clear({ formatOnly: format, contentsOnly: contents }); 
    
	// clear embeded charts   
	var charts = sheet.getCharts();
	for (var i in charts)
		_sheet.removeChart(charts[i]);
}


DATA UI
-------
we can add some basic UI to the sheet data (font, color, background etc.)
all those UI capabilities apply via the Range entity (use sheet.getRange method to get selected range)

e.g:
var range = _sheet.getRange('A1:A8');       

range.setBackground('#F5F6F9');       
range.setFontColor('#000000');       
range.setFontSize(20);       
range.setHorizontalAlignment('center');

EXPORT DATA
-----------
* to fill a spreadsheet with report data we'll use 'exportToSheet()' method of the report
  - report.exportToSheet([sheet])
  - parameters : [sheet] SpreadsheetApp.Sheet   
* example :
  var spreadsheet = SpreadsheetApp.create("My Report");
  var sheet = spreadsheet.getActiveSheet(); 
  var report = AdWordsApp.report("SELECT Clicks, Impressions FROM ACCOUNT_PERFORMANCE_REPORT DURING LAST_MONTH");
  report.exportToSheet(sheet);

GET URL
-------
* when creating new spreadsheet, it creates on google docs 
  to receive the doc unique url use the method 'getUrl()' of the created spreadsheet object
  e.g : 
  var spreadsheet = SpreadsheetApp.create("My Report");
  // code ...
  spreadsheet.getUrl();

GET ROW/CELL
------------
* sheet.getRange(row, column) // return range (specific cell)
* sheet.getRange(row, column, row, column) // return range (range cells)
* range.getValues() // return the range values
* sheet.getLastColumn() // return the last column index
* sheet.getLastRow() // return the last row index
* sheet.getRange(string) // return range by cell location on sheet ('C5', 'A1', 'A1:E1' etc.) 

DATA VALIDATION
---------------
// TODO
SpreadsheetApp.newDataValidation()

ADD IMAGE
---------
// from blob
// note! see also 'CHART AS BLOB'
function addImageFromURL(blob, rowPosition, columnPosition, top, left){ 
	top = top || 0;
	left = left || 0;
       
	sheet.insertImage(blob, rowPosition, columnPosition, left, top);
} 

// from URL
function addImageFromURL(url, rowPosition, columnPosition, top, left){ 
	top = top || 0;
	left = left || 0;
       
	sheet.insertImage(url, rowPosition, columnPosition, left, top);
} 

example:

var imageURL = 'https://developers.google.com/adwords/scripts/images/reports.png';

// using UrlFetchApp to fetch an image as blob
var response = UrlFetchApp.fetch(imageURL);
var binaryData = response.getContent();
var blob = Utilities.newBlob(binaryData, 'image/png', 'MyImageName');
addImageFromURL(blob, 1, 1);

// add image from url
addImageFromURL(imageURL, 1, 1);

CELL FORMAT
-----------
// number
function setNumberFormat(strRange){
    setFormat(strRange, '0');       
}

// decimal
function setDecimalFormat(strRange){
    setFormat(strRange, '0.00');
}

// currency $
function setCurrencyFormat(strRange){
	// e.g: setCurrencyFormat('A1'); // set cell
	// e.g: setCurrencyFormat('A1:A10'); // set range
       
	setFormat(strRange, '$0.00');
}

// percentage
function setPercentageFormat(strRange){
    // e.g: setPercentageFormat('A1'); // set cell
    // e.g: setPercentageFormat('A1:A10'); // set range
        
    setFormat(strRange, '0.00%');
}

// formula
function setCellFormula(formula, strCell){
	// e.g: setCellSumFormula('=B3-C3', 'D3');     
	// e.g: setCellSumFormula('=if($B3 = 0, 0, ($C3-$B3)/$B3)', 'D3:D9');    
        
	var cell = _sheet.getRange(strCell);
	cell.setFormula(formula);
} 

var function setFormat(strRange, format){
    var range = sheet.getRange(strRange);
    range.setNumberFormat(format);  
}

CELL AS FORMULA
---------------
// SUM formula
function setCellSumFormula(strRange, strCell){
	// e.g: setCellSumFormula('A1:A10', 'B1'); 
	// set SUM value of cells A1 to A10 to cell B1
       
	var cell = _sheet.getRange(strCell);
	cell.setFormula('=SUM(' + strRange + ')');
}

DRAW EMBEDDED CHART
-------------------
* see 'CHARTS'
  see 'CHART SERVICE'
  see 'USING THE CHART SERVICE'


WRITE TO SHEET
--------------
* get row or cell (see 'GET ROW/CELL')
* use setValue() to set the cell content

* example : // set cell B4 value to be 'ROBY'
  sheet.getRange('B4').setValue('ROBY'); 

* example : // set all cells in range A1 to E1 background to green(#8f8)
  sheet.getRange("A1:E1").setBackground("#8f8");

* example : // add row
  sheet.appendRow(['A', 'B', 'C', 1, 2, 3, 4.4, 5.5]);  // see 'ADD ROW AT INDEX'

ADD ROW AT INDEX
----------------
note! best practice, DO NOT use appendRow

function addRow(arrValues){ 
	addRowAtIndex(arrValues, sheet.getLastRow() + 1);
}

function addRowAtIndex(arrValues, rowIndex){               
	rowIndex = rowIndex || sheet.getLastRow() + 1;
	var range = sheet.getRange(rowIndex, 1, 1, arrValues.length);
	range.setValues([arrValues]);
}

READ SHEET
----------
* get row or cell (see 'GET ROW/CELL')
* use getValues() to get the range values
* use indexes to get the values content

* example : // print the first row, second column value
  var range = sheet.getRange(1, 2); (B1)
  
  var values = range.getValues(); 
  Logger.log(values[0][0]); 

* example : // print column 3 within rows 1-7 (C1 - C7)
  var range = sheet.getRange(1, 3, 7, 3);
  
  var values = range.getValues();
 
  
  for(r in values)
    
   for(c in values[r])
      
     Logger.log(values[r][c])

* example : // print all values from row 1, column 1 till row 7, column 3 (A1 - C7)
  var range = sheet.getRange(1, 1, 7, 3);
  
  var values = range.getValues();
 
  
  for(r in values)
    
   for(c in values[r])
      
     Logger.log(values[r][c])

* example :
  var value = sheet.getRange(rowIndex, columnIndex).getValue();


STRUCTURE
---------
function main() {
  var sheet = GetSheet('TEST_SHEET');
  
  var row_index = GetRowIndexByValue(sheet, 2, 'ROBY');

  if(row_index == -1)
    row_index = Add(sheet, {id: 1, name: 'ROBY'});
  
  var created_date = Get(sheet, row_index, 3);
  Update(sheet, row_index, 2, 'ROBY COHEN');
}

function GetSheet(FILE_NAME){
  var data_file = null;
  var temp = DriveApp.getFilesByName(FILE_NAME);
  var fileExists = temp.hasNext();

  // file does not exists - create new
  if(!fileExists){
    Logger.log('CREATE ' + FILE_NAME);
    var spreadsheet = SpreadsheetApp.create(FILE_NAME);
    return spreadsheet.getActiveSheet();
  }

  // file exists - load it
  Logger.log('LOAD ' + FILE_NAME);
  data_file = temp.next();
  var spreadsheet = SpreadsheetApp.openById(data_file.getId());
  return spreadsheet.getActiveSheet();  
}

function GetRowIndexByValue(sheet, column_index, value){
  var rows = sheet.getDataRange().getValues();
 
  for(row in rows)
    if(rows[row][column_index - 1] == value)
      return parseInt(row) + 1;
  return -1;   
}

function Get(sheet, row_index, column_index){
  return sheet.getRange(row_index, column_index).getValue();
}

function Update(sheet, row_index, column_index, value){
  sheet.getRange(row_index, column_index).setValue(value);
}

function Add(sheet, values){
  var last_row = parseInt(sheet.getLastRow());
  sheet.appendRow([values.id, values.name, new Date()]);  // see 'ADD ROW AT INDEX'
  return last_row + 1;
}

DATA TO SHEET
-------------
// SaveToSheet - save data to spreadSheet - multiple sheets
// take arrays of data and save each into its own sheet
function SaveDataToSheet(arrKW, arrGroups, arrCampaigns){  
  Logger.log('Save Data To Sheet ...');
  
  var spreadSheetName = SHEET_NAME.concat(' ', HELPER.dateFormat(new Date()));  
  var spreadSheet = SpreadsheetLoader.createSpreadSheetService(spreadSheetName);
  
  // SHEETS
  var sheetA = spreadSheet.sheets[0];
  sheetA.setName('Keywords');
  var sheetB = spreadSheet.addNewSheet('AdGroups');
  var sheetC = spreadSheet.addNewSheet('Campaigns');  
  
  // UI
  // backgroundColor, foreColor, fontSize, hAlign, fontWeight, border /* { color, style } */, vAlign
  sheetA.setDataUI('A1:B1', '#04465e', '#FFFFFF', null, 'center', 'bold', null, 'middle');
  sheetB.setDataUI('A1:B1', '#04465e', '#FFFFFF', null, 'center', 'bold', null, 'middle');
  sheetC.setDataUI('A1:B1', '#04465e', '#FFFFFF', null, 'center', 'bold', null, 'middle');
  
  if(arrKW.length > 0)
  {
    sheetA.addRowAtIndex(['name', 'quality Score']); 
    for(var i=0;i<arrKW.length;i++)
      sheetA.addRowAtIndex([arrKW[i].text, arrKW[i].qualityScore]); 
  }
  
  if(arrGroups.length > 0)
  {
    sheetB.addRowAtIndex(['name', 'quality Score']);
    for(var i=0;i<arrGroups.length;i++)
      sheetB.addRowAtIndex([arrGroups[i].text, arrGroups[i].qualityScore]); 
  }
  
  if(arrCampaigns.length > 0)
  {
    sheetC.addRowAtIndex(['name', 'quality Score']);
    for(var i=0;i<arrCampaigns.length;i++)
      sheetC.addRowAtIndex([arrCampaigns[i].text, arrCampaigns[i].qualityScore]); 
  }
} 

USING
-----
* open spreadsheet by id
  var spreadsheet = SpreadsheetApp.openById([spreadsheet_id]);

* get specific sheet by name
  var data = SpreadsheetApp.openByUrl([spreadsheet_url]).getSheetByName([spreadsheet_name]).getDataRange().getValues();

* create new spreadsheet
  var spreadsheet = SpreadsheetApp.create([Name]);

* get sheet (active)
  var sheet = spreadsheet.getActiveSheet();

* print sheet values

  function Print(){
	  var rows = sheet.getDataRange().getValues();
  
	  for(row in rows)
	  {
		var s_row = '';
		for(col in rows[row])
		  s_row += rows[row][col] + '\t';
		Logger.log(s_row);
	  }
   }

*  get row index by specific value

   function GetRowIndex(columnIndex, key){
	  var rows = _sheet.getDataRange().getValues();
 
       // row index is 0 based but range is 1 based
       for(row in rows)
         if(rows[row][columnIndex - 1] == key)
           return parseInt(row) + 1;
       return -1;  
   }


*  get row index by 2 specific values

   function GetRowIndexBy2Columns(columnAIndex, keyA, columnBIndex, keyB){
	var rows = _sheet.getDataRange().getValues();
 
       // row index is 0 based but range is 1 based
       for(row in rows)
         if(rows[row][columnAIndex - 1] == keyA && rows[row][columnBIndex - 1] == keyB)
           return parseInt(row) + 1;
       return -1; 
   }
 
* add new column + set its title  
 
  function AddColumn(title){
	  var last_column = parseInt(sheet.getLastColumn());
	  sheet.insertColumnAfter(last_column);
	  var current_column = last_column++;
	  UpdateColumn(0, current_column, title); // call our UpdateColumn method (see below)
	  return current_column;
  }

* update specific column

  function UpdateColumn(row_index, column_index, value){
	  //Logger.log(row_index + 'x'+column_index+' ' + value);
	  sheet.getRange(row_index, column_index).setValue(value);
  }

* clear spreadsheet content

  sheet.clearContents();

* Add data validation rule

  var cell = sheet.getRange('A1');
  var rule = SpreadsheetApp.newDataValidation()
     .requireNumberBetween(1, 100)
     .setAllowInvalid(false)
     .setHelpText('Number must be between 1 and 100.')
     .build();

  cell.setDataValidation(rule);

* get the last row/column/cell

  var lastRow = sheet.getLastRow();
  var lastColumn = sheet.getLastColumn();
  var lastCell = sheet.getRange(lastRow, lastColumn);

* insert image 
  
  var response = UrlFetchApp.fetch('....reports.png');
  var binaryData = response.getContent();

  var blob = Utilities.newBlob(binaryData, 'image/png', 'MyImageName');
  sheet.insertImage(blob, 1, 1);

* make a copy of a spreadsheet

  var spreadsheet = SpreadsheetApp.openByUrl(SPREADSHEET_URL);
  var newSpreadsheet = spreadsheet.copy('Copy of ' + spreadsheet.getName());

* using example:

  while (keywords.hasNext()) {
    var keyword = keywords.next();
    
    var text = keyword.getText();
    var score = keyword.getQualityScore();
    var adgroup = keyword.getAdGroup().getName();
    var key = keyword.getId();
    
    //var message = '"' + text + '"' + ' score ' + score;
    //Logger.log(message);
    
    var row_index = GetMatchRowIndex(key);

    if(row_index == -1) // no match
      row_index = AddRow(key, adgroup, text);
    UpdateColumn(row_index, column_index, score);
  }

* get column values

   var values = [];      
   var range = _sheet.getRange(1, 1, _sheet.getLastRow() - 1, 1).getValues(); // A Column (A1:Ax)
   for(r in range)
     for(c in range[r])
        values.push(range[r][c])
  

* create a new spreadsheet and move it to a specific folder 
  var root_folder = DriveApp.getRootFolder();
  var folder = root_folder.getFoldersByName('TEST').next(); 
  
  var spreadsheet = SpreadsheetApp.create('blabla');
  for(var i=0;i<500000; i++); // delay

  var file = root_folder.getFilesByName('blabla').next();
  folder.addFile(file);
  root_folder.removeFile(file);

* load spreadsheet from specific folder 
  var root_folder = DriveApp.getRootFolder();
  var folder = root_folder.getFoldersByName('TEST').next(); 

  var file = folder.getFilesByName('blabla').next();

  var spreadsheet = SpreadsheetApp.open(file);


var sheetCellFormats = {
	// number
	setNumberFormat: function(sheet, strRange){
		// e.g: setNumberFormat('A1'); // set cell
		// e.g: setNumberFormat('A1:A10'); // set range

		this.setFormat(sheet, strRange, '0'); 
	},
	// decimal
	setDecimalFormat: function(sheet, strRange){
		// e.g: setDecimalFormat('A1'); // set cell
		// e.g: setDecimalFormat('A1:A10'); // set range

		this.setFormat(sheet, strRange, '0.00');
	},
	// currency $
	setCurrencyFormat: function (sheet, strRange){
		// e.g: setCurrencyFormat('A1'); // set cell
		// e.g: setCurrencyFormat('A1:A10'); // set range

		this.setFormat(sheet, strRange, '$0.00');
	},
	// percentage
	setPercentageFormat: function (sheet, strRange){
		// e.g: setPercentageFormat('A1'); // set cell
		// e.g: setPercentageFormat('A1:A10'); // set range

		this.setFormat(sheet, strRange, '0.00%');
	},
	// formula
	setCellFormula: function(sheet, formula, strCell){
		// e.g: setCellSumFormula('=B3-C3', 'D3'); 
		// e.g: setCellSumFormula('=if($B3 = 0, 0, ($C3-$B3)/$B3)', 'D3:D9'); 

		var cell = sheet.getRange(strCell);
		cell.setFormula(sheet, formula);
	},
	setFormat: function(sheet, strRange, format){
		var range = sheet.getRange(strRange);
		range.setNumberFormat(format); 
	}
};


======== MY HELPER ====================================================================

var HELPER = {
  replaceALL: function (value, toReplace, replacement) {
    return value.split(toReplace).join(replacement);
  },
  forEachProperty: function(o, callback){
  	for(var prop in o) 
      if(o.hasOwnProperty(prop))
        callback.call(o, prop);
  },  
  foreach: function (arr, callback) {
    if (!(arr instanceof Array)) return;
    for (var i = 0; i < arr.length; i++)
      callback(arr[i]);
  },
  HTML2PDF: function(strHtml, pdfName){
    var blob = Utilities.newBlob(strHtml, MimeType.HTML);
    var pdf = blob.getAs(MimeType.PDF);  
    pdf.setName(pdfName);
    return pdf
  },
  containsLabel: function (labelName) { // call
    return this.labels()
    .withCondition('Name = "' + labelName + '"')
    .get()
    .hasNext();
  },
  generateRandomId: function(){
    var result = '';
    for(var i=0;i<8;i++)
      result = result.concat(Math.round(Math.random() * 9));
    return result;
  },
  dateSignature: function (date){
    var year = date.getFullYear().toString();
    var month = (date.getMonth()+1).toString();
    
    if(month.length == 1) month = '0' + month; 
    
    return parseInt(year + month); // return yyyyMM as int
  },
  dateDiff: function (date1, date2) {
    var datediff = date1.getTime() - date2.getTime(); 
    return parseInt(datediff / (24*60*60*1000));
  },
  dateFormat: function (date){
    var year = date.getFullYear().toString();
    var month = (date.getMonth() +1).toString();
    var day = date.getDate().toString();
    
    if(month.length == 1) month = '0' + month; // return yyyyMMdd
    if(day.length == 1) day = '0' + day;
    
    return year + month + day;
  }, 
  getTheNextSunday: function(date){
    var newDate = new Date(date.getTime()); 
    
    var numOfweekDays = 7;         
    if(newDate.getDay() > 0)
      newDate.setDate(newDate.getDate() + (numOfweekDays - newDate.getDay()));
    return newDate;  
  },
  getThePreviousSunday: function(date){
    var newDate = new Date(date.getTime());                    
    newDate.setDate(newDate.getDate() - newDate.getDay());
    return newDate;  
  },
  dateAdd: function(date, value, type){      
    type = type || 'dd';
    
    var newDate = new Date(date.getTime());
    
    if(type == 'dd')
      newDate.setDate(newDate.getDate() + value);
    else if(type == 'MM')
      newDate.setMonth(newDate.getMonth() + value);
    
    return newDate;  
  }, 
  generateRange: function(daysFrom, daysTo){
	var to = new Date();
	to.setDate(to.getDate() + daysTo);
  
    var from = new Date();
	from.setDate(from.getDate() + daysFrom);
  
	return this.dateFormat(from) + ',' + this.dateFormat(to);
  },
  getFirstDayOfMonth: function(date){
    var newDate = new Date(date.getTime());
    newDate.setDate(1);
    return newDate;  
  },
  getLastDayOfMonth: function(date){
    var newDate = new Date(date.getYear(), date.getMonth() + 1, 1);
    newDate.setDate(newDate.getDate() - 1); // decrease one day from the first on the following month
    return newDate;  
  }, 
  dateName: function(date){
    // toDateString() -> Mon Feb 29 2016
    var arrDateParts = date.toDateString().split(' '); 
    return arrDateParts[1] + ' ' + arrDateParts[2];  // Feb 29
  },
  monthName: function(date){
    // toDateString() -> Mon Feb 29 2016
    var arrDateParts = date.toDateString().split(' '); 
    return arrDateParts[1] + ', ' + arrDateParts[3];  // Feb, 2016
  },
  parseDate: function(strDate){ 
	// strDate: yyyy-MM-dd
    var arrDateParts = strDate.split('-');
    return new Date(arrDateParts[0], parseInt(arrDateParts[1], 10) - 1, arrDateParts[2]);
  }, 
  toPercentageFormat: function(value){    
    return (value * 100).toFixed(2).toString() + '%';
  }
};

// using
var target_start_time = ... 
var target_end_time = ... 
var target_dateRange = HELPER.dateFormat(target_start_time).concat(',', HELPER.dateFormat(target_end_time)); 

// result e.g:
'20150801,20150831'

-----

HELPER.foreach(['AAA', 'BBB', 'CCC'], function(item){
	// code ...
});

======== MCC ========================================================================

using the MccApp to switch between accounts 
after setting the active account you can work the same way as you did originally: 
MccApp.select(account); 
ProcessAccount();

note! 
another approach is to use the managerAccount object and send it to an outer method 
ProcessAccount(account);
partial using! only when working on the account stats, there's no access from the account to all the entities (keywords, adgroups etc.)
    

e.g:
var account = MccApp.accounts().withIds(['123-456-7890']).get().next();
MccApp.select(account); // set active account 
var keywords = AdWordsApp.keywords().get(); // get keywords of account 123-456-7890


Labels
------
// create a new label on the MCC level
MccApp.createAccountLabel([labelName]);

// apply the label on a specific managed account
account.applyLabel([labelName]);    

isMCC Account
-------------
function isMCC(account_id){
  var accounts = MccApp.accounts()
  .withCondition('ManagerCustomerId = "' + account_id + '"')
  .withLimit(1)
  .get();
  
  var isMcc = false;
  var accountsQuantity = accounts.totalNumEntities();
  if(accountsQuantity > 1)
	isMcc = true;
  
  if(accountsQuantity == 1)	// handle mcc with a single account	
    isMcc = account_id != accounts.next().getCustomerId();

  return isMcc;
}

using:
var account_ids = ['515-135-0007', '964-232-8471', '896-472-5579'];
  
for(var i=0; i< account_ids.length; i++)
{
    var account_id = account_ids[i];
    Logger.log('isMCC: %s', isMCC(account_id));
}

Accounts Hirarchy
-----------------
it can be a status of mcc root account which contains a child mcc accounts (in addition to the regular child accounts). 
in order for us to difference between the two, we need to use the MccApp.accounts alongside with the account id - 
regular account will return a single managedAccount which represent itself while MCC account will return all its child accounts (without itself included)
so, basically - if a single account is return - this is a regular account and if at least 2 childs return - its an MCC 

note! 
if the account is an MCC with a single account - only one account will return but it's CustomerId will not match the sending account id filter!

remember!
the MccApp.accounts() clause returns all the child accounts and all the mcc child accounts exists but without the mcc themselves! 
 
e.g:
// mcc account - return all child accounts
var accounts = MccApp.accounts().withCondition('ManagerCustomerId = "964-232-8471"').get();  

// regular account - return a single account - itself
var accounts = MccApp.accounts().withCondition('ManagerCustomerId = "515-135-0007"').get();  

--------

// print accounts + child accounts of an MCC accounts
function main() { 
  var account_ids = ['515-135-0007', '964-232-8471', '896-472-5579'];
  
  for(var i=0; i< account_ids.length; i++)
  {
    var account_id = account_ids[i];
    execute(account_id);
  }
}

function execute(account_id){  
var accounts = MccApp.accounts()
  .withCondition('ManagerCustomerId = "' + account_id + '"')
  .get();  
  
  var numOfAccounts = accounts.totalNumEntities();
  var isMcc = numOfAccounts > 1;
  
  if(isMcc)
    Logger.log('MCC account: #%s - %s child accounts', account_id, numOfAccounts);
  
  while (accounts.hasNext()) {
    var account = accounts.next();
    MccApp.select(account);
    Logger.log('#%s %s', account.getCustomerId(), account.getName());  
  }
  
  Logger.log('---------------------')
}


USING
-----
var accounts = MccApp.accounts().get();
while (accounts.hasNext()) {
	var account = accounts.next();
	MccApp.select(account); // set the active account 
	Logger.log(account.getCustomerId());

	var stats = account.getStatsFor('ALL_TIME');
	var impressions = stats.getImpressions();
	var clicks = stats.getClicks();
	Logger.log('impressions: ' + impressions + ', clicks: ' + clicks);   
}

-------

// get mcc accounts by labels
var accounts = MccApp.accounts()
      .withCondition("LabelNames CONTAINS 'MyAccount'")
      .get();

  while (accounts.hasNext()) {
    var account = accounts.next();
    var accountName = account.getName() ? account.getName() : '--';
    Logger.log('%s,%s', account.getCustomerId(), accountName);
  } 

======== PARALLEL ===================================================================
TODO ...
// executeInParallel

======== RADIUS =====================================================================

// add proximity to campaign
campaign.addProximity([lat], [lng], [radius], [radius Units]);
campaign.addProximity([proximity]);

[proximity] object - { latitude, longitude, radius, radiusUnits, bidModifier, address }

// e.g: 30 km around the latitude/longitude 
campaign.addProximity(37.423021, -122.083739, 30, "KILOMETERS");

// e.g: 10 km around the latitude/longitude 
campaign.addProximity({
	latitude: 37.423021,
		  longitude: -122.083739,
		  radius: 10,
		  radiusUnits: 'KILOMETERS',
		  bidModifier: 0.75,
		  address: {
			streetAddress: '1600 Amphitheatre Parkway',
			cityName: 'Mountain View',
			provinceName: 'California',
			provinceCode: 'CA',
			postalCode: '94043',
			countryCode: 'US'
		  }
});

---

// get all campaign proximities (radius)
var proximities = campaign.targeting().targetedProximities().get();

// e.g:
var campaigns = AdWordsApp.campaigns().withCondition('Name CONTAINS "#"').get();
while (campaigns.hasNext()) {
	var campaign = campaigns.next();
	Logger.log('campaign: ' + campaign.getName());    
    
	var proximities = campaign.targeting().targetedProximities().get();
	while (proximities.hasNext()) {
		var proximity = proximities.next();       
		Logger.log('%s %s radius from lat %s, lng %s', proximity.getRadius(), proximity.getRadiusUnits(), proximity.getLatitude(), proximity.getLongitude());
	}
}

======== TARGET LOCATION ============================================================

// add location to campaign
campaign.addLocation([location]);

location ids:
https://developers.google.com/adwords/api/docs/appendix/geotargeting
use the filter above to get the required criteria id 
e.g: filter: Country Code = US + Target Type = Country -> criteria id 2840

// e.g: united states -> id 2840 (Criteria ID)
campaign.addLocation({ id: 2840 });

---

// get all campaign locations 
var locations = campaign.targeting().targetedLocations().get();

// e.g:
var campaign = AdWordsApp.campaigns().withCondition('Name = "TEST"').get().next();
var locations = campaign.targeting().targetedLocations().get();
while(locations.hasNext()){
	var location = locations.next();
	Logger.log('id: %s, name: %s, code: %s', location.getId(), location.getName(), location.getCountryCode())
}

// e.g:
var campaigns = AdWordsApp.campaigns().withCondition('Name CONTAINS "#"').get();
while (campaigns.hasNext()) {
	var campaign = campaigns.next();
	Logger.log('campaign: ' + campaign.getName());    
    
	var locations = campaign.targeting().targetedLocations().get();
	while (locations.hasNext()) {
		var location = locations.next();       
		Logger.log('country code: %s, location name: %s', location.getName(), location.getCountryCode());
	}
}

// remove location
[location].remove();

// e.g:
var targetedLocations = AdWordsApp.targeting().targetedLocations().withIds([[campaign.getId(), 2250]]).get();
if (targetedLocations.hasNext) {
    targetedLocations.next().remove();
}

======== SHOPPING CAMPAIGNS =========================================================
https://developers.google.com/adwords/scripts/docs/features/shopping-campaigns

Logger.log('# Shopping Campaings #');
  var shoppingCampaigns = AdWordsApp.shoppingCampaigns().get();
  while(shoppingCampaigns.hasNext()){
    Logger.log(shoppingCampaigns.next().getName());
  }
  
  Logger.log('# Campaings #');
  var campaigns = AdWordsApp.campaigns().get();
	  while(campaigns.hasNext()){
		Logger.log(campaigns.next().getName());
	  }

======== VIDEO CAMPAIGNS ============================================================
https://developers.google.com/adwords/scripts/docs/features/video-campaigns
https://developers.google.com/adwords/scripts/docs/reference/adwordsapp/adwordsapp_videocampaign

Logger.log('# Video Campaings #');
  var videoCampaigns = AdWordsApp.videoCampaigns().get();
  while(videoCampaigns.hasNext()){
    Logger.log(videoCampaigns.next().getName());
  }
  
  Logger.log('# Campaings #');
  var campaings = AdWordsApp.campaigns().get();
  while(campaings.hasNext()){
    Logger.log(campaings.next().getName());
  }

======== BULK UPLOADS ===============================================================

uploads location:
-----------------
you can find your bulks uploads under 'Bulk operations' -> 'Bulk uploads'

note: 
ASYNC upload - can't access the uploaded values immediately!

CsvUpload
---------
* structure:	
  // this function returns a CsvUpload object
  CsvUpload AdWordsApp.bulkUploads().newCsvUpload([columns], [options]);
  - [columns] // array of column names (see 'supported entities')
  - [options] // options     

* options:
  - moneyInMicros // (bool) represent money in micros (1370000) or currency (1.37)

* CsvUpload:
  - append([row]) // append a row to the bulk upload (see 'supported entities')
  - apply() // upload the file and applies the changes  
  - preview() // upload the file and preview the changes
  - setFileName([name]) // set the uploaded file name 
  - forOfflineConversions() // specifies that this upload is used for reporting offline conversions.
  - forCampaignManagement() // (default) specifies that this upload is used for entity changes 

* source:
  https://developers.google.com/google-ads/scripts/docs/features/bulk-upload
  

*  supported entities
  - more info: 
    https://developers.google.com/adwords/scripts/docs/features/bulk-upload-entities

  - campaign
    'Campaign' // campaign name
	'Campaign ID'
	'Campaign state' // 'enabled' etc.
	'Budget'
	'Bid Strategy type' // 'cpc' etc.
	'Campaign type' // 'Search Only' etc.

* using:
  var columns = [
    'Campaign', 'Budget', 'Bid Strategy type', 'Campaign type'
  ];

  var upload = AdWordsApp.bulkUploads().newCsvUpload(
      columns, {moneyInMicros: false});

  upload.append({
    'Campaign': 'TEST CAMPAIGN',
    'Budget': 200,
    'Bid Strategy type': 'cpc',
    'Campaign type': 'Search Only'
  });
  
  upload.apply();


FileUpload
----------
* structure:	
  // this function returns a FileUpload object
  FileUpload AdWordsApp.bulkUploads().newFileUpload([sheet|blob|file], [options]);

// TODO ...

======== ADVANCED APIs ==============================================================

APIs
----
* Google Analytics
* Google BigQuery
* YouTube and YouTube Analytics
* Google Calendar
* Google Tasks
* Google Prediction

Enable APIs
-----------
* enter script mode 
* click on the 'Advanced APIs' button near the PREVIEW button
* check the APIs to enable 
* (if needed) click on the 'Google Developers Console' link in order to also enable those APIs in the developer console
  in the developer console - enable the APIs
* save

note! 
after enabled the APIs - there'll be new services available within the script (plus auto-complete)

reference
---------
https://developers.google.com/apps-script/advanced/analytics
https://developers.google.com/apps-script/advanced/bigquery
https://developers.google.com/apps-script/advanced/calendar
https://developers.google.com/apps-script/advanced/prediction
https://developers.google.com/apps-script/advanced/tasks
https://developers.google.com/apps-script/advanced/youtube
https://developers.google.com/apps-script/advanced/youtube-analytics

Analytics
---------

examples:

// accounts list
var accounts = Analytics.Management.Accounts.list().items;
for(var i = 0; i< accounts.length; i++)
Logger.log('%s -> %s', accounts[i].id, accounts[i].name);
  
// web properties list
var accountId = '73003810';   
var properties = Analytics.Management.Webproperties.list(accountId).items;
for(var i = 0; i< properties.length; i++)
Logger.log('%s -> %s', properties[i].id, properties[i].name);
  
// profiles list
var accountId = '73003810';   
var propertyId = 'UA-73003810-1'; // UA-73003810-1  
var profiles = Analytics.Management.Profiles.list(accountId, propertyId).items;
for(var i = 0; i< profiles.length; i++)
Logger.log('%s -> %s', profiles[i].id, profiles[i].name);
  
// number of unique visitors (users) between the specified dates
var profileId = '115623015';  
var visitors = Analytics.Data.Ga.get('ga:' + profileId, '2016-03-01', '2016-03-18', 'ga:visitors').totalsForAllResults['ga:visitors'];
Logger.log('visitors: %s', visitors);

======== TWILIO =====================================================================

// TODO 
http://www.freeadwordsscripts.com/2014/01/make-calls-and-send-text-messages-to.html

======== SERVICES ===================================================================

see 'SHEET SERVICE'
see 'SPREADSHEET SERVICE'
see 'SPREADSHEET LOADER'
see 'DRIVE SERVICE'
see 'CHART SERVICE'
see 'FORMAT SERVICE'

---

see 'HTML BUILDER SERVICE'
see 'XML SERVICE'
see 'JSON SERVICE'
see 'CSV SERVICE'
see 'COORDINATES SERVICE'
see 'REPORT SERVICE'
see 'AD MANAGER SERVICE'

---

see 'FORECAST SERVICE'
see 'JOBS SERVICE'
see 'ACCOUNT STATISTICS SERVICE'
see 'ACCOUNTS MANAGER SERVICE'
see 'CLIENT DATA SERVICE'
see 'BID CHANGES SERVICE'
see 'ACCOUNT IMPRESSIONS SERVICE'
see 'MOST EXPENSIVE KEYWORD SERVICE'
see 'KARAOKE-4-FREE SERVICE'
see 'SHOP SERVICE'
see 'INVOCA READER SERVICE'
see 'INDIEBOOK READER SERVICE'

======== MOCK =======================================================================

Mock<Report>
------------

function SearchQueryReportMock(){
	this.rows = function(){
    	return new SearchQueryReportRowsMock();
    }
}

function SearchQueryReportRowsMock() {
  var i = 0;
  
  // item: { Query, KeywordTextMatchingQuery, QueryMatchTypeWithVariant}
  var arr = [
    { Query: 'KW1', KeywordTextMatchingQuery: 'bla bla KW1 bla bla', QueryMatchTypeWithVariant: 'broad' },
    { Query: 'KW2', KeywordTextMatchingQuery: 'KW2', QueryMatchTypeWithVariant: 'exact' },
    { Query: 'KW3', KeywordTextMatchingQuery: 'KW3s', QueryMatchTypeWithVariant: 'exact (close variant)' },
    { Query: 'KW4', KeywordTextMatchingQuery: 'KW4', QueryMatchTypeWithVariant: 'exact' },
    { Query: 'KW5', KeywordTextMatchingQuery: 'bla KW5', QueryMatchTypeWithVariant: 'phrase' }
  ];

  this.next = function(){
    return arr[i++];      
  }

  this.hasNext = function(){
    return arr.length > i;
  }
} 

using:

var report = DEBUG == true ? new SearchQueryReportMock() : AdWordsApp.report(query, reportConfig); 
var rows = report.rows();
	
while (rows.hasNext()) {
	var row = rows.next();
            
	var searchQuery = row['Query'].toLowerCase();
	var keyword = row['KeywordTextMatchingQuery'];   
	var matchTypeDisplayName = row['QueryMatchTypeWithVariant'];	
}

Mock<Stats>
-----------

function statsMock(){
  return {
    getAverageCpc: function() { return 0; },
    getAverageCpm: function() { return 0; },
    getAverageCpv: function() { return 0; },
    getAveragePageviews: function() { return 0; },
    getAveragePosition: function() { return 0; },
    getAverageTimeOnSite: function() { return 0; },
    getBounceRate: function() { return 0; },
    getClicks: function() { return 0; },
    getConversionRate: function() { return 0; },
    getConversions: function() { return 0; },
    getCost: function() { return 15; },
    getCtr: function() { return 0; },
    getImpressions: function() { return 0; },
    getViewRate: function() { return 0; },
    getViews: function() { return 0; }
  }
}

using:
var stats = DEBUG ? new statsMock() : campaign.getStatsFor("ALL_TIME");  
var cost = stats.getCost();

======== EXAMPLES ===================================================================

// ads spell checker (bing api)
http://searchengineland.com/spell-check-new-expanded-text-ads-adwords-script-256914

--------------------

// Search Queries report sample
var reportConfig = {
	includeZeroImpressions: true
};  
  
var query =  
    'SELECT Query, CampaignId, KeywordId, KeywordTextMatchingQuery, Impressions, QueryMatchTypeWithVariant ' +
    'FROM SEARCH_QUERY_PERFORMANCE_REPORT ' +      
    'DURING LAST_7_DAYS';

var report = AdWordsApp.report(query, reportConfig); 
var rows = report.rows();
  
while (rows.hasNext()) {
	var row = rows.next();
        
	var keywordId = parseInt(row['KeywordId']);  // triggered keyword id
	var searchQuery = row['Query'].toLowerCase(); // actual search value
	var keyword = row['KeywordTextMatchingQuery'];  // triggered keyword text 	

	/*
		broad
		exact
		phrase
		exact (close variant)
		phrase (close variant)
	*/
	var matchTypeDisplayName = row['QueryMatchTypeWithVariant'];   // search match type    
}

--------------------

// create a negative keyword with specific matchType
function setAsNegative(campaign, negativeKeywords, matchType){
  for(i in negativeKeywords){
    var searchQuery = negativeKeywords[i];        
    Logger.log('searchQuery: %s', searchQuery);
    
    if(isNegativeKeywordExists(campaign, searchQuery, matchType))
      continue;
    
    var keywordToAdd;
    switch (matchType){
      default:
      case 'EXPANDED': 
      case 'BROAD': keywordToAdd = searchQuery;        
        break;
      case 'NEAR_EXACT': 
      case 'EXACT': keywordToAdd = '[' + searchQuery + ']';
        break;
      case 'NEAR_PHRASE':          
      case 'PHRASE': keywordToAdd = '"' + searchQuery + '"';
  	}
    
    Logger.log('create %s as negative keyword', keywordToAdd);
    
    if(DEBUG == false)
    	campaign.createNegativeKeyword(keywordToAdd);
  } 
}

--------------------

// load campaigns by label name
function loadCampaignsByLabel(labelName){  
  var campaigns = [];
  
  var campaignsIter = AdWordsApp.campaigns()
      .withCondition('LabelNames CONTAINS_ANY ["' + labelName + '"]')
      .withCondition('Status = ENABLED')
      .get();
  
  while(campaignsIter.hasNext()) 
    campaigns.push(campaignsIter.next());  
  return campaigns;
}

--------------------

// check if the specified keyword exists as negative in the provided campaign
function isNegativeKeywordExists(campaign, keywordText, keywordMatchType){
	return campaign.negativeKeywords()
      .withCondition('Text = "' + keywordText + '"')
      .withCondition('KeywordMatchType = ' + keywordMatchType)
      .get()
      .hasNext();
}

--------------------

// matchType mapping table
var matchTypeMappingTable = {};
matchTypeMappingTable['BROAD'] = 'broad';
matchTypeMappingTable['EXACT'] = 'exact';
matchTypeMappingTable['EXPANDED'] = 'broad';
matchTypeMappingTable['PHRASE'] = 'phrase';
matchTypeMappingTable['NEAR_EXACT'] = 'exact (close variant)';
matchTypeMappingTable['NEAR_PHRASE'] = 'phrase (close variant)';

matchTypeMappingTable.find = function(displayName){
	displayName = displayName.toLowerCase();
	for(key in this)
		if(this[key].toLowerCase() == displayName)
		return key;
	return null;
}

// using
var matchTypeDisplayName = row['QueryMatchTypeWithVariant'];
var matchType = matchTypeMappingTable.find(matchTypeDisplayName);

--------------------

// get search queries by match Types
function GetSearchQueries(campaignId, matchTypes){
  var searchQueries = [];
  
  var matchTypeMappingTable = {};
  matchTypeMappingTable['BROAD'] = 'broad';
  matchTypeMappingTable['EXACT'] = 'exact';
  matchTypeMappingTable['EXPANDED'] = 'broad';
  matchTypeMappingTable['PHRASE'] = 'phrase';
  matchTypeMappingTable['NEAR_EXACT'] = 'exact (close variant)';
  matchTypeMappingTable['NEAR_PHRASE'] = 'phrase (close variant)';
  matchTypeMappingTable.find = function(displayName){
    displayName = displayName.toLowerCase();
  	for(key in this)
      if(this[key].toLowerCase() == displayName)
        return key;
    return null;
  }

  var reportConfig = {
    includeZeroImpressions: true
  };  
  
  var query =  
      'SELECT Query, CampaignId, KeywordId, KeywordTextMatchingQuery, Impressions, QueryMatchTypeWithVariant ' +
      'FROM SEARCH_QUERY_PERFORMANCE_REPORT ' +
      'WHERE CampaignId = ' + campaignId + ' '+
      'DURING LAST_7_DAYS';
  
  var report = DEBUG == true ? new SearchQueryReportMock() : AdWordsApp.report(query, reportConfig); 
  var rows = report.rows();
	
  while (rows.hasNext()) {
    var row = rows.next();
            
    var searchQuery = row['Query'].toLowerCase();
    var keyword = row['KeywordTextMatchingQuery'];
    
	// see 'matchTypeMappingTable' for available values
    var matchTypeDisplayName = row['QueryMatchTypeWithVariant'];
    var matchType = matchTypeMappingTable.find(matchTypeDisplayName);
    
    if(!matchType || matchTypes.indexOf(matchType) == -1) 
      continue;
    
    Logger.log('searchQuery: %s', searchQuery);
    searchQueries.push(searchQuery);
  }
  
  return searchQueries;
}

--------------------

// account performance report
var report = AdWordsApp.report(
     'SELECT Date, Impressions, Clicks, ConversionRate, Conversions, ConversionValue, Cost ' +
     'FROM   ACCOUNT_PERFORMANCE_REPORT ' +
     'DURING THIS_MONTH');
  
  var rows = report.rows();
  while(rows.hasNext()){
    var row = rows.next();
    Logger.log('Clicks: %s, Conversions: %s, ConversionValue: %s, Cost: %s', row['Clicks'], row['Conversions'], row['ConversionValue'], row['Cost'])
  }

--------------------
 
// account statistics - today's impressions
  var reportConfig = {
    includeZeroImpressions: true
  };
  
  var query =  'SELECT Date, Impressions, Clicks, ConversionRate, Cost ' +
     'FROM   ACCOUNT_PERFORMANCE_REPORT ' +
     'DURING TODAY';

  Logger.log('Loading "%s" Account Statistics ...', AdWordsApp.currentAccount().getName());
  var report = AdWordsApp.report(query, reportConfig); 
  
  var rows = report.rows();
  while (rows.hasNext()) {    
    var row = rows.next();
    
    var date = row['Date'];
    var impressions = row['Impressions'];    
    Logger.log('[%s] %s', date, impressions);
  }

--------------------

// load or create a sheetService 
var sheetName = 'MySheet';
var sheetService = SpreadsheetLoader.loadSheetService(sheetName); // load   
var sheetNotExists = !sheetService;
if(sheetNotExists){
   sheetService = SpreadsheetLoader.createSheetService(sheetName); // create  
   sheetService.addRow(['Campaign', 'Adgroup', ...]); // add header 
}

--------------------

// print campaign performance report for yesterday
  var account = AdWordsApp.currentAccount();
  Logger.log('### %s ###', account.getName());
  
  var dateRange = 'YESTERDAY';
  
  var reportConfig = {
    includeZeroImpressions: true
  };
  
  var query =  'SELECT CampaignId, CampaignName, Date, Impressions, Clicks, Ctr, Cost, AverageCpc, AveragePosition, Conversions, ConversionRate, CostPerConversion ' + 
    'FROM CAMPAIGN_PERFORMANCE_REPORT ' + 
    'WHERE CampaignStatus IN [ENABLED, PAUSED] ' +    
    'DURING ' + dateRange;

  var report = AdWordsApp.report(query, reportConfig);
  var rows = report.rows();
  while(rows.hasNext()){
    var row = rows.next();
    Logger.log('[%s] %s > %s', row['Date'], row['CampaignName'], row['Impressions']);
  }

--------------------

// export a report to a new sheet 
var reportConfig = { includeZeroImpressions : 'false' };

var query = 'SELECT CampaignId, CampaignName, AdGroupName, Criteria, KeywordMatchType, CpcBid, Cost ' +
    'FROM KEYWORDS_PERFORMANCE_REPORT ' +
    'WHERE IsNegative = FALSE ' +  
    'AND CampaignId IN [' + CAMPAIGN_IDs.join(',') + '] ' + 
    'AND Status = ENABLED ' + 
    'AND AdGroupStatus = ENABLED ' +
    'AND CampaignStatus = ENABLED '; 
  
var spreadsheet = SpreadsheetApp.create("TEST Report");
var sheet = spreadsheet.getActiveSheet(); 
var report = AdWordsApp.report(query, reportConfig);
report.exportToSheet(sheet); 

--------------------

// make ads copy
var ads = adManagerService.getAdsByAdgroup(adGroup);
    if(ads.length == 0){
      Logger.log('No ads to copy!');
    }
    else {
      for(i in ads)
      {
        var ad = ads[i];
        Logger.log('copy ad: %s', ad.getHeadlinePart1());      
       
	var header1 = ad.getHeadlinePart1();
	var header2 = ad.getHeadlinePart2();
	var description = ad.getDescription();
	var destinationURL = ad.urls().getFinalUrl();
	var partURL1 = ad.getPath1();
	var partURL2 = ad.getPath2();

	adManagerService.createAd(
	  newAdGroup, 
	  header1, 
	  header2, 
	  description, 
	  destinationURL, 
	  partURL1, 
	  partURL2
	);
	 
        sheetService.addRow([
          campaignName, 
          adGroupName, 
          header1, 
          header2, 
          description, 
          partURL1, 
          partURL2, 
          destinationURL
        ]);
      }
    }

--------------------

// is label exists - account level
function IsLabelExistsInAccount(labelName){
  var labels = AdWordsApp.labels().withCondition('Name = "' + labelName + '"').withLimit(1).get();
  if(!labels.hasNext()) {
    Logger.log('label "%s" was not found!', labelName);
    return false;
  }
  
  return true;  
}

--------------------
// is label exists - adgroup level
function IsLabelExistsInAdgroup(adGroup, labelName){
  var labels = adGroup.labels().withCondition('Name = "' + labelName + '"').withLimit(1).get();
  return labels.hasNext();
}

--------------------

// attach pdf file to email
var builder = HTMLBuilderService();
builder.add('<h1>Report</h1>');

var pdfReport = builder.toPDF('Report.pdf');
MailApp.sendEmail(emails, 'PDF Report', 'ATTACHED PDF Report', {attachments: [pdfReport]});  

--------------------

// split a phrase into english and hebrew words
// see 'SHOP SERVICE'
var productName = "...... ";
var productNameEN = productName.replace(/[^a-zA-Z0-9\s]/gi, '').trim();
var productNameHE = productName.replace(/[a-zA-Z0-9]/gi, '').trim();  

--------------------

// clear extra middle spaces ('A    B C' -> 'A B C')
// see 'SHOP SERVICE'
var productName = "...... ";      
var temp = productName.split(' ');
var arrProductName = [];
for(i in temp){
	if(temp[i].trim() == '') continue;
	arrProductName.push(temp[i].trim());      
}    
            
if(arrProductNameEN.length > 1)
{
	productName = arrProductName.join(' ');
        
	keywords = keywords.concat([
		'[' + productName + ']', 
		'"' + productName + '"', 
		'+' + productName.split(' ').join('+')       
	]);
}      

--------------------

// create adgroup + ad + keywords
// also see 'AD MANAGER SERVICE'
// using       
var adGroup = CreateAdGroup(campaign, 'My AdGroup');
CreateAd(adGroup, 'productA', 'text text text', 'buy now!', 'www.example.com', 'www.example.com/productA');    
CreateKeywords(adGroup, ['productA', '[productA]', 'products', 'my product']);        


// create adgroup    
function CreateAdGroup(campaign, adGroupName){
  var adGroupBuilder = campaign.newAdGroupBuilder();
  var operation = adGroupBuilder.withName(adGroupName).build();
  
  if(!operation.isSuccessful())
    return null;
  return operation.getResult();
}

// create ad (deprecated - see example below)
function CreateAd(adGroup, header, line1, line2, displayURL, destinationURL){ 
  var operation = adGroup.newTextAdBuilder()
    .withHeadline(header) // 25 characters
    .withDescription1(line1) // 35 characters
    .withDescription2(line2) // 35 characters
    .withDisplayUrl(displayURL) // 255 characters
    .withFinalUrl(destinationURL) // 255 characters
    .build();
    
  if(!operation.isSuccessful())
    return null;
  return operation.getResult();
}

// create ad
// also see 'AD MANAGER SERVICE'
function CreateAd(adGroup, header1, header2, description, partURL1, partURL2, destinationURL){ 
  var operation = adGroup.newAd().expandedTextAdBuilder()
    .withHeadlinePart1(header1) // 30 characters
    .withHeadlinePart2(header2) // 30 characters
    .withDescription(description) // 80 characters
    .withPath1(partURL1) // 15 characters (the first part after the siteURL) e.g: http://mydomain.com/partURL1/partURL2
    .withPath2(partURL2) // 15 characters (the second part after the siteURL)
    .withFinalUrl(destinationURL) // 255 characters
    .build();
    
  if(!operation.isSuccessful())
    return null;
  return operation.getResult();
}

// create keywords
function CreateKeywords(adGroup, arrKeywods){  
  HELPER.foreach(arrKeywods, function(keyword){
    Logger.log('new keyword %s', keyword);
    adGroup.newKeywordBuilder().withText(keyword).build();
  });
}
  
var HELPER = {
  foreach: function (arr, callback) {
    if (!(arr instanceof Array)) return;
    for (var i = 0; i < arr.length; i++)
      callback(arr[i]);
  }
}

--------------------
// clear keyword text
// also see 'AD MANAGER SERVICE'
clearKeyword: function(keyword){
    var specialCharacters = ['!','@','%',',','*','(',')'];
    var maxWordsAllowed = 10;
      
    // non allowed characters
    // [error] Keywords cannot contain non-standard characters like: ! @ % , *
    for(i in specialCharacters)
    {
		var c = specialCharacters[i];
		if(keyword.indexOf(c) == -1) continue;
		keyword = keyword.split(c).join(''); // replace all
    }      
      
    // two many words
    // [error] Keywords cannot contain more than 10 words
    if(keyword.split(' ').length > maxWordsAllowed)
    keyword = keyword.split(' ').slice(0, 9).join(' '); // remove words
        
    return keyword;
}

--------------------

// update ad param + print old value
// also see 'AD MANAGER SERVICE'

var adgroup = adManagerService.getAdGroupByName(campaign, product.adGroupName);
  
var keywords = adgroup.keywords().get();
while(keywords.hasNext())
{        
	var keyword = keywords.next();
        
	var params = adManagerService.getKeywordParams(keyword);
	Logger.log('price update: %s > %s', params.length == 0 ? 'NULL' : params[0].text, product.price);
        
	adManagerService.setKeywordParams(keyword, product.price);    	
}

--------------------

/* Impressions Share */
also known as SearchImpressionShare

get
---
// read it from ADGROUP_PERFORMANCE_REPORT report 
var result = { impressionShare: 0 };

var reportConfig = {
	includeZeroImpressions: false
};
  
var query =  'SELECT AdGroupId, AdGroupName, SearchImpressionShare ' + 
    'FROM ADGROUP_PERFORMANCE_REPORT ' + 
    'WHERE CampaignStatus IN [ENABLED] ' +    
    'AND AdGroupStatus IN [ENABLED] ' +    
    'AND AdGroupId = ' + adGroup.getId() + ' ' + 
    'DURING ' + dateRange;

var report = AdWordsApp.report(query, reportConfig);
var rows = report.rows(); 
while (rows.hasNext())
{
	var row = rows.next();
    var impressionShare = row['SearchImpressionShare'];    
	...     
}

note!
if the share is less then 10%, we'll get a string value '< 10' instead of float value

// fix the '< 10' value
if(impressionShare == '< 10')
    impressionShare = ??;

---

ALL competitors impressions:
impressions/impressionsShare

my share:
totals.impressions / totals.impressionALL

source:
https://www.pmg.com/blog/calculate-impression-share/

sum all the available impressions being used from all the competitors!
knowing the quantity of my account impressions and its share from the total allows us to calculate the actual total from all adwords accounts out there
formula: impressions/impressionsShare 

e.g: if my impressions quantity is 5 and it serves 0.5% share from the total then 5 / 0.5 = 10 (the total impressions for ALL was 10 impressions!)
note! totals.impressions / totals.impressionALL will give us the average share 
totals.impressionALL += stats.getImpressions() / extendedData.impressionShare; 

totals.impressions / totals.impressionALL will give us the average share 
totals.impressionShare = totals.impressionALL == 0 ? 0 : (totals.impressions / totals.impressionALL).toFixed(2);  

--------------------

Type: 
QualityScoreBucket

Enum:
UNKNOWN
BELOW_AVERAGE  // Below average
AVERAGE  // Average
ABOVE_AVERAGE  // Above average

Metrics:
CreativeQualityScore // ad relevance
SearchPredictedCtr // expected CTR
PostClickQualityScore // landing page experience

e.g:
  var query = 'SELECT Id, Criteria, KeywordMatchType, QualityScore, SearchPredictedCtr, PostClickQualityScore, CreativeQualityScore ' + 
    'FROM KEYWORDS_PERFORMANCE_REPORT ' + 
    'WHERE  HasQualityScore = TRUE ' +    
    'AND IsNegative = FALSE ' + 
    'AND Status = ENABLED ' + 
    'AND AdGroupStatus = ENABLED ' +     
    'AND CampaignStatus = ENABLED ';
  
  var report = AdWordsApp.report(query, reportConfig);
  var rows = report.rows(); 
  
  while (rows.hasNext())
  {
    var row = rows.next();
    
    var id = row['Id'];
    var text = row['Criteria'];
    var qs = parseInt(row['QualityScore']);
    
    //Logger.log('[#%s] "%s" QS: %s', id, text, qs);    
    //Logger.log('predictedCtr: %s, adRelevance:%s, landingPageExperience:%s', row['SearchPredictedCtr'], row['CreativeQualityScore'], row['PostClickQualityScore']);
    
    totals.rowCount++;
    totals.QualityScore+=qs;
    
    totals.predictedCtr+=result2weight(row['SearchPredictedCtr']);
    totals.adRelevance+=result2weight(row['CreativeQualityScore']); 
    totals.landingPageExperience+=result2weight(row['PostClickQualityScore']);
  }

  Logger.log(totals);  

  --

  // convert text result to numeric weight 
  // type: QualityScoreBucket
  // Above average = 3, Average = 2, Below average = 1 
  function result2weight(value){
    switch(value.toLowerCase()){
      case 'below average': return 1;       
      case 'average': return 2;       
      case 'above average': return 3;       
      default: return 0;
    }
  }

--------------------

// formulas
sheetService.setCellFormula('=$B3-$C3', 'D3:D9');
sheetService.setCellFormula('=$E3-$F3', 'G3:G9');
sheetService.setCellFormula('=$H3-$I3', 'J3:J9');
sheetService.setCellFormula('=$K3-$L3', 'M3:M9');
  
--------------------

// create Keyword
function createKeyword(adGroup, query, maxcpc){
adGroup.newKeywordBuilder()
.withText(query)
.withCpc(maxcpc)
.build();
}

// using 
if(!AdWordsApp.getExecutionInfo().isPreview())
createKeyword(adGroup, query, maxcpc);

--------------------

// video campaigns
var videoCampaigns = AdWordsApp.videoCampaigns()
.withCondition('Status IN[ENABLED, PAUSED]')
.get();
  
while (videoCampaigns.hasNext()) {
	Logger.log(videoCampaigns.next().getName());  
}

// shopping campaigns
var shoppingCampaigns = AdWordsApp.shoppingCampaigns()
.withCondition('Status IN[ENABLED, PAUSED]')
.get();
  
while (shoppingCampaigns.hasNext()) {
	Logger.log(shoppingCampaigns.next().getName());  
}

--------------------

var newSitelink = CreateSiteLink('site text 1', 'http://mydomain.com');
adGroup.addSitelink(newSitelink); // add site link to adgroup
campaign.addSitelink(newSitelink); // add site link to campaign

function CreateSiteLink(text, url){ 
  var operation = AdWordsApp.extensions().newSitelinkBuilder()
    .withLinkText(text)
    .withFinalUrl(url)
    .build();
    
  if(!operation.isSuccessful())
    return null;
  return operation.getResult();
}

--------------------

// array extension method - Search by id 
var Search = function(id){
  for(var i = 0; i < this.length; i++)
    if(this[i].id == id)
      return this[i];
  return null;
};

var arrKW = []; // { id, text, qualityScore }
var arrGroups = []; // { id, text, qualityScore, count }
var arrCampaigns = []; // { id, text, qualityScore, count }
  
arrKW.Search = Search;    
arrGroups.Search = Search;    
arrCampaigns.Search = Search;  

--------------------

// group keywords by adGroups and campaigns
// note: using Search extension method (see above)

// adGroups
for(var i=0;i<arrKW.length;i++)
{    
	var keyword = arrKW[i];        
	var adGroup = arrGroups.Search(keyword.adGroup.id);
	if(!adGroup){   
		adGroup = { 
		id: keyword.adGroup.id, 
		text: keyword.adGroup.name,
		qualityScore: 0,
		count: 0,         
	}      
      
	arrGroups.push(adGroup);
}
    
	adGroup.count ++;    
	adGroup.qualityScore += keyword.qualityScore; 
}

// campaigns
for(var i=0;i<arrKW.length;i++)
{    
	var keyword = arrKW[i];        
	var campaign = arrCampaigns.Search(keyword.campaign.id);
	if(!campaign){   
		campaign = { 
		id: keyword.campaign.id, 
		text: keyword.campaign.name,
		qualityScore: 0,
		count: 0,         
	}      
      
	arrCampaigns.push(campaign);
}
    
	campaign.count ++;    
	campaign.qualityScore += keyword.qualityScore; 
}

--------------------

// e.g: label 'CAMPAIGN_1234567'
// containsLabel('CAMPAIGN_'); // true
// getCampaignLabel(CAMPAIGN_); // 1234567

function containsLabel(LABEL_PREFIX) {
    return AdWordsApp.labels()
    .withCondition('Name STARTS_WITH "' + LABEL_PREFIX + '"')
    .get()
    .hasNext();
}

function getCampaignLabel(LABEL_PREFIX) {
    return AdWordsApp.labels()
    .withCondition('Name STARTS_WITH "' + LABEL_PREFIX + '"')
    .get().next().getName().replace(LABEL_PREFIX, '');
}

--------------------

// tests
Logger.log(IsExactMatch('test'));
Logger.log(IsExactMatch('"test"'));
Logger.log(IsExactMatch('[test]'));
  
Logger.log(IsKeywordExists('test'));
Logger.log(IsKeywordExists('"test"'));
Logger.log(IsKeywordExists('[test]'));


// exact match text [text]
function IsExactMatch(keyword_text){
  return keyword_text.charAt(0) == '[' && keyword_text.charAt(keyword_text.length -1) == ']';
}

// phrase match text "text"
function IsPhraseMatch(keyword_text){
  return keyword_text.charAt(0) == '"' && keyword_text.charAt(keyword_text.length -1) == '"';
}

--------------------

// is keyword exists in the adwords account
function IsKeywordExists(keyword_text){  
  return AdWordsApp.keywords().withCondition('Text = \'' + keyword_text + '\'').get().hasNext();
}

--------------------
// create label if not exists
if(!IsLabelExistsInAccount(LABEL_NAME)){    
    Logger.log('Label %s does not exists - creating it ...', LABEL_NAME);        
    AdWordsApp.createLabel(LABEL_NAME, 'some description...', 'color');
  }

function IsLabelExistsInAccount(labelName){
  var labels = AdWordsApp.labels().withCondition('Name = "' + labelName + '"').withLimit(1).get();
  if(!labels.hasNext()) {
    Logger.log('label "%s" was not found!', labelName);
    return false;
  }
  
  return true;  
}

--------------------

// report to find keywords with CPA value twice the average adgroup CPA
var adGroups = AdWordsApp.adGroups()
  .withCondition('Status = ENABLED')
  .withCondition('CampaignStatus = ENABLED')
  .get();

while(adGroups.hasNext()){
    var adGroup = adGroups.next();
    
    var adGroupId = adGroup.getId();
    var adGroupStats = adGroup.getStatsFor(STATS_PERIOD);    
    var avarageCPA = CalculateCPA(adGroupStats.getConvertedClicks(), adGroupStats.getCost());
    if(avarageCPA == 0) continue;
    
    Logger.log('adGroup %s -> %s ads, CPA(avg): %s', adGroup.getName(), numOfAds, avarageCPA);
    
	var cpaFilter = parseInt(avarageCPA) * 2;

    var report = AdWordsApp.report(
      'SELECT Id, Criteria, CostPerConversion, Cost, Conversions ' +
      'FROM KEYWORDS_PERFORMANCE_REPORT ' +
      'WHERE Status = ENABLED ' +  
      'AND IsNegative = FALSE ' + 
      'AND CostPerConversion > ' + cpaFilter + ' ' + // keyword CPA is at least twice of the adgroup CPA (not profitable) 
      'AND AdGroupId = ' + + adGroupId + ' ' + // only the current adroup
      'AND Criteria != AutomaticContent ' +   
      'DURING ' + STATS_PERIOD);

    var rows = report.rows();
}

--------------------

// report to find keywords with Cost value twice the average adgroup CPA

// note! report cost filter is in micros!!
var costFilter = parseInt(avarageCPA) * 2 * 1000000; 

var report = AdWordsApp.report(
    'SELECT Id, Criteria, CostPerConversion, Cost, Conversions ' +
    'FROM KEYWORDS_PERFORMANCE_REPORT ' +
    'WHERE Status = ENABLED ' +  
    'AND IsNegative = FALSE ' + 
    'AND Conversions < 1 ' + // no conversion 
    'AND Cost > ' + costFilter + ' ' + // cost at least twice of the adgroup CPA (not profitable) 
    'AND AdGroupId = ' + adGroupId + ' ' + // only the current adroup
    'AND Criteria != AutomaticContent ' +   
    'DURING ' + STATS_PERIOD);
        
var rows = report.rows();
    
--------------------

// create adgroup
function CreateAdGroup(campaign, product){
  var adGroupBuilder = campaign.newAdGroupBuilder();
  var adGroupOperation = adGroupBuilder.withName(product.name).build();
  return adGroupOperation.getResult();
}

--------------------

// create campaign using bulk uploads 
var columns = [
    'Campaign', 'Budget', 'Bid Strategy type', 'Campaign type'
  ];

  var upload = AdWordsApp.bulkUploads().newCsvUpload(
      columns, {moneyInMicros: false});

  upload.append({
    'Campaign': 'Test Campaign 1',
    'Budget': 200,
    'Bid Strategy type': 'cpc',
    'Campaign type': 'Search Only'
  });
  
  //upload.preview();
  upload.apply();

  var campaign = AdWordsApp.campaigns().withCondition('Name = ' + campaign_name).get().next();  
  campaign.applyLabel(LABEL_NAME);  
  campaign.addProximity(37.423021, -122.083739, 30, "KILOMETERS");
  return campaign;

--------------------

// create keywords
function CreateKeywords(adGroup, product){
  var keyword = product.maker.concat(' ', job.model);
  Logger.log('new keyword %s', keyword);
  adGroup.newKeywordBuilder().withText(keyword).build();
  
  keyword = product.model;
  Logger.log('new keyword %s', keyword);
  adGroup.newKeywordBuilder().withText(keyword).build();
  
  keyword = 'buy'.concat(' ', product.maker, ' ', product.model);
  Logger.log('new keyword %s', keyword);
  adGroup.newKeywordBuilder().withText(keyword).build();
  
  keyword = 'buy'.concat(' ', product.model);
  Logger.log('new keyword %s', keyword);
  adGroup.newKeywordBuilder().withText(keyword).build();
  
  keyword = product.maker.concat(' ', product.model, ' ', 'price');
  Logger.log('new keyword %s', keyword);
  adGroup.newKeywordBuilder().withText(keyword).build();
  
  keyword = product.model.concat(' ', 'price');
  Logger.log('new keyword %s', keyword);
  adGroup.newKeywordBuilder().withText(keyword).build();  
}

--------------------
  
// create ad with parameter (deprecated - see CreateAd example)
// use adGroup.newAd().expandedTextAdBuilder() instead
function CreateAdFromProduct(product){ 
  var adGroup = AdWordsApp.adGroups().withIds([PRODUCTS_AD_GROUP_ID]).get().next();
  var adOperation = adGroup.newTextAdBuilder()
    .withHeadline(product.model) // 25 characters
    .withDescription1(product.name.substr(0, 35)) // 35 characters
    .withDescription2('only {price: ' + product.price + '} dollars') // 35 characters
    .withDisplayUrl(product.link) // 255 characters
    .withFinalUrl(product.link) // 255 characters
    .build();
  
  return adOperation.isSuccessful(); 
} 

--------------------

// Slot column = 'Top vs Other' segment 

// get keywords 'Top vs Other' segment data 
var report = AdWordsApp.report(
	'SELECT Criteria, Impressions, Slot ' +
	'FROM KEYWORDS_PERFORMANCE_REPORT ' +
	'WHERE Impressions > 0 ' + 
	'DURING LAST_30_DAYS'); 
	     
var rows = report.rows();    
while(rows.hasNext()) { 
	var row = rows.next();
    
	var keywordText = row['Criteria'];
	var segment = row['Slot'];
    
	Logger.log('"%s" -> segment: %s, impressions: %s', keywordText, segment, row['Impressions']);
}

--------------------

// account daily stats - current month
var report = AdWordsApp.report(
     'SELECT Cost, Date ' +
     'FROM   ACCOUNT_PERFORMANCE_REPORT ' +
     'DURING THIS_MONTH');
  
  var rows = report.rows();
  while(rows.hasNext()) {
    var row = rows.next();
    Logger.log('%s -> %s', row['Date'], row['Cost']);
  }

--------------------

// adParams - update ad param/s

/* 
  in order to add ad params via the console, just use { paramName: paramValue }
  we can use index to reach the params. e.g: setAdParam(paramIndex, newValue)
  the parameters are tied to keywords, so different keywords may trigger different versions of an ad
*/

function UpdateAdDetails(ad, product){ 
  var adGroup = ad.getAdGroup();
  if(adGroup.isRemoved()) return; 

  var keywords = adGroup.keywords().withCondition('Status = ENABLED').get();
  while (keywords.hasNext()) {
    var keyword = keywords.next();

	var currentPrice = keyword.adParams().get().next().getInsertionText();
	Logger.log('keyword: %s, %s -> %s', keyword.getText(), currentPrice, product.price);
    keyword.setAdParam(1, product.price);
  }
} 

--------------------

// read html file from google drive
var file = DriveApp.getFilesByName('1.html').next();
var content = file.getBlob().getDataAsString();
Logger.log(content);

--------------------

// SLEEP
// custom sleep implementation (no setInterval nor setTimeout allowed)
function Sleep(seconds){
  var dt = new Date();
  while(true){
    var dt2 = new Date();
    var diff = Math.floor((dt2 - dt) / 1000);
    if(diff > seconds) break;
  }
}

// using:
Sleep(seconds);

--------------------

// convert html to pdf blob
HTML2PDF: function(strHtml, pdfName){
    var blob = Utilities.newBlob(strHtml, MimeType.HTML);
    var pdf = blob.getAs(MimeType.PDF);  
    pdf.setName(pdfName);
    return pdf
  }

--------------------

function Run(times, seconds){
  if(times == 0) return;
  WORK();
  Sleep(seconds); // see implementation above
  Run(times - 1, seconds);
}

// using
//execute 5 times overall, 60 seconds sleep between executions
Run(5, 60); 

--------------------

// get active account details (name, email etc.)
var account = AdWordsApp.currentAccount();
Logger.log(account.getName() + ' - ' + account.getLoginEmail());

--------------------

// get campaigns by ids + print their name and id
var campaigns = AdWordsApp.campaigns().withIds([157524671,157916231,157949711]).get();
while (campaigns.hasNext()) { 
	var campaign = campaigns.next();
	Logger.log(campaign.getId() + ' ' +  campaign.getName());
} 

--------------------

// load all the enabled keywords decorated with the specified label
// note! load from the label direction instead of the keyword direction 

var labelName = 'MyLabel';
var label = AdWordsApp.labels().withCondition('Name = "' + labelName + '"').get();
if(!label.hasNext()) {
Logger.log('error: label "%s" is not found!', labelName);
return;
}
  
Logger.log('label "%s" loaded', labelName);
var keywords = label.next().keywords().withCondition('Status = ENABLED').get();
while(keywords.hasNext())
{
var keyword = keywords.next();
Logger.log('%s', keyword.getText());
}
--------------------

// Get each campaigns cost and clicks last month
var campaigns = AdWordsApp.campaigns().forDateRange("LAST_MONTH").get();
while (campaigns.hasNext()) {    
	var campaign = campaigns.next();  
	Logger.log(campaign.getName());  
	var stats = campaign.getStatsFor("LAST_MONTH");    
	Logger.log("cost " + stats.getCost() + " | clicks " + stats.getClicks());  
}

--------------------

// Quality Score weight by impressions
[level] kw: 
(impressions * QS)/total-Impressions

[level] adgroup:
Sum([kw] impressions * [kw] QS)/total-Impressions

--------------------

// get yesterday top 10 keywords with highest impressions
var date_period = 'YESTERDAY';  
var keywords = AdWordsApp.keywords().orderBy('Impressions DESC').forDateRange(date_period).withLimit(10).get();
while (keywords.hasNext()) {    
    var keyword = keywords.next();    
    Logger.log(keyword.getText()); 
    Logger.log(keyword.getStatsFor(date_period).getImpressions());
}

--------------------

var lists = AdWordsApp.negativeKeywordLists()
  .withCondition('Name  = "' + LIST_NAME + '"')
  .get();   
  
  var list = null;
  if(lists.hasNext()){  
    list = lists.next();
  }
  else // create 
  {
    Logger.log('Negative Keyword List was not found - Creating it...');
    
    var operation = AdWordsApp.newNegativeKeywordListBuilder()
         .withName(LIST_NAME)
         .build();
    list = operation.getResult();
  }
     
  if(!list) return;
  
  Logger.log('#%s %s', list.getId().toString(), list.getName());

--------------------

// get keywords from ids geneated from report
var report = AdWordsApp.report(
    'SELECT Id, AdGroupId ' + 
    'FROM DISPLAY_KEYWORD_PERFORMANCE_REPORT ' + 
    'DURING LAST_30_DAYS');
  
  var ids = [];
  var rows = report.rows(); 
  while (rows.hasNext()) { 
	var row = rows.next();

	ids.push([row["AdGroupId"], row["Id"]]);    	
  } 
  //Logger.log(ids.length);
  
  var keywords = AdWordsApp.keywords().withIds(ids);

--------------------

  // load spreadsheet if exists or creates a new one if doesn't using google drive file
  // the file will hold the spreadsheet identity whom we can use to load spreadsheet file 
  var FILE_NAME = 'myfile1';

  var file = null;
  var file_iterator = DriveApp.getFilesByName(FILE_NAME);
  var spreadsheet = null;
  
  if(file_iterator.hasNext()) // file exists - get the first one
  {
    Logger.log('LOAD FILE');
	file = file_iterator.next();
    var spreadsheet_id = file.getBlob().getDataAsString();
    spreadsheet = SpreadsheetApp.openById(spreadsheet_id);
  }
  else  // no file in google drive - create it!
  {
    Logger.log('CREATE FILE');
    var SPREADSHEET_NAME = 'spreadsheet-' + FILE_NAME;
    spreadsheet = SpreadsheetApp.create(SPREADSHEET_NAME);
	file = DriveApp.createFile(FILE_NAME, spreadsheet.getId()); 
  }
  
  if(spreadsheet == null){
    Logger.log('no spreadsheet found!!')
    return;
  }
  
  sheet = spreadsheet.getActiveSheet();

--------------------

// create new sitelink
var sitelinkBuilder = AdWordsApp.extensions().newSitelinkBuilder();
    var newSitelink = sitelinkBuilder
        .withLinkText('Music')
        .withFinalUrl('http://www.example.com/Music')
        .withMobilePreferred(true)
        .build()
        .getResult();

// add sitelink to a campaign
campaign.addSitelink(newSitelink);

// add sitelink to an adGroup
adGroup.addSitelink(newSitelink);

// get campaign sitelinks
campaign.extensions().sitelinks().get();

// get adGroup sitelinks
adGroup.extensions().sitelinks().get();

--------------------

// set sitelink schedules - will appear only on the specified days and hours

// monday 9:00 - 18:00
var monday = {
          dayOfWeek: 'MONDAY',
          startHour: 9,
          startMinute: 0,
          endHour: 18,
          endMinute: 0
        };

// tuesday 9:00 - 18:00
var tuesday = {
          dayOfWeek: 'TUESDAY',
          startHour: 9,
          startMinute: 0,
          endHour: 18,
          endMinute: 0
        };

sitelink.setSchedules([monday, tuesday]);

======== SCRIPTS ====================================================================

// Send PDF Report Based on HTML Content via email
var EMAIL = 'rcbuilder@walla.com';

function main() { 
  var html = "<h1>Report Header</h1>" + 
			 "<p>this report created via adsense script</p>" +
             "<p>" + new Date() + "</p>"+  
             "<p>word A : 300 clicks</p>"+  
             "<p>word B : 263 clicks</p>"+  
             "<p>word C : 109 clicks</p>"+  
			 "<p>END OF THE REPORT</p>";

  var blob = Utilities.newBlob(html, MimeType.HTML);
  var pdfBlob = blob.getAs(MimeType.PDF);
  MailApp.sendEmail(EMAIL, 'HELLO FROM ADWORDS SCRIPTS', 'ATTACHED PDF FILE', {name: 'report', attachments: [pdfBlob]});
}

--------------------
var ads = AdWordsApp.ads()
    .withCondition('CampaignStatus = ENABLED')
    .withCondition('AdGroupStatus = ENABLED')
    .withCondition('Status = ENABLED')
    .get();

while(ads.hasNext()){
    var ad = ads.next();
    Logger.log('policy approval status: %s', ad.getPolicyApprovalStatus());
    Logger.log('approval status: %s', ad.getApprovalStatus());
}

--------------------

// campaign Impressions Share
var report = AdWordsApp.report(
 	"SELECT CampaignName, SearchImpressionShare " +
 	"FROM CAMPAIGN_PERFORMANCE_REPORT " +
 	"WHERE AdvertisingChannelType IN [SEARCH] " +
 	"DURING THIS_MONTH", {
 		includeZeroImpressions: false
 	});
  
  var rows = report.rows();
 	while (rows.hasNext()) {
      var row = rows.next();
      var cName = row['CampaignName'];
      var iShare = row['SearchImpressionShare'];
      
      Logger.log('campaign %s has Impressions Share of %s', cName, iShare);
   }

--------------------

// DISAPPROVED ads
var ads = AdWordsApp.ads()
    .withCondition('CampaignStatus = ENABLED')
    .withCondition('AdGroupStatus = ENABLED')
    .withCondition('Status = ENABLED')
    .withCondition('ApprovalStatus = DISAPPROVED')
    .get();
  
  while(ads.hasNext()){
    var ad = ads.next();
    
    Logger.log('ad #%s (of type %s)', ad.getId().toString(), ad.getType())  // EXPANDED_TEXT_AD
    ... 
    ...
    Logger.log('%s', ad.asType().expandedTextAd().getHeadlinePart1());
  }

--------------------
// DISAPPROVED ads with reason 
  var ads = AdWordsApp.ads()
  .withCondition('Status = ENABLED')
  .withCondition('CombinedApprovalStatus IN [DISAPPROVED, SITE_SUSPENDED, APPROVED_LIMITED]')
  .withLimit(10)
  .get();
  
  while(ads.hasNext()){
  	var ad = ads.next();
    var approvalStatus = ad.getPolicyApprovalStatus();
    var reason = ad.getDisapprovalReasons();
    Logger.log('%s(%s) > %s', ad.getId().toString(), ad.getType(), approvalStatus);    
    Logger.log('reason: %s', reason);
  }

--------------------

// campaigns by serving status - ended camapigns
var campaigns = AdWordsApp.campaigns()
  .withCondition('Status = ENABLED') 
  .withCondition('ServingStatus = ENDED')  // SERVING, NONE, ENDED, PENDING, SUSPENDED
  .withLimit(10)
  .get();
  
  while(campaigns.hasNext()){
  	var campaign = campaigns.next();
    ///var endDate = campaign.getEndDate();
    ///var sEndDate = endDate ? (endDate.year + '-' + endDate.month + '-' + endDate.day) : '';
    
    Logger.log('%s > ENDED', campaign.getName());        
  }

--------------------

// create sheet from report and read specific fields 
function main() {
  var spreadsheet = SpreadsheetApp.create("My Report");
  var sheet = spreadsheet.getActiveSheet(); 
  
  var report = AdWordsApp.report(
    "SELECT AdGroupId, Impressions, Cost " +
    "FROM SEARCH_QUERY_PERFORMANCE_REPORT " +
    "DURING LAST_30_DAYS"); // execute report
  
  report.exportToSheet(sheet);
 
  var range = sheet.getRange(1, 3, 7, 3); 
  var values = range.getValues();
 
  for(r in values)
    for(c in values[r])
      Logger.log(values[r][c]);
}

--------------------

// get all placements and their stats
var placements = AdWordsApp.display().placements().withLimit(20).get();
  while(placements.hasNext()){
  	var placement = placements.next();
    var stats = placement.getStatsFor('ALL_TIME');    
    Logger.log('%s > %s impressions', placement.getUrl(), stats.getImpressions())
  }

--------------------

// Pause Display keyword with 100 Clicks and no Conversions
var NUM_OF_CLICKS = 100;

function main() {
  var report = AdWordsApp.report(
    'SELECT Id, KeywordText, Clicks, Conversions, AdGroupId ' + 
    'FROM DISPLAY_KEYWORD_PERFORMANCE_REPORT ' + 
    'WHERE Clicks > ' + NUM_OF_CLICKS + ' AND Conversions = 0 ' + 
    'DURING 20000101,' + dateFormat(new Date()));
  
  var rows = report.rows();
  while(rows.hasNext()) {
    var row = rows.next();
    
    var clicks = row['Clicks'];
    var conversions = row['Conversions'];  
    //if(clicks < NUM_OF_CLICKS || conversions > 0) continue;
    
    var keywordText = row['KeywordText'];
    var keywordId = row['Id'];
    var adGroupId = row['AdGroupId'];
    //Logger.log(keywordId + ' "' + keywordText + '" ' + clicks + ' ' + conversions);
    
    var id = [];
    id.push([adGroupId,keywordId]);
    
    var keyword = AdWordsApp.keywords().withIds(id).get().next();
    if(!AdWordsApp.getExecutionInfo().isPreview())
      keyword.pause();
    
    Logger.log('"' + keywordText + '" stopped');
  }
}

function dateFormat(date){
  var year = date.getFullYear().toString();
  var month = (date.getMonth() + 1).toString();
  var day = date.getDate().toString();
  
  if(month.length == 1) month = '0' + month; // return yyyyMMdd
  if(day.length == 1) day = '0' + day;
  
  return year + month + day;
}

--------------------

// Reach the First Page by Increasing the first page cpc by 20%
function main() {
  var keywords = AdWordsApp.keywords().get() 
  while (keywords.hasNext()) { 
	var keyword = keywords.next();
    
    var cpc = keyword.getMaxCpc();
    var first_page_cpc = keyword.getFirstPageCpc();  
    var cpc_new = first_page_cpc * 1.2;
    
    if(!AdWordsApp.getExecutionInfo().isPreview())
      keyword.setMaxCpc(cpc_new);
    Logger.log(keyword.getText() + ' FIRST PAGE NEEDED PRICE : ' + first_page_cpc + ' -> OLD PRICE : ' + cpc + ', NEW PRICE : ' + cpc_new);   
  } 
}

--------------------
// mcc level - filter accounts by label + get each account value from other label

// get all accounts have the label 'Primary'
var accounts = MccApp.accounts().withCondition('LabelNames CONTAINS "Primary"').get();
while(accounts.hasNext())
{
	var account = accounts.next();
	Logger.log('### account: %s ###', account.getName());    
	var result = GetMaxMinutesWithoutImpressions(account);
	Logger.log('--------------------------');
}

function GetMaxMinutesWithoutImpressions(account){
  // get current account label starts with 'Secondary_' - if not exists - return default value, otherwise return its value 
  // e.g: Secondary_MyValue will return the phrase 'MyValue'
  var labelIterator = account.labels().withCondition('Name STARTS_WITH "Secondary_"').get();
  if(!labelIterator.hasNext()) return 'Default Value';
  var label = labelIterator.next();
  return label.getName().replace('Secondary_', '');
}

--------------------

// Pause keyword with 100 Clicks and no Conversions
function main() {
  var keywords = AdWordsApp.keywords()
  .withCondition("Clicks > 100")
  .withCondition("Conversions = 0")
  .forDateRange("ALL_TIME")
  .get();
  
  while (keywords.hasNext()) {
    var keyword = keywords.next();
    
    if(!AdWordsApp.getExecutionInfo().isPreview())
      keyword.pause();
    Logger.log('"' + keyword.getText() + '" stopped');    
  }
}

--------------------

// increase cpc in 10% for display words with conversion rate less than defined
var P_CONVERSION_RATE = 0.3;

function main() {
  var report = AdWordsApp.report(
    'SELECT Id, AdGroupId ' + 
    'FROM DISPLAY_KEYWORD_PERFORMANCE_REPORT ' + 
    'DURING LAST_30_DAYS');
  
  var ids = [];
  var rows = report.rows(); 
  while (rows.hasNext()) { 
	var row = rows.next();

	ids.push([row["AdGroupId"], row["Id"]]);    	
  } 
  //Logger.log(ids.length);
  
  var keywords_f1 = AdWordsApp.keywords().withIds(ids);
  
  var keywords = keywords_f1.withCondition("ConversionRate < " + P_CONVERSION_RATE).forDateRange("ALL_TIME").get();
  
  while (keywords.hasNext()) {
    var keyword = keywords.next();
    
    var cpc = keyword.getMaxCpc();
    var new_cpc = cpc * 1.1;
     
    if(!AdWordsApp.getExecutionInfo().isPreview())
      keyword.setMaxCpc(new_cpc);
    Logger.log(keyword.getText() + ' - ' + cpc + ' -> ' + new_cpc);
  } 
}

--------------------

// exclude placements with more than 100 clicks and no conversion from the allowed advertisments list
var NUM_OF_CLICKS = 100;

function main() {
  var report = AdWordsApp.report(
    'SELECT PlacementUrl, DisplayName, Clicks, Conversions, CampaignId ' + 
    'FROM PLACEMENT_PERFORMANCE_REPORT ' + 
    'WHERE Clicks > ' + NUM_OF_CLICKS + ' AND Conversions = 0 ' + 
    'DURING 20000101,' + dateFormat(new Date()));
  
  var rows = report.rows();
  while(rows.hasNext()) {
    var row = rows.next();
    
    var clicks = row['Clicks'];
    var conversions = row['Conversions'];  
    //if(clicks < NUM_OF_CLICKS || conversions > 0) continue;
    
    var placementUrl = row['PlacementUrl'];
    var displayName = row['DisplayName'];
    //Logger.log(displayName + ' (' + placementUrl + ') ' + ' ' + clicks + ' ' + conversions);
    
    var campaignId = row['CampaignId'];
    var campaign = AdWordsApp.campaigns().withIds([campaignId]).get().next();
    
    if(!AdWordsApp.getExecutionInfo().isPreview())
      campaign.excludeLocation(displayName);
    
    Logger.log('"' + displayName + '" excluded from the allowed advertisments list');
  }
}

function dateFormat(date){
  var year = date.getFullYear().toString();
  var month = (date.getMonth() + 1).toString();
  var day = date.getDate().toString();
  
  if(month.length == 1) month = '0' + month; // return yyyyMMdd
  if(day.length == 1) day = '0' + day;
  
  return year + month + day;
}

--------------------

// add search terms (queries) with clicks and no conversion as negative keywords
var NUM_OF_CLICKS = 100;

function main() {
  var report = AdWordsApp.report(
   'SELECT Query,Clicks,Conversions ' +
   'FROM SEARCH_QUERY_PERFORMANCE_REPORT ' +
   'WHERE Clicks > ' + NUM_OF_CLICKS + ' AND Conversions = 0 ' + 
   'DURING 20000101,' + dateFormat(new Date()));
 
  var rows = report.rows();
  while(rows.hasNext()) {
    var row = rows.next();
    
    var clicks = row['Clicks'];
    var conversions = row['Conversions'];
    //if(clicks < NUM_OF_CLICKS || conversions > 0) continue;
    
    var query = row['Query'];
    //Logger.log(query + ' ' + clicks + ' ' + conversions);
    var found_in_my_keywords = AdWordsApp.keywords().withCondition('Text CONTAINS "' + query + '"').get().hasNext();
    if(found_in_my_keywords)
    {
      Logger.log('"' + query + '" found in my keywords');
      continue;
    }
    
    var adGroup = AdWordsApp.adGroups().get().next();
    if(!AdWordsApp.getExecutionInfo().isPreview())
      adGroup.createNegativeKeyword(query);
   
    Logger.log('"' + query + '" added as negative keyword')
  }
}

function dateFormat(date){
  var year = date.getFullYear().toString();
  var month = (date.getMonth() + 1).toString();
  var day = date.getDate().toString();
  
  if(month.length == 1) month = '0' + month; // return yyyyMMdd
  if(day.length == 1) day = '0' + day;
  
  return year + month + day;
}

--------------------
[taken from '(R) Adgroups Weekly Report (Email).adwords']

// get adgroup impressions Share
// { impressionShare }
function GetAdGroupExtendedData(adGroup, dateRange){
  var result = { impressionShare: 0 };

  var reportConfig = {
    includeZeroImpressions: false
  };
  
  var query =  'SELECT AdGroupId, AdGroupName, SearchImpressionShare ' + 
    'FROM ADGROUP_PERFORMANCE_REPORT ' + 
    'WHERE CampaignStatus IN [ENABLED] ' +    
    'AND AdGroupStatus IN [ENABLED] ' +    
    'AND AdGroupId = ' + adGroup.getId() + ' ' + 
    'DURING ' + dateRange;

  var report = AdWordsApp.report(query, reportConfig);
  var rows = report.rows(); 
  while (rows.hasNext())
  {
    var row = rows.next();
    var impressionShare = row['SearchImpressionShare'];    
    result.impressionShare = impressionShare;    
  }
  
  Logger.log('[ExtendedData] %s -> %s', adGroup.getName(), result);
  return result;
}

--------------------
[taken from '(R) Adgroups Weekly Report (Email).adwords']

// get adgroup device average position
// { mobile, tablet, desktop }
function GetAdGroupDeviceData(adGroup, dateRange){
  var result = { 
    mobile: {
      averagePosition: 0
    }, 
    tablet: {
      averagePosition: 0
    }, 
    desktop: {
      averagePosition: 0
    } 
  };

  var reportConfig = {
    includeZeroImpressions: false
  };
    
  var query =  'SELECT AdGroupId, AdGroupName, Device, AveragePosition ' + 
    'FROM ADGROUP_PERFORMANCE_REPORT ' + 
    'WHERE CampaignStatus IN [ENABLED] ' +    
    'AND AdGroupStatus IN [ENABLED] ' +    
    'AND AdGroupId = ' + adGroup.getId() + ' ' + 
    'DURING ' + dateRange;

  var report = AdWordsApp.report(query, reportConfig);
  var rows = report.rows(); 
  while (rows.hasNext())
  {
    var row = rows.next();
    var device = row['Device'];
    var averagePosition = row['AveragePosition'];

    if(device == 'Computers')
    {
      result.desktop.averagePosition = averagePosition;   
      continue;
    }
    
    if(device.indexOf('Mobile') == 0)
    {
      result.mobile.averagePosition = averagePosition;          
      continue;
    }
    
    if(device.indexOf('Tablets') == 0)
    {
      result.tablet.averagePosition = averagePosition;        
      continue;
    }
  }
  
  Logger.log('[DeviceData] %s -> %s', adGroup.getName(), result);
  return result;
}

--------------------
[taken from '(R) Adgroups Weekly Report (Email).adwords']

// data by conversion type
// get adgroup conversion data per conversion type
// [ { conversionType, stats: { conversions, conversionRate } } ]
function GetAdGroupConversionsData(adGroup, dateRange){
  var result = [];

  var reportConfig = {
    includeZeroImpressions: true
  };
  
  var query =  'SELECT AdGroupId, AdGroupName, ConversionTypeName, Conversions, ConversionRate ' + 
    'FROM ADGROUP_PERFORMANCE_REPORT ' + 
    'WHERE CampaignStatus IN [ENABLED] ' +    
    'AND AdGroupStatus IN [ENABLED] ' +    
    'AND AdGroupId = ' + adGroup.getId() + ' ' + 
    'DURING ' + dateRange;

  var report = AdWordsApp.report(query, reportConfig);
  var rows = report.rows(); 
  while (rows.hasNext())
  {
    var row = rows.next();
    var conversionType = row['ConversionTypeName'];
    result.push({ 
      conversionType: conversionType, 
      stats: { 
        conversions: row['Conversions'],         
        conversionRate: row['ConversionRate'] 
      }
    });
  }
  
  Logger.log('[ConversionsData] %s', adGroup.getName());
  for(i in result)
    Logger.log('%s : %s', result[i].conversionType, result[i].stats);
  
  return result;
}

--------------------

// report sliced by day, week, month or year

when we ask for Date - the report will be sliced by day
when we ask for Week - the report will be sliced by week
when we ask for Month - the report will be sliced by month
when we ask for Year - the report will be sliced by year

// e.g: sliced by week
var reportConfig = {
    includeZeroImpressions: true
  };
  
  var query =  'SELECT CampaignId, CampaignName, Week, Impressions.... ' + 
    'FROM CAMPAIGN_PERFORMANCE_REPORT ' + 
    'WHERE CampaignStatus IN [ENABLED] ' +    
    'DURING ' + dateRange;

  var report = AdWordsApp.report(query, reportConfig); 

--------------------

// add search terms (queries) with conversion as keywords
function main() {
  var report = AdWordsApp.report(
   'SELECT Query,Clicks,Conversions,AverageCpc ' +
   'FROM SEARCH_QUERY_PERFORMANCE_REPORT ' +
   'WHERE Conversions > 0 ' + 
   'DURING 20000101,' + dateFormat(new Date()));
 
  var rows = report.rows();
  while(rows.hasNext()) {
    var row = rows.next();
    
    var clicks = row['Clicks'];
    var conversions = row['Conversions'];

    //if(conversions == 0) continue;
    
    var query = row['Query'];
    //Logger.log(query + ' ' + clicks);
    var found_in_my_keywords = AdWordsApp.keywords().withCondition('Text CONTAINS "' + query + '"').get().hasNext();
    if(found_in_my_keywords)
    {
      Logger.log('"' + query + '" found in my keywords');
      continue;
    }
    
    var adGroup = AdWordsApp.adGroups().get().next();
    var maxcpc = row['AverageCpc'];
    
    if(!AdWordsApp.getExecutionInfo().isPreview())
      createKeyword(adGroup, query, maxcpc);
    Logger.log('"' + query + '" added as keyword with maxcpc ' + maxcpc)
  }
}

function dateFormat(date){
  var year = date.getFullYear().toString();
  var month = (date.getMonth() + 1).toString();
  var day = date.getDate().toString();
  
  if(month.length == 1) month = '0' + month; // return yyyyMMdd
  if(day.length == 1) day = '0' + day;
  
  return year + month + day;
}

--------------------

// using: findDayIndex(row['Week'], row['Date']);
// e.g: findDayIndex('2017-01-26', '2017-01-23');
function findDayIndex(strWeek, strDay){
  var week = HELPER.parseDate(strWeek);
  var day = HELPER.parseDate(strDay);   
  return parseInt(HELPER.dateDiff(day, week));
}

--------------------

// set No Conversion keywords as negative
function main() {
  var keywords = AdWordsApp
  .keywords()
  .withCondition("Clicks > 100")
  .withCondition("Conversions = 0")
  .forDateRange("ALL_TIME")
  .get();
  
  while (keywords.hasNext()) {
    var keyword = keywords.next();
 
    var campaign = keyword.getCampaign();
    
    if(!AdWordsApp.getExecutionInfo().isPreview())
      campaign.createNegativeKeyword(keyword.getText());
    Logger.log('SET ' + keyword.getText() + ' KEYWORD AS NEGATIVE');  
  }
}

--------------------

// calculate the CPA
function CalculateCPA(convertedClicks, cost){
  return convertedClicks == 0 ? 0 : cost / convertedClicks;
}

--------------------

// campaign report - days sliced 
function GetReport(dateRange){
  var reportConfig = {
    includeZeroImpressions: true
  };
  
  var query =  'SELECT CampaignId, CampaignName, Week, Date, Impressions, Clicks, Ctr, Cost, AverageCpc, AveragePosition, Conversions, ConversionRate, CostPerConversion ' + 
    'FROM CAMPAIGN_PERFORMANCE_REPORT ' + 
    'WHERE CampaignStatus IN [ENABLED] ' +    
    'DURING ' + dateRange;

  return AdWordsApp.report(query, reportConfig); 
}

 // get metrics for week A
Logger.log('Week A: %s', dateRangeA);
var reportA = GetReport(dateRangeA);
var rowsA = reportA.rows();   
while (rowsA.hasNext()) { 
	var row = rowsA.next();
	Logger.log('%s -> %s', row['CampaignName'], row['Date']);
    var dayIndex = findDayIndex(row['Week'], row['Date']);
    arrWeekA.push({ dayIndex: dayIndex, campaignName: row['CampaignName'], dataRow: row});
}

// using: findDayIndex(row['Week'], row['Date']);
// e.g: findDayIndex('2017-01-26', '2017-01-23');
function findDayIndex(strWeek, strDay){
  var week = HELPER.parseDate(strWeek);
  var day = HELPER.parseDate(strDay);   
  return parseInt(HELPER.dateDiff(day, week));
}

--------------------

// set sheet UI and cell formats
sheetService.setDataUI('A1:B1', null, null, 11, 'left', 'bold', null, 'middle');  
sheetService.setDataUI('A2:AB2', null, '#04465e', 11, 'left', 'bold', null, 'middle');  

// cell formats
sheetService.setNumberFormat('B3:D1');      
sheetService.setCurrencyFormat('E3:G1');  
sheetService.setDecimalFormat('H3:J1');      
sheetService.setPercentageFormat('D3:D50');

// formulas  
sheetService.setCellFormula('=if($B3 = 0, 0, ($C3-$B3)/$B3)', 'D3:D50');
sheetService.setCellFormula('=if($E3 = 0, 0, ($F3-$E3)/$E3)', 'G3:G50');

--------------------

// Lower Max CPC for No Conversion Keywords with price over 5 and Max CPC higher then the top Page CPC
function main() {
  var keywords = AdWordsApp.keywords()
  .withCondition("Conversions = 0")
  .withCondition("Cost > 5")
  .forDateRange("ALL_TIME").get();
  
  while (keywords.hasNext()) {
    var keyword = keywords.next();
    
    var max_cpc = keyword.getMaxCpc();
    var top_page_cpc = keyword.getTopOfPageCpc();  
    
    if(max_cpc <= top_page_cpc + 0.01) continue;  
    
    if(!AdWordsApp.getExecutionInfo().isPreview())
      keyword.setMaxCpc(top_page_cpc + 0.01);
    Logger.log(keyword.getText() + ', max cpc = ' + max_cpc + ' top page cpc = ' + top_page_cpc);
  }
}

--------------------

// Increase keywords Conversion cost per click
var P_CONVERSION_COST = 10;

function main() {
  var keywords = AdWordsApp.keywords()
  .withCondition("AveragePosition > 1.5")
  .withCondition("Conversions > 0")
  .forDateRange("LAST_30_DAYS").get();
  
  while (keywords.hasNext()) {
    var keyword = keywords.next();

    var stat = keyword.getStatsFor('ALL_TIME');
    var cost = stat.getCost();
    var conversions = stat.getConvertedClicks();
    
    if(cost / conversions >= P_CONVERSION_COST)
      continue;
    
    Logger.log(keyword.getText() + ' cost = ' + cost + '  conversions = ' + conversions);
    
    var cpc = keyword.getMaxCpc();
    var new_cpc = cpc * 1.1; 
   
    if(!AdWordsApp.getExecutionInfo().isPreview())
      keyword.setMaxCpc(new_cpc);
    Logger.log(keyword.getText() + ' - ' + cpc + ' -> ' + new_cpc);  
  } 
}

--------------------

// Increase display keywords Conversion cost per click
var P_CONVERSION_COST = 10;

function main() {
  var report = AdWordsApp.report(
    'SELECT Id, AdGroupId ' + 
    'FROM DISPLAY_KEYWORD_PERFORMANCE_REPORT ' + 
    'WHERE Conversions > 0 ' + 
    'DURING LAST_30_DAYS');
  
  var ids = [];
  var rows = report.rows();  
  while (rows.hasNext()) { 
	var row = rows.next();

	ids.push([row["AdGroupId"], row["Id"]]);    	
  } 
  //Logger.log(ids.length);
  
  var keywords = AdWordsApp.keywords().withIds(ids);
    
  while (keywords.hasNext()) {
    var keyword = keywords.next();
    
    var stat = keyword.getStatsFor('ALL_TIME');
    var cost = stat.getCost();
    var conversions = stat.getConvertedClicks();
    
    if(cost / conversions >= P_CONVERSION_COST)
      continue;
    
    Logger.log(keyword.getText() + ' cost = ' + cost + '  conversions = ' + conversions);
    
    var cpc = keyword.getMaxCpc();
    var new_cpc = cpc * 1.1;
     
    if(!AdWordsApp.getExecutionInfo().isPreview())
      keyword.setMaxCpc(new_cpc);
    Logger.log(keyword.getText() + ' - ' + cpc + ' -> ' + new_cpc);
  } 
}

--------------------

// Goal Seek 2.5
function main() {
  var max_click_price = 6;
  var min_position_allowed = 6;
  
  var date_range = 'LAST_14_DAYS';
  var keywords = AdWordsApp
  .keywords()
  .forDateRange(date_range)
  .withCondition("AveragePosition > 6")
  .withCondition("AverageCpc > " + max_click_price)
  .get();
  
  while (keywords.hasNext()) { 
	var keyword = keywords.next();
    var stat = keyword.getStatsFor(date_range);
    Logger.log(keyword.getText() + ' DELETED' + ' ( position : ' + stat.getAveragePosition() + ')');
  } 
  
  Logger.log('----------------------------------------------');
  
  date_range = 'LAST_7_DAYS';
  keywords = AdWordsApp.keywords().forDateRange(date_range).get();
  while (keywords.hasNext()) { 
	var keyword = keywords.next();
    var stat = keyword.getStatsFor(date_range);
    var position = stat.getAveragePosition();
    var cpc = keyword.getMaxCpc();
    
    var cpc_new = cpc;
    if(position >= 1 && position <= 1.70)
      cpc_new = cpc * 0.97;
    else if(position >= 1.71 && position <= 2.45)
      cpc_new = cpc * 0.99;
    else if(position >= 2.55 && position <= 3.50)
      cpc_new = cpc * 1.01;
    else if(position >= 3.51 && position <= 4.50)
      cpc_new = cpc * 1.03;
    else if(position >= 4.51 && position <= 0)
      cpc_new = cpc * 1.06;
    else 
      cpc_new = cpc * 1.10;
    
    if(cpc_new != cpc)
    {
      if(!AdWordsApp.getExecutionInfo().isPreview())
        keyword.setMaxCpc(cpc_new);
      Logger.log(keyword.getText() + ' OLD PRICE : ' + cpc + ' -> NEW PRICE : ' + cpc_new + ' ( position : ' + position + ')');         
    }
  } 
}

--------------------

// go over all the accounts in an MCC and print each campaigns
function main() {
  var accounts = MccApp.accounts()
      .withCondition(LabelNames CONTAINS 'MyAccount')
      .get();

  while (accounts.hasNext()) {
    var account = accounts.next();
    var accountName = account.getName()  account.getName()  '--';
    Logger.log('%s,%s', account.getCustomerId(), accountName);    

    MccApp.select(account);  set the active account 

    var campaigns = AdWordsApp.campaigns().get();

    while (campaigns.hasNext()) {
      var campaign = campaigns.next();

      Logger.log('%s', campaign.getName());
    }
  }

--------------------
// Create Report as PDF and send via email
var EMAIL = 'rcbuilder@walla.com';

function main() {
  var spreadsheet = SpreadsheetApp.create("My Report"); // create new spreadsheet
  var sheet = spreadsheet.getActiveSheet(); // get active sheet
  var report = AdWordsApp.report("SELECT AdGroupId, Impressions, Cost FROM SEARCH_QUERY_PERFORMANCE_REPORT DURING LAST_30_DAYS"); // execute report
  report.exportToSheet(sheet); // fill sheet with the report data
  
  var last_row = sheet.getLastRow();
  var last_column = sheet.getLastColumn();
      
  var range = sheet.getRange(1, 1, last_row, last_column); // all data 
  var values = range.getValues();
 
  var HTML = '<table cellpadding="4" cellspacing="4">';
  for(r in values)
  { 
    HTML += '<tr>';  
    for(c in values[r])
      HTML += '<td>' + values[r][c] + '</td>';
    HTML += '</tr>';    
  }
  HTML += '</table>';   
  
  var blob = Utilities.newBlob(HTML, MimeType.HTML);
  var pdfBlob = blob.getAs(MimeType.PDF);
  pdfBlob.setName('Report.pdf');
  MailApp.sendEmail(EMAIL, 'HELLO FROM ADWORDS SCRIPTS', 'REPORT FILE ATTACHED', {attachments: [pdfBlob]});
}

--------------------

// Create Chart based on the TOP 10 Most Expensive Keywords data and send via email
var EMAIL = 'rcbuilder@walla.com';

function main() {
  var data = Charts.newDataTable()
				.addColumn(Charts.ColumnType.STRING, 'Name')
				.addColumn(Charts.ColumnType.NUMBER, 'Cost')
				.addColumn(Charts.ColumnType.NUMBER, 'Impressions')
				.addColumn(Charts.ColumnType.NUMBER, 'Clicks');  
  
  var date_range = 'ALL_TIME';
  var chart_Title = 'TOP 10 Most Expensive Keywords';
  
  
  var keywords = AdWordsApp.keywords().orderBy('Cost DESC').forDateRange(date_range).withLimit(10).get();
  while (keywords.hasNext()) {    
    var keyword = keywords.next();    
    var stat = keyword.getStatsFor(date_range);
    data.addRow([keyword.getText(), stat.getCost(), stat.getImpressions(), stat.getClicks()]);     
    //Logger.log(keyword.getText()  + ',' + stat.getCost()  + ',' + stat.getImpressions() + ',' + stat.getClicks());
  }
  
  data.build();  
  
  var chart_area = Charts.newAreaChart()      
  .setDataTable(data)      
  .setStacked()      
  .setRange(0, 1000)   
  .setDimensions(1000, 400)
  .setTitle(chart_Title)      
  .build();  
  
  var chart_bar = Charts.newBarChart()     
  .setDataTable(data)      
  .setStacked()      
  .setRange(0, 1000)   
  .setDimensions(1000, 400)
  .setTitle(chart_Title)      
  .build();  
  
  var chart_column = Charts.newColumnChart()     
  .setDataTable(data)      
  .setStacked()      
  .setRange(0, 1000)   
  .setDimensions(1000, 400)
  .setTitle(chart_Title)      
  .build();  
  
  var chart_line = Charts.newLineChart()     
  .setDataTable(data)          
  .setRange(0, 1000)   
  .setDimensions(1000, 400)
  .setTitle(chart_Title)      
  .build(); 
  
  var chart_pie = Charts.newPieChart()     
  .setDataTable(data)      
  .setDimensions(1000, 400)
  .setTitle(chart_Title)  
  .set3D()
  .build(); 
  
  var chart_table = Charts.newTableChart()     
  .setDataTable(data)         
  .setDimensions(1000, 400)     
  .build();
   
  var blob_area = chart_area.getBlob();
  var blob_bar = chart_bar.getBlob();
  var blob_column = chart_column.getBlob();
  var blob_line = chart_line.getBlob();
  var blob_pie = chart_pie.getBlob();
  var blob_table = chart_table.getBlob();
  
  MailApp.sendEmail(EMAIL, 'HELLO FROM ADWORDS SCRIPTS', 'ATTACHED CHART FILE', {attachments: [blob_area, blob_bar, blob_column, blob_line, blob_pie, blob_table]});
}

--------------------

// cost vs clicks each campaign
var EMAIL = 'rcbuilder@walla.com';

function main() {
  
var date_range = 'LAST_MONTH';  
  
var campaigns = AdWordsApp
.campaigns()
.forDateRange(date_range)
.get();
  
while (campaigns.hasNext()) {    
	var campaign = campaigns.next();  
  
	var stats = campaign.getStatsFor("LAST_30_DAYS");    
	Logger.log('"' + campaign.getName() + '" - COST ' + stats.getCost() + ' | CLICKS ' + stats.getClicks());  
    MailApp.sendEmail(EMAIL, 'COST VS CLICKS', '"' + campaign.getName() + '" - COST ' + stats.getCost() + ' | CLICKS ' + stats.getClicks());
  }
}

--------------------

// cut only the 10 first words in a phrase
var arr_query_words = query.split(' ');
if(arr_query_words.length > 10){
	query = arr_query_words.slice(0,10).join(' ');
	Logger.log('Fixed Query -> %s', query);
}

--------------------

// top 10 keywords with highest impressions
var EMAIL = 'rcbuilder@walla.com';

function main() {
  var date_period = 'YESTERDAY';
  
  var keywords = AdWordsApp
  .keywords()
  .orderBy('Impressions DESC')
  .forDateRange(date_period)
  .withLimit(10)
  .get();
  
  while (keywords.hasNext()) {    
    var keyword = keywords.next();    

    var stats = keyword.getStatsFor(date_period);
    MailApp.sendEmail(EMAIL, 'top 10 keywords with highest impressions', '"' + keyword.getText() + '", Impressions : ' + stats.getImpressions());
    Logger.log('"' + keyword.getText() + '", Impressions : ' + stats.getImpressions());  
  }
}

--------------------

// pause Campaigns With 100 Clicks and No Conversion
function main() {
  var campaigns = AdWordsApp
  .campaigns()
  .withCondition("Clicks > 100")
  .withCondition("Conversions = 0")
  .forDateRange("ALL_TIME")
  .get();
  
  while (campaigns.hasNext()) {
    var campaign = campaigns.next();

    if(!AdWordsApp.getExecutionInfo().isPreview())
      campaign.pause();
    Logger.log('"' + campaign.getName() + '" paused');
  }
}


--------------------

var groupbyCampaigns = [];
  
  var rows = report.rows();
  while(rows.hasNext()){
    var row = rows.next();
    var campaignId = row['CampaignId'];
      
    if(!groupbyCampaigns[campaignId])
      groupbyCampaigns[campaignId] = { id: campaignId, items: [] };
    groupbyCampaigns[campaignId].items.push(row);       
  }
  
  for(i in groupbyCampaigns){
    var campaign = groupbyCampaigns[i];
    Logger.log('#%s (%s items)', campaign.id, campaign.items.length);
    
    for(j in campaign.items)
    {
      var row = campaign.items[j];
      // code here ...      
    }
  }

---------------------------------


// group report rows by campaign 
var report = AdWordsApp.report(
      'SELECT Id, Criteria, CampaignId, CampaignName, Impressions, Clicks, Cost, Conversions, CostPerConversion, AveragePosition, Ctr, AverageCpc ' +
      'FROM KEYWORDS_PERFORMANCE_REPORT ' +
      'WHERE Status = ENABLED ' +  
      'AND AdGroupStatus = ENABLED ' +
      'AND CampaignStatus = ENABLED ' + 
      'AND IsNegative = FALSE ' +             
      'DURING ' + STATS_PERIOD, reportConfig);
          
  var groupbyCampaigns = [];
  
  var rows = report.rows();
  while(rows.hasNext()){
    var row = rows.next();
    var campaignId = row['CampaignId'];
      
    if(!groupbyCampaigns[campaignId])
      groupbyCampaigns[campaignId] = { id: campaignId, items: [] };
    groupbyCampaigns[campaignId].items.push(row);       
  }
  
  for(i in groupbyCampaigns){
    var campaign = groupbyCampaigns[i];
    Logger.log('#%s (%s items)', campaign.id, campaign.items.length);
    
    for(j in campaign.items)
    {
      var row = campaign.items[j];
      
      var keyword = row['Criteria'];  
      var campaignName = row['CampaignName'];
      
      Logger.log('%s %s', keyword, campaignName);
    }
  }

--------------------

// generate embedded charts (using SHEET SERVICE)

// arrRanges, vAxisData, width, height, rowPosition, columnPosition, chartTitle 
// vAxisData: { title, ticks, lines[]{ color, legend} }
sheetService.addLineChart(
	['A2:A26', 'B2:B26', 'C2:C26'],
	{ lines: [
		{color:'#4572A7', legend:'impressions'},
		{color:'#AA4643', legend:'clicks'}
	]},    
	700, 160, 3, 7, // chart location - row 3, column 7
	'impressions vs clicks'
); 
  
sheetService.addLineChart(
	['A2:A26', 'D2:D26', 'C2:C26'],
	{ lines: [
		{color:'#4572A7', legend:'conv.Rate'},
		{color:'#AA4643', legend:'clicks'}
	]},  
	700, 160, 11, 7, // chart location - row 10, column 7
	'conv.Rate vs clicks'
); 
  
sheetService.addLineChart(
	['A2:A26', 'E2:E26', 'C2:C26'],
	{ lines: [
		{color:'#4572A7', legend:'cost'},
		{color:'#AA4643', legend:'clicks'}
	]}, 
	700, 160, 19, 7, // chart location - row 17, column 7
	'cost vs clicks'
); 
  
  
// arrRanges, vAxisDataLeft, vAxisDataRight, width, height, rowPosition, columnPosition, chartTitle 
// vAxisData: { title, ticks, color, legend }
sheetService.addLineChartDualY(
	['A2:A26', 'E2:E26', 'C2:C26'],
	{ 
		title: 'LEFT',
		color:'#00FF00', 
		legend:'cost'
	},
	{ 
		title: 'RIGHT', 
		ticks: [0, 5, 10],
		color:'#FF0000', 
		legend:'clicks'
	},
	700, 160, 27, 7, 
	'cost vs clicks DualY'
); 

sheetService.addChartBarsLineDualY(
    ['A1:A5', 'B1:B5', 'C1:C5'],
    { 
      title: 'LEFT',
      color:'#00FF00', 
      legend:'cost'
    },
    { 
      title: 'RIGHT', 
      ticks: [0, 5, 10],
      color:'#FF0000', 
      legend:'clicks'
    },
    700, 160, 1, 7, 
    'cost vs clicks Bars & Line DualY'
  ); 

--------------------

// new conversions
var FILE_NAME = 'SCRIPT_NEW_CONVERSION_DATA';
var last_execution_data = [];
var EMAIL = 'Yosi@sarltd.com';

function main() { 
  /* RESET FILE
  var file_to_reset = DriveApp.getFilesByName(FILE_NAME).next();
  file_to_reset.setContent(' ');
  DriveApp.removeFile(file_to_reset);
  return;
  */
  
  var data_file = null;
  var temp = DriveApp.getFilesByName(FILE_NAME);
  
  var fileExists = temp.hasNext();
  
  // first execution - create file at google drive
  if(!fileExists) {
    Logger.log('FIRST EXECUTION - CREATING START POINT');
    
    LoadCampaigns();
    
    //Logger.log(last_execution_data.length);
    //Logger.log(DataToString());
    
    data_file = DriveApp.createFile(FILE_NAME, Data2String());
    return;
  }
    
  // file exists - read content
  data_file = temp.next();
  var content = data_file.getBlob().getDataAsString();
  
  if(content == ' ')
  {
    Logger.log('THE FILE CORRUPTED - TO FIX IT - CHANGE THE FILE NAME');
    return;
  }
  
  String2Data(content);
  //Logger.log(last_execution_data)
  
  var report = GetReport();
  
  var need_to_update_drive = false;
  
  var rows = report.rows();
  while(rows.hasNext()) {
    var row = rows.next();
    
    var campaignId = row['CampaignId'];
    var conversions = row['Conversions'];
    
    var old_conversions = Search(campaignId);
    if(old_conversions == -1) // not exists - add it 
    {
      Logger.log('ADD NEW ROW ' + campaignId);
      
      need_to_update_drive = true;
      
      AddData(campaignId, conversions);
      continue;
    }
    
    if(conversions > old_conversions)
    {
      need_to_update_drive = true;
      
      UpdateData(campaignId, conversions);
      
      var campaignName = row['CampaignName'];
      MailApp.sendEmail(EMAIL, 'NEW CONVERSION', campaignName + ', ' + campaignId);
      Logger.log('NEW CONVERSION "' + campaignName + '"')
    }
  }

  if(need_to_update_drive)
    data_file.setContent(Data2String());
}

function dateFormat(date){
  var year = date.getFullYear().toString();
  var month = (date.getMonth() + 1).toString();
  var day = date.getDate().toString();
  
  if(month.length == 1) month = '0' + month; // return yyyyMMdd
  if(day.length == 1) day = '0' + day;
  
  return year + month + day;
}

function AddData(campaignId, conversions){
  last_execution_data.push([campaignId, conversions]);
}

function UpdateData(campaignId, conversions){
  for(var i = 0; i < last_execution_data.length; i++)
    if(last_execution_data[i][0] == campaignId)
       last_execution_data[i][1] = conversions;
}
  
function Search(campaignId){
  for(var i = 0; i < last_execution_data.length; i++)
    if(last_execution_data[i][0] == campaignId)
      return last_execution_data[i][1];
  return -1;
}

function GetReport(){
  var report = AdWordsApp.report(
    'SELECT CampaignName, CampaignId, Conversions ' +
    'FROM CAMPAIGN_PERFORMANCE_REPORT ' +
    'DURING 20000101,' + dateFormat(new Date())
  );
  
  return report;
}

function LoadCampaigns(){
  var report = GetReport();
  
  var rows = report.rows();
  while(rows.hasNext()) {
    var row = rows.next();
    
    var campaignId = row['CampaignId'];
    var conversions = row['Conversions'];
    
    last_execution_data.push([campaignId, conversions]);
  }
}

function Data2String(){
  var sArray = '';
  for(var i = 0; i < last_execution_data.length; i++)
  {
    var row = last_execution_data[i];
    sArray += row[0] + ',' + row[1] + '\n';
  }
  return sArray;
}

function String2Data(content){
  var rows = content.split('\n');
  for(var i = 0; i < rows.length; i++)
  {
    if(rows[i] == '') continue;
    var row = rows[i].split(',');
    last_execution_data.push([row[0], row[1]]);
  }
}

--------------------

// Increase Cost per Converted - Audience - 2 filters report

var P_CONVERSION_COST = 10;
var EMAIL = 'rcbuilder@walla.com';

function main() {
  var report_f1 = AdWordsApp.report(
    'SELECT Id ' + 
    'FROM AUDIENCE_PERFORMANCE_REPORT ' + 
    'WHERE Conversions > 0 ' + 
    'AND AveragePosition > 1.5 ' +  
    'DURING LAST_30_DAYS');
  
  var rows = report_f1.rows(); 
  
  var ids = [];
  while (rows.hasNext()) { 
    ids.push(rows.next()['Id']);
  }

  if(ids.length == 0) return;
  
  //Logger.log(ids.toString()); 
  
  var report = AdWordsApp.report(
    'SELECT Id, Criteria, Cost, Conversions, CostPerConversion, MaxCpc ' + 
    'FROM AUDIENCE_PERFORMANCE_REPORT ' + 
    'WHERE Id IN [' + ids.toString() + '] ' + 
    'DURING 20000101,' + dateFormat(new Date()));

  rows = report.rows();
  
  var EMAIL_BODY = '';
  while (rows.hasNext()) { 
	var row = rows.next();
   
	var costPerConversion = row['CostPerConversion'];
    
    if(costPerConversion >= P_CONVERSION_COST) 
      continue;
    
    var name = row['Criteria'];
    var cost = row['Cost'];
    var conversions = row['Conversions'];
    
    Logger.log(name + ' cost = ' + cost + '  conversions = ' + conversions);
    
    var cpc = row['MaxCpc'];
    var new_cpc = cpc * 1.1;

    var message = name + ' - ' + cpc + ' -> ' + new_cpc;
    Logger.log(message);
    EMAIL_BODY += message + '\n';
  } 
  
  if(EMAIL_BODY != '')
    MailApp.sendEmail(EMAIL, 'Increase AUDIENCE Cost per Conversion', EMAIL_BODY);
}

function dateFormat(date){
  var year = date.getFullYear().toString();
  var month = (date.getMonth() + 1).toString();
  var day = date.getDate().toString();
  
  if(month.length == 1) month = '0' + month; // return yyyyMMdd
  if(day.length == 1) day = '0' + day;
  
  return year + month + day;
}

--------------------

/* FORMAT SERVICE */
var FormatService = function(){
  return {
    toNumber: function(value){
      try{
        if(isNaN(value)) throw new Error();     
        return parseInt(value).toFixed(0);     
      }
      catch(e){ return value; }
    },
    toDecimal: function(value){
      try{
        if(isNaN(value)) throw new Error();
        return parseFloat(value).toFixed(2);     
      }
      catch(e){ return value; }
    },
    toCurrency: function(value){
      try{
        if(isNaN(value)) throw new Error();
        return parseFloat(value).toFixed(2).concat('$');     
      }
      catch(e){ return value; }
    },
    toPercentage: function(value){
      try{        
        if(isNaN(value)) throw new Error();
        return parseFloat(value).toFixed(0).concat('%');     
      }
      catch(e){ return value; }
    },
    toDateName: function(date){
      try{
        // toDateString() -> Mon Feb 29 2016
        var arrDateParts = date.toDateString().split(' '); 
        return arrDateParts[1] + ' ' + arrDateParts[2];  // Feb 29 (MMM dd)
      }
      catch(e){ return date; }
    },
    toMonthName: function(date){
      try{
        // toDateString() -> Mon Feb 29 2016
        var arrDateParts = date.toDateString().split(' '); 
        return arrDateParts[1] + ', ' + arrDateParts[3];  // Feb, 2016 (MMM, yyyy)
      }
      catch(e) { return date; }
    },
    toDateYMD: function (date, delimiter){
      try{
        delimiter = delimiter || '';
        
        var year = date.getFullYear().toString();
        var month = (date.getMonth()+1).toString();
        var day = date.getDate().toString();
        
        if(month.length == 1) month = '0' + month; 
        if(day.length == 1) day = '0' + day;
        
        return year + delimiter + month + delimiter + day; // default: 20160229 (yyyyMMdd)
      }
      catch(e) { return date; }
    }, 
  }
}

--------------------

/* REPORT SERVICE */

var stats = account.getStatsFor('ALL_TIME');
 
var dataRow = { 
    accountId: account_id,
    date: new Date(),
    clicks: stats.getClicks(), 
    cost: stats.getCost(),
    impressions: stats.getImpressions(),
    convertedClicks: stats.getConvertedClicks(),
    clickConversionRate: stats.getClickConversionRate(),
    ctr: stats.getCtr(),
    cpc: (stats.getCost() / stats.getClicks()).toFixed(2)
  };

var ReportService = function(){
  var _template = null;
  
  return {   
    setTemplate: function(templateName){
      var temp = DriveApp.getFilesByName(templateName);
      if(!temp.hasNext()) {
        Logger.log('TEMPLATE %s not found!', templateName);
        return;
      }
      
      var file = temp.next();
      _template = file.getBlob().getDataAsString();
    },    
    generate: function(dataRow){
      if(!_template) return '';
      
      return _template
      .replace('{{impressions}}', dataRow.impressions)
      .replace('{{clicks}}', dataRow.clicks)
      .replace('{{ctr}}', dataRow.ctr)
      .replace('{{cpc}}', dataRow.cpc)
      .replace('{{convertedClicks}}', dataRow.convertedClicks)
      .replace('{{clickConversionRate}}', dataRow.clickConversionRate)
      .replace('{{cost}}', dataRow.cost);
    }
  }
}

/* ACCOUNT STATISTICS SERVICE */
var StatisticsService = function(sheetService) { 
  return {
    hasHeader: function() { 
      return parseInt(sheetService.getLastRowIndex()) > 0;
    },
    addHeader: function(dataRow){   
      sheetService.addRow(['Date', 'clicks', 'conversions', 'cost', 'impressions', 'convertedClicks', 'conversionRate']);
    },
    addRow: function(dataRow){      
      sheetService.addRow([dataRow.Date, dataRow.clicks, dataRow.conversions, dataRow.cost, dataRow.impressions, dataRow.convertedClicks, dataRow.conversionRate]);
    }
  }
}

--------------------

/* FORECAST SERVICE */
var forecastService = function(sheetService) { 
  return {
    getAccountRowIndex: function(accountId, labelName){
      return parseInt(sheetService.getRowIndexBy2Columns(2, accountId, 3, labelName));
    },
    
    getCustomerName: function(rowIndex){
      return sheetService.getValue(rowIndex, 1);
    },
    getAccountId: function(rowIndex){
      return sheetService.getValue(rowIndex, 2);
    },
    getLabel: function(rowIndex){
      return sheetService.getValue(rowIndex, 3);
    },
    getStartDate: function(rowIndex){
      var date = new Date(sheetService.getValue(rowIndex, 4));
      date.setDate(date.getDate() + 1);
      return date;
    },
    getEndDate: function(rowIndex){
      var date = new Date(sheetService.getValue(rowIndex, 5));
      date.setDate(date.getDate() + 1);
      return date;
    },
    getBudget: function(rowIndex){
      return parseFloat(sheetService.getValue(rowIndex, 6)).toFixed(2);
    },
    getConversionsTarget: function(rowIndex){
      return parseInt(sheetService.getValue(rowIndex, 7));
    },
    getConversionCostTarget: function(rowIndex){
      return parseFloat(sheetService.getValue(rowIndex, 8)).toFixed(2);
    },
    getAccountsIds: function(){
      var values = [];
      
      var range = sheetService.getColumnValues(2, 2);
      for(r in range)
        for(c in range[r])
          if(values.indexOf(range[r][c]) == -1)
            values.push(range[r][c])
      return values;
    },
    getAccountLabels: function(accountId){
      return sheetService.findColumnValuesByFilter(2, accountId, 1);   
    },   
    setSpendForecast: function(rowIndex, value){
      return sheetService.setValue(rowIndex, 9, value);
    },
    setSpendDeviation: function(rowIndex, value){
      return sheetService.setValue(rowIndex, 10, value);
    },
    setConversionsForecast: function(rowIndex, value){
      return sheetService.setValue(rowIndex, 11, value);
    },
    setConversionsDeviation: function(rowIndex, value){
      return sheetService.setValue(rowIndex, 12, value);
    },
    setConversionCostForecast: function(rowIndex, value){
      return sheetService.setValue(rowIndex, 13, value);
    },
    setConversionCostDeviation: function(rowIndex, value){
      return sheetService.setValue(rowIndex, 14, value);
    }
  }
}

--------------------

/* JOBS SERVICE */
var JobsService = function(xml_service) { 
  var _arr_jobs = [];
  
  return {
    loadJobs: function(){
      _arr_jobs = [];
      
      var jobs_root = xml_service.getElement('vacancies');   
      var jobs = xml_service.getElements('vacancy', jobs_root);
      
      for (var i = 0; i < /*jobs.length*/ 5; i++) {   
        var job = jobs[i];   

        _arr_jobs.push({
          specialisme: job.getChild('Taxonomy').getChild('specialisme').getChildText('value'),
          location: job.getChild('Taxonomy').getChild('location').getChildText('value'),
          name: job.getChild('Position').getChildText('JobTitle'),
          link: job.getChild('Contact').getChildText('VacancyURL'),
          salaris: job.getChild('Taxonomy').getChildText('salaris').getChildText('value')
        });               
      }

      return _arr_jobs;      
    },    
    findJobByURL: function (value) {
      for(var i = 0; i < _arr_jobs.length; i++)      
        if(_arr_jobs[i].link == value)
          return _arr_jobs[i];
      return null; 
    },
    jobs: function(){ return _arr_jobs; },
    count: function(){ return _arr_jobs.length; }
  }
}

--------------------

/* XML SERVICE */
var XMLService = function(uri) { 
  var _document = null;
  
  (function(){
    var response = UrlFetchApp.fetch(uri);
    var status_code = response.getResponseCode();
    
    if(status_code != 200) // 200 = OK
    {
      Logger.log('status code %s', status_code);
      return;
    }
    
    Logger.log('%s was loaded', uri);    
    _document =  XmlService.parse(response.getContentText());
   })();
  
   return { 
     document: _document,
     root: _document.getRootElement(),
     namespace: function(){
       return this.root.getNamespace();
     },
     namespaceURI: function(){
       return this.namespace().getURI();
     },
     count: function(root){
       root = root || this.root;       
       return root.getContentSize();
     },   
     getNodes: function(nodeName, root){
       root = root || this.root;     
       return root.getChildren(nodeName, this.namespace());
     },
     getNode: function(nodeName, root){
       root = root || this.root; 
       return root.getChild(nodeName, this.namespace());
     },
     getNodeValue: function(nodeName, root){
       return this.getNode(nodeName, root).getText();
     },
     getNodeAttribute: function(attributeName, root){
       return root.getAttribute(attributeName);
     },
     getNodeAttributeValue: function(attributeName, root){
       return this.getNodeAttribute(attributeName, root).getValue();
     },     
     filter: function(nodes, childName, regex){                  
       var result = [];
       var pattern = new RegExp(regex);
       
       for(i in nodes){
         var children = nodes[i].getChildren(childName, this.namespace());
         for(i in children)
         {
           var value = children[i].getText();
           if(pattern.test(value))
             result.push(value);
         }         
       }
       
       return result;
     } 
   }; 
}

--------------------

// working with google geo location api
var GOOGLE_GEO_API_URL = 'https://maps.googleapis.com/maps/api/geocode/json?address={0}&key={1}';
var API_KEY = 'AIzaSyChy9VRT-pvVmU_G8aa3D5OizD2ggLlUGQ';

function main() { 
	var location = 'Zoetermeer';
	var api_url = GOOGLE_GEO_API_URL.replace('{0}', location).replace('{1}', API_KEY);  
	var coordinatesService = new CoordinatesService(new JSONService(api_url));       
    
	// { lng, lat }
	var coordinates = coordinatesService.getFromName(location);
	Logger.log('%s: lat %s, lng %s ', location, coordinates.lat, coordinates.lng);  
	campaign.addProximity(coordinates.lat, coordinates.lng, 30, "KILOMETERS");  
}

--------------------

/* COORDINATES SERVICE */
var CoordinatesService = function(json_service) { 
  return { 
    getFromName: function (value) {
      // location { lng, lat }
      return json_service.document().results[0].geometry.location;
    }
  }
}

--------------------

/* JSON SERVICE */
var JSONService = function(uri) { 
  var _document = null;
  
  (function(){
    var response = UrlFetchApp.fetch(uri);
    var status_code = response.getResponseCode();
    
    if(status_code != 200) // 200 = OK
    {
      Logger.log('status code %s', status_code);
      return;
    }
    
    Logger.log('%s was loaded', uri);    
    _document = JSON.parse(response.getContentText());    
   })();  
  
   return { 
     document: _document,
     count: function(){
       if(!_document) 
         return 0;
       
       if(_document.length)
         return _document.length;         
       return 1;
     }, 
   }; 
}

--------------------

/* CSV SERVICE */
var CSVService = function(uri, delimiter) { 
  var _document = null;
  var _delimiter = delimiter || ',';
  var _charset = 'UTF-8';
  
  (function(){
    var response = UrlFetchApp.fetch(uri);
    var status_code = response.getResponseCode();
    
    if(status_code != 200) // 200 = OK
    {
      Logger.log('status code %s', status_code);
      return;
    }
    
    Logger.log('%s was loaded', uri);            
    _document = Utilities.parseCsv(response.getContentText(_charset), _delimiter);    
   })();  
  
   return { 
     document: _document,
     count: function(){
       if(!_document) 
         return 0;
       
       if(_document.length)
         return _document.length;         
       return 1;
     },
     getRows: function(){
       var rows = [];
    
      for(i in _document){
        var row = _document[i];
        if(row[0].length == 1) 
          continue;      
        rows.push(row);
      }
      return rows;
     }
   }; 
}

--------------------

/* INVOCA READER SERVICE */
var InvocaReaderService = function(jsonService) { 
  var _jsonService = null;  
  
  (function(){
     _jsonService = jsonService;    
   })();  
  
   return {      
     countRows: function(){       
       return _jsonService.count();                
     }, 
     countLeads: function(){
       var leads = this.getLeads();
       return leads.length;
     },
     getLeads: function(){
       var rows = [];
       
       for(i in _jsonService.document){
         var item =_jsonService.document[i];
         if(item.call_result_description_detail.toUpperCase() == 'PAID')
           rows.push(item);
       }
       return rows;
     }
   }; 
}

--------------------

// build html report changes
var htmlBuilderService = HTMLBuilderService();
  
htmlBuilderService.add('<h1>' + AdWordsApp.currentAccount().getName() + '</h1>');
htmlBuilderService.add('<table cellspacing="3" cellpadding="3" border="1">');
htmlBuilderService.add('<tr>'+
                        '<th>label</th>'+
                        '<th>campaign</th>'+
                        '<th>keyword</th>'+
                        '<th>position</th>'+
                        '<th>target</th>'+
                        '<th>bid</th>'+
                        '<th>new bid</th>'+
                        '</tr>');
  
var changes = 0;
changes += ProcessKeywords(positions.primary, htmlBuilderService);
changes += ProcessKeywords(positions.secondary, htmlBuilderService);
changes += ProcessKeywords(positions.tertiary, htmlBuilderService);
  
htmlBuilderService.add('</table>');
  
if(changes == 0)
{
Logger.log('no changes!!');
return;
}  
    
try{                 
Logger.log('send mail to %s', EMAIL);
MailApp.sendEmail(EMAIL, 'Keywords Position Manager Report', '', {
    htmlBody: htmlBuilderService.get()
});
}
catch(ex){
Logger.log('exception occured: %s', ex.message);
}

--------------------

function main() { 
var spreadSheetService = SpreadsheetLoader.loadSpreadSheetService(FILE_NAME, false);
  if(!spreadSheetService){
	Logger.log('No sheets found!');
    return;
  }    
  
  // create accounts manager service (manager sheet)
  var accountsManagerService = new AccountsManagerService(spreadSheetService);
  
  // create reporter service   
  var reportService = new ReportService(); 
  reportService.setTemplate(REPORT_TEMPLATE_NAME);

  var account_ids = accountsManagerService.getAccountsIds();
  Logger.log('account ids: %s', account_ids);
  
  var accounts = MccApp.accounts().withIds(account_ids).get();  
  while(accounts.hasNext())
  {
    var account = accounts.next();
    
    Logger.log('### account: %s ###', account.getName());    
    ProcessAccount(account, accountsManagerService, reportService);
    Logger.log('--------------------------');
  }
}

function ProcessAccount(account, accountsManagerService, reportService){
    var account_id = account.getCustomerId();  
    // code here ...
}

/* CHART SERVICE */
var ChartService = function(){
  var buildEmbeddedChart = function(_sheet, arrRanges, series, vAxes, width, height, rowPosition, columnPosition, chartTitle, extraOptions){        
    var chartBuilder = _sheet.newChart();
    
    for (var i in arrRanges)         
      chartBuilder.addRange(_sheet.getRange(arrRanges[i]));       
    
    chartBuilder             
    .setPosition(rowPosition, columnPosition, 0, 0)  // chart location row X column Y       
    
    .setOption('animation.duration', 500) // animation                 
    .setOption('width', width)        
    .setOption('height', height)                                    
    //.setOption('legend', { alignment: 'right', position: 'right' }) // alignment: start, center, end  | position: bottom, left, right, top       
    .setOption('hAxis.textPosition', 'out') // out, in, none 
    .setOption('hAxis.format', 'dd MMM') // decimal, currency, percent, short, long, none -OR- custom ('MMM d, y', '#,###%' etc.)    
    .setOption('series', series)  // parameter       
    .setOption('vAxes', vAxes) // parameter              
    
    if(chartTitle)
      chartBuilder.setOption('title', chartTitle); 
    
    // extra options
    if(extraOptions){
      for(var i=0;i<extraOptions.length;i++)
        chartBuilder.setOption(extraOptions[i].key, extraOptions[i].value);
    }
    
    _sheet.insertChart(chartBuilder.build());
  }
  
  var createChart = function(type /* Enum ChartType */, dataSource /* DataTableBuilder */, series, vAxes, width, height, chartTitle, extraOptions /* [{ key,value }] */){        
    var chartBuilder = null;
       
    switch(type){
      case Charts.ChartType.AREA: chartBuilder = Charts.newAreaChart();   
        break;
      case Charts.ChartType.BAR: chartBuilder = Charts.newBarChart();   
        break;     
      case Charts.ChartType.PIE: chartBuilder = Charts.newPieChart();  
        break;
      default:        
      case Charts.ChartType.LINE: chartBuilder = Charts.newLineChart();   
        break;      
      case Charts.ChartType.COLUMN: chartBuilder = Charts.newColumnChart();   
        break; 
      case Charts.ChartType.SCATTER: chartBuilder = Charts.newScatterChart();   
        break; 
      case Charts.ChartType.TABLE: chartBuilder = Charts.newTableChart();   
        break;
    }
    
    chartBuilder
    .setDataTable(dataSource)                                
    
    .setOption('animation.duration', 500) // animation                                                 
    //.setOption('legend', { alignment: 'right', position: 'right' }) // alignment: start, center, end  | position: bottom, left, right, top       
    .setOption('hAxis.textPosition', 'out') // out, in, none 
    .setOption('hAxis.format', 'dd MMM') // decimal, currency, percent, short, long, none -OR- custom ('MMM d, y', '#,###%' etc.)     
    .setOption('series', series)  // parameter       
    .setOption('vAxes', vAxes) // parameter     
    .setDimensions(width, height)
    
    if(chartTitle)
      chartBuilder.setOption('title', chartTitle); 
    
    // extra options
    if(extraOptions){
      for(var i=0;i<extraOptions.length;i++)
        chartBuilder.setOption(extraOptions[i].key, extraOptions[i].value);
    }  
        
    return chartBuilder.build();   
  }
  
  var getColumnType = function(value){
    value = value.toLowerCase();
    switch(value){
      case 'datetime':
      case 'date': return Charts.ColumnType.DATE;
      case 'numeric':
      case 'float':  
      case 'int':
      case 'number': return Charts.ColumnType.NUMBER;
      default:
      case 'string': return Charts.ColumnType.STRING;
    }
  }
    
  var getChartType = function(value){
    value = value.toLowerCase();
    switch(value){        
      case 'area': return Charts.ChartType.AREA;        
      case 'bars':
      case 'bar': return Charts.ChartType.BAR;
      case 'pie': return Charts.ChartType.PIE;
      case 'cols':
      case 'columns':
      case 'column': return Charts.ChartType.COLUMN; 
      case 'dots':
      case 'scater':
      case 'scatter': return Charts.ChartType.SCATTER; 
      case 'table': return Charts.ChartType.TABLE; 
      default:
      case 'line': return Charts.ChartType.LINE;
    }
  }
    
  return {    
    // --- EMBEDDED CHARTS ---
    addChartToSheet: function(_sheet, typeName, arrRanges /* range format: 'B15:B24' */, vAxisData /* { title, ticks, lines[{color, legend}]  } */, width, height, rowPosition, columnPosition, chartTitle){  
      var series = [];
      for (var i in vAxisData.lines)         
        series.push({ 
          color: vAxisData.lines[i].color, 
          labelInLegend : vAxisData.lines[i].legend,
          pointShape: 'square',
          pointSize: 4,
          type: typeName,
          targetAxisIndex: 0 // only one vAxis (index 0)
        });
      
      var minValue = 0;
      if(vAxisData.ticks) // custom vAxis values      
        // set minimum value to be the minimum tick value
        minValue = Math.min.apply(null, vAxisData.ticks).toFixed(0);
      
      var vAxis = { 
        ticks: vAxisData.ticks, // null for default
        title: vAxisData.title,
        minValue: minValue, 
        viewWindow: { min: minValue }
      };
      
      var vAxes = [];
      vAxes.push(vAxis); // only one vAxis (index 0)
      
      buildEmbeddedChart(_sheet, arrRanges, series, vAxes, width, height, rowPosition, columnPosition, chartTitle);
    },
    addLineChartToSheet: function(_sheet, arrRanges, vAxisData, width, height, rowPosition, columnPosition, chartTitle){  
      this.addChartToSheet(_sheet, 'line', arrRanges, vAxisData, width, height, rowPosition, columnPosition, chartTitle);
    },
    addAreaChartToSheet: function(_sheet, arrRanges, vAxisData, width, height, rowPosition, columnPosition, chartTitle){  
      this.addChartToSheet(_sheet, 'area', arrRanges, vAxisData, width, height, rowPosition, columnPosition, chartTitle);
    },
    addBarsChartToSheet: function(_sheet, arrRanges, vAxisData, width, height, rowPosition, columnPosition, chartTitle){  
      this.addChartToSheet(_sheet, 'bars', arrRanges, vAxisData, width, height, rowPosition, columnPosition, chartTitle);
    },
    
    // --- EMBEDDED DUAL-Y CHARTS ---
    addDualYChartsToSheet: function(_sheet, typeNameLeft, typeNameRight, arrRanges /* range format: 'B15:B24' */, vAxisDataLeft /* { title, ticks, color, legend } */, vAxisDataRight, width, height, rowPosition, columnPosition, chartTitle){  
      var series = [];
      
      series.push({ 
        color: vAxisDataLeft.color, 
        labelInLegend : vAxisDataLeft.legend,
        pointShape: 'square',
        pointSize: 4,
        type: typeNameLeft,
        targetAxisIndex: 0 // vAxis (index 0)
      });
      
      series.push({ 
        color: vAxisDataRight.color, 
        labelInLegend : vAxisDataRight.legend,
        pointShape: 'square',
        pointSize: 4,
        type: typeNameRight,
        targetAxisIndex: 1 // vAxis (index 1)
      });
      
      var minValueLeft = 0;
      if(vAxisDataLeft.ticks) // custom vAxis values      
        // set minimum value to be the minimum tick value
        minValueLeft = Math.min.apply(null, vAxisDataLeft.ticks).toFixed(0);
      
      var vAxisLeft = { 
        ticks: vAxisDataLeft.ticks, // null for default
        title: vAxisDataLeft.title,
        minValue: minValueLeft, 
        viewWindow: { min: minValueLeft }
      };
      
      var minValueRight = 0;
      if(vAxisDataRight.ticks) // custom vAxis values      
        // set minimum value to be the minimum tick value
        minValueRight = Math.min.apply(null, vAxisDataRight.ticks).toFixed(0);
      
      var vAxisRight = { 
        ticks: vAxisDataRight.ticks, // null for default
        title: vAxisDataRight.title,
        minValue: minValueRight, 
        viewWindow: { min: minValueRight }
      };
      
      var vAxes = [];
      vAxes.push(vAxisLeft); // vAxis (index 0)
      vAxes.push(vAxisRight); // vAxis (index 1)
      
      buildEmbeddedChart(_sheet, arrRanges, series, vAxes, width, height, rowPosition, columnPosition, chartTitle);
    },
    addBarsLineChartDualYToSheet: function(_sheet, arrRanges, vAxisDataLeft, vAxisDataRight, width, height, rowPosition, columnPosition, chartTitle){  
      this.addDualYChartsToSheet(_sheet, 'bars', 'line', arrRanges, vAxisDataLeft, vAxisDataRight, width, height, rowPosition, columnPosition, chartTitle);
    },
    addLineChartDualYToSheet: function(_sheet, arrRanges, vAxisDataLeft, vAxisDataRight, width, height, rowPosition, columnPosition, chartTitle){  
      this.addDualYChartsToSheet(_sheet, 'line', 'line', arrRanges, vAxisDataLeft, vAxisDataRight, width, height, rowPosition, columnPosition, chartTitle);
    },
    addBarsChartDualYToSheet: function(_sheet, arrRanges, vAxisDataLeft, vAxisDataRight, width, height, rowPosition, columnPosition, chartTitle){  
      this.addDualYChartsToSheet(_sheet, 'bars', 'bars', arrRanges, vAxisDataLeft, vAxisDataRight, width, height, rowPosition, columnPosition, chartTitle);
    },
    
    // --- CHARTS AS BLOB ---
    createChartAsBlob: function(typeName, columns /* [{ name, type }] */, rows /* [[value1,value2...valueN]] */, vAxisData /* { title, ticks, lines[{color, legend}] */, width, height, chartTitle, extraOptions) {
      
      // build the data source 
      var dataSource = Charts.newDataTable();
      
      for(var i = 0; i < columns.length; i++) { // add columns
        var column = columns[i];
        dataSource.addColumn(getColumnType(column.type), column.name);
      }
       
      for(var i = 0; i < rows.length; i++) // add rows
        dataSource.addRow(rows[i])
       
      dataSource.build();
       
      var series = [];
      for (var i in vAxisData.lines)         
        series.push({ 
          color: vAxisData.lines[i].color, 
          labelInLegend : vAxisData.lines[i].legend,
          pointShape: 'square',
          pointSize: 4,          
          targetAxisIndex: 0 // only one vAxis (index 0)
        });
      
      var minValue = 0;
      if(vAxisData.ticks) // custom vAxis values      
        // set minimum value to be the minimum tick value
        minValue = Math.min.apply(null, vAxisData.ticks).toFixed(0);
      
      var vAxis = { 
        ticks: vAxisData.ticks, // null for default
        title: vAxisData.title,
        minValue: minValue, 
        viewWindow: { min: minValue }
      };
      
      var vAxes = [];
      vAxes.push(vAxis); // only one vAxis (index 0)
      
      var chart = createChart(getChartType(typeName), dataSource, series, vAxes, width, height, chartTitle, extraOptions)
      return chart.getBlob();
    },
    createLineChart: function(columns, rows, vAxisData, width, height, chartTitle) {
      return this.createChartAsBlob('line', columns, rows, vAxisData, width, height, chartTitle);
    },
    createBarsChart: function(columns, rows, vAxisData, width, height, chartTitle) {
      return this.createChartAsBlob('column', columns, rows, vAxisData, width, height, chartTitle);
    },
    createAreaChart: function(columns, rows, vAxisData, width, height, chartTitle) {
      return this.createChartAsBlob('area', columns, rows, vAxisData, width, height, chartTitle);
    }, 
     createPieChart: function(columns, rows, vAxisData, width, height, chartTitle) {
      var extraOptions = [];
      
      var colors = [];   
      if(vAxisData && vAxisData.lines)
      {
        for (var i in vAxisData.lines)         
          colors.push(vAxisData.lines[i].color);
        extraOptions.push({ key:'colors', value: colors });
      }

      return this.createChartAsBlob('pie', columns, rows, vAxisData, width, height, chartTitle, extraOptions);
    }, 
    createStackChart: function(columns, rows, vAxisData, width, height, chartTitle) {
      var extraOptions = [];
      extraOptions.push({ key:'isStacked', value: 'true' });                  
      
      return this.createChartAsBlob('column', columns, rows, vAxisData, width, height, chartTitle, extraOptions);
    },        
    
    // --- DUAL-Y CHARTS AS BLOB ---
    createDualYChartsAsBlob: function(typeNameLeft, typeNameRight, columns /* [{ name, type }] */, rows /* [[value1,value2...valueN]] */, vAxisDataLeft /* { title, ticks, color, legend } */, vAxisDataRight, width, height, chartTitle) {
      
      // build the data source 
      var dataSource = Charts.newDataTable();
      
      for(var i = 0; i < columns.length; i++) { // add columns
        var column = columns[i];
        dataSource.addColumn(getColumnType(column.type), column.name);
      }
       
      for(var i = 0; i < rows.length; i++) // add rows
        dataSource.addRow(rows[i])
       
      dataSource.build();
       
      var series = [];
      series.push({ 
        color: vAxisDataLeft.color, 
        labelInLegend : vAxisDataLeft.legend,
        pointShape: 'square',
        pointSize: 4,
        type: typeNameLeft,
        targetAxisIndex: 0 // vAxis (index 0)
      });
      
      series.push({ 
        color: vAxisDataRight.color, 
        labelInLegend : vAxisDataRight.legend,
        pointShape: 'square',
        pointSize: 4,
        type: typeNameRight,
        targetAxisIndex: 1 // vAxis (index 1)
      });
      
      var minValueLeft = 0;
      if(vAxisDataLeft.ticks) // custom vAxis values      
        // set minimum value to be the minimum tick value
        minValueLeft = Math.min.apply(null, vAxisDataLeft.ticks).toFixed(0);
      
      var vAxisLeft = { 
        ticks: vAxisDataLeft.ticks, // null for default
        title: vAxisDataLeft.title,
        minValue: minValueLeft, 
        viewWindow: { min: minValueLeft }
      };
      
      var minValueRight = 0;
      if(vAxisDataRight.ticks) // custom vAxis values      
        // set minimum value to be the minimum tick value
        minValueRight = Math.min.apply(null, vAxisDataRight.ticks).toFixed(0);
      
      var vAxisRight = { 
        ticks: vAxisDataRight.ticks, // null for default
        title: vAxisDataRight.title,
        minValue: minValueRight, 
        viewWindow: { min: minValueRight }
      };
      
      var vAxes = [];
      vAxes.push(vAxisLeft); // vAxis (index 0)
      vAxes.push(vAxisRight); // vAxis (index 1)
      
      var chart = createChart(getChartType(typeNameLeft), dataSource, series, vAxes, width, height, chartTitle)
      return chart.getBlob();
    },
    createBarsLineChartDualY: function(columns, rows, vAxisDataLeft, vAxisDataRight, width, height, chartTitle){
      return this.createDualYChartsAsBlob('column', 'line', columns, rows, vAxisDataLeft, vAxisDataRight, width, height, chartTitle)
    },
    createLineChartChartDualY: function(columns, rows, vAxisDataLeft, vAxisDataRight, width, height, chartTitle){
      return this.createDualYChartsAsBlob('line', 'line', columns, rows, vAxisDataLeft, vAxisDataRight, width, height, chartTitle)
    },
    createBarsChartDualY: function(columns, rows, vAxisDataLeft, vAxisDataRight, width, height, chartTitle){
      return this.createDualYChartsAsBlob('column', 'column', columns, rows, vAxisDataLeft, vAxisDataRight, width, height, chartTitle)
    },
    createBarsScatterChartDualY: function(columns, rows, vAxisDataLeft, vAxisDataRight, width, height, chartTitle){
      return this.createDualYChartsAsBlob('column', 'scatter', columns, rows, vAxisDataLeft, vAxisDataRight, width, height, chartTitle)
    }, 
    createBarsAreaChartDualY: function(columns, rows, vAxisDataLeft, vAxisDataRight, width, height, chartTitle){
      return this.createDualYChartsAsBlob('column', 'area', columns, rows, vAxisDataLeft, vAxisDataRight, width, height, chartTitle)
    }
  }
}

/* DRIVE SERVICE */
var DriveService = function() {
  var createFile = function(fileName, mimeType){
      return DriveApp.createFile(fileName, '', mimeType);
  };
  
  return {
    rootFolder: DriveApp.getRootFolder(),
    setAsPublic: function(fileName){      
      var files = this.getFilesByName(fileName);      
      if(!files) return false;
      
      var file = files[0];
      file.setSharing(DriveApp.Access.ANYONE_WITH_LINK, DriveApp.Permission.VIEW);  
      return true;
    },
	setAsPublicById: function(fileId){      
      var file = this.getFileById(fileId);      
      if(!file) return false;

      file.setSharing(DriveApp.Access.ANYONE_WITH_LINK, DriveApp.Permission.VIEW);  
      return true;
    },   
    setStringContent: function(fileName, content){
      var files = this.getFilesByName(fileName);      
      if(!files) return null;
      
      var file = files[0];
      return file.setContent(content); 
    },
	getFileById: function(fileId){
      return DriveApp.getFileById(fileId);       
    },  
    getFilesByName: function(fileName){
      var fileIterator = DriveApp.getFilesByName(fileName);
      if(!fileIterator.hasNext()) return null;
      
      var files = [];
      while(fileIterator.hasNext())
        files.push(fileIterator.next());              
      return files;
    },
    getFileByName: function(fileName){
      var files = this.getFilesByName(fileName);
      if(!files) return null;
      return files[0];
    },
    getImage: function(imageName){
      var file = this.getFileByName(imageName); 
      if(!file) return null;
      return file.getAs(MimeType.PNG); 
    },
	getFilesByPrefix: function(filePrefix){
      var fileIterator = DriveApp.getFiles();
      if(!fileIterator.hasNext()) return null;
      
      var files = [];
      while(fileIterator.hasNext())
      {
        var file = fileIterator.next();
        if(file.getName().indexOf(filePrefix) != 0) continue;
        files.push(file);              
      }
      return files;
    },
    getFoldersByName: function(folderName){
      var folderIterator = this.rootFolder.getFoldersByName(folderName);
      if(!folderIterator.hasNext()) return null;
      
      var folders = [];
      while(folderIterator.hasNext())
        folders.push(folderIterator.next());              
      return folders;
    }, 
    getStringContent: function(fileName){
      var files = this.getFilesByName(fileName);      
      if(!files) return null;
      
      var file = files[0];
      return file.getBlob().getDataAsString();
    },    
    createTextFile: function(fileName, content){
      content = content || '';
      return createFile(fileName, content, MimeType.PLAIN_TEXT);
    },
    createFolder: function (folderName){
      return DriveApp.createFolder(folderName);
    },
    moveToFolder: function(fileName, destFolderName){ 
      var files = this.getFilesByName(fileName);      
      if(!files) return false;
      var file = files[0];
      
      var folders = this.getFoldersByName(destFolderName);
      if(!folders) return false;
      var folder = folders[0];
      
      folder.addFile(file);
      this.rootFolder.removeFile(file);      
      return true;
    }
  }
}

/* SPREADSHEET SERVICE */
var SpreadSheetService = function(spreadSheet) {
  var _spreadSheet = spreadSheet;
  var _sheets = [];

  (function(){
    var sheetServices = [];
    var temp_sheets = spreadSheet.getSheets();
    for(var i= 0; i < temp_sheets.length; i++)
      _sheets.push(new SheetService(temp_sheets[i]));   
  })();   
  
  return {      
    sheets: _sheets,
	spreadSheet: _spreadSheet, 
    getName: function(){
      return _spreadSheet.getName();
    },
    getActiveSheet: function(){
      return SheetService(_spreadSheet.getActiveSheet());
    },
    getSheetByName: function(sheetName) { 
         for(var i= 0; i < _sheets.length; i++)
            if(_sheets[i].sheetName == sheetName)
              return _sheets[i];
          return '';
    },
    addNewSheet: function(sheetName){
        var new_sheet = SheetService(_spreadSheet.insertSheet(sheetName));
        _sheets.push(new_sheet)
        return new_sheet;         
    },
    isSheetExists: function(sheetName){
        return this.getSheetByName(sheetName) != '';
    }, 
    getURL: function(){
      return _spreadSheet.getUrl();
    },
	getId: function(){
      return _spreadSheet.getId();
    },
    setName: function(newName){
      _spreadSheet.rename(newName);  
    }, 
	setActiveSheetByIndex: function(index){
      _spreadSheet.setActiveSheet(_sheets[index].sheet);
    },
    clearALL: function(){
      for(var i= 0; i < _sheets.length; i++)
        _sheets[i].clear(true, true, true);
    }
  }; 
}

--------------------

/* SHEET SERVICE */
var SheetService = function(sheet) { 
  var _sheet = sheet;
  
  // e.g: setFormat('A1'); // set cell
  // e.g: setFormat('A1:A10'); // set range
  var setFormat = function(strRange, format){
    var range = _sheet.getRange(strRange);
    range.setNumberFormat(format);  
  }
  
  var getBorderStyle = function(value){
    value = value.toLowerCase();
    switch(value){
      case 'dotted': return SpreadsheetApp.BorderStyle.DOTTED;
      case 'dashed': return SpreadsheetApp.BorderStyle.DASHED;
      default:
      case 'solid': return SpreadsheetApp.BorderStyle.SOLID;
    }
  }
  
  return {   
    sheet: _sheet,
    hasSheet: _sheet != null,
    sheetName: _sheet ? _sheet.getName() : '',
    spreadSheet: _sheet.getParent(),
    getLastRowIndex: function() { 
      return _sheet.getLastRow();  
    }, 
    getLastColumnIndex: function(){ 
      return _sheet.getLastColumn();
    }, 
    getValue: function(rowPosition, columnPosition){ 
      return _sheet.getRange(rowPosition, columnPosition).getValue();
    }, 
    getValueByRange: function(strRange){ /* A3, B1 etc.*/       
      return _sheet.getRange(strRange).getValue();
    },  
    getValues: function(){
      return _sheet.getDataRange().getValues();
    },
    getValuesByRange: function(strRange){ /* A3:B3, C1:C5 etc.*/       
      return _sheet.getRange(strRange).getValues();
    }, 
    getRowValues:function(rowPosition){       
      return _sheet.getRange(rowPosition, 1, 1, this.getLastColumnIndex()).getValues();
    },      
    getRowIndex: function(columnPosition, key){
      var rows = _sheet.getDataRange().getValues();
      
      // row index is 0 based but range is 1 based
      for(row in rows)
        if(rows[row][columnPosition - 1] == key)
          return parseInt(row) + 1;
      return -1;  
    },
    getRowIndexBy2Columns: function(columnAPosition, keyA, columnBPosition, keyB){ 
      var rows = _sheet.getDataRange().getValues();
      
      // row index is 0 based but range is 1 based
      for(row in rows)
        if(rows[row][columnAPosition - 1] == keyA && rows[row][columnBPosition - 1] == keyB)
          return parseInt(row) + 1;
      return -1;  
    },
      getColumnValues: function(startRowPosition, columnPosition){
        // getRange(row, column, numRows, numColumns)
        return _sheet.getRange(startRowPosition, columnPosition, _sheet.getLastRow() - 1, 1).getValues();
      }, 
      addRow: function(arrValues){ 
        //_sheet.appendRow(arrValues);
        this.addRowAtIndex(arrValues, _sheet.getLastRow() + 1);
      },
      addRowAtIndex: function(arrValues, rowPosition){               
        rowPosition = rowPosition || _sheet.getLastRow() + 1;
        var range = _sheet.getRange(rowPosition, 1, 1, arrValues.length);
        range.setValues([arrValues]);
      },
      addImageFromURL: function(url, rowPosition, columnPosition, left, top){ 
        top = top || 0;
        left = left || 0;
        
        _sheet.insertImage(url, rowPosition, columnPosition, left, top);
      },   
      addImage: function(blob, rowPosition, columnPosition, left, top){ 
        top = top || 0;
        left = left || 0;
        
        _sheet.insertImage(blob, rowPosition, columnPosition, left, top);
      },   
      deleteRow: function(rowPosition){
        _sheet.deleteRow(rowPosition);
      }, 
	  copyRange: function(fromRange, toRange){
        Logger.log('copy range from %s to %s', fromRange, toRange);
        var valuesToCopy = this.getValuesByRange(fromRange);      
        this.setRangeValues(toRange, valuesToCopy);           
      },   
      sort: function(columnPosition){
        _sheet.sort(columnPosition);
      },
      hasCharts:  _sheet.getCharts().length > 0,
      findColumnValuesByFilter: function(columnPosition, filterValue, filterColumnPosition){
        /* 
        get column values filtered by other column
        
        e.g: findColumnValuesByFilter(2, '100', 1)          
        all B column values that the value in A column equals to '100'
        */
        
        var result = [];       
        var rows = _sheet.getDataRange().getValues();
        
        for(row in rows)
          if(rows[row][filterColumnPosition - 1] == filterValue)
            result.push(rows[row][columnPosition]);
        return result;  
      }, 
	  freezeHeader: function(){
          _sheet.setFrozenRows(1);
      },
      merge: function(strRange){
        _sheet.getRange(strRange).merge();
      },  
      clear: function(charts, format, contents){
        charts = charts || false;
        format = format || false;
        contents = contents || true;
        
        _sheet.clear({ formatOnly: format, contentsOnly: contents });    
        
        // clear all notes
        _sheet.clearNotes();        
        
        // clear all charts
        var charts = _sheet.getCharts();
        for (var i in charts)
          _sheet.removeChart(charts[i]);
      },          
      setValue: function(rowPosition, columnPosition, value){ 
        _sheet.getRange(rowPosition, columnPosition).setValue(value);
      },     
      setRangeValue: function(strRange, value){ 
        // e.g: setCurrencyFormat('A1'); // set cell
        _sheet.getRange(strRange).setValue(value);
      },
	  setRangeValues: function(strRange, values){         
        _sheet.getRange(strRange).setValues(values);
      },
      setColumnWidth: function(columnPosition, width){
        _sheet.setColumnWidth(columnPosition, width);
      },  
      setRowHeight: function(rowPosition, height){
        _sheet.setRowHeight(rowPosition, height);
      },  
      setName: function(newName){
        _sheet.setName(newName);
      }, 
      setNote: function(strRange, note){
         var range = _sheet.getRange(strRange);
        range.setNote(note);
      },         
      setDataUI: function(strRange, backgroundColor, foreColor, fontSize, hAlign, fontWeight, border /* { color, style } */, vAlign){
        var range = _sheet.getRange(strRange);
        if(backgroundColor)
          range.setBackground(backgroundColor);
        if(foreColor)
          range.setFontColor(foreColor);
        if(fontSize)
          range.setFontSize(fontSize);
        if(hAlign)
          range.setHorizontalAlignment(hAlign);
        if(vAlign)
          range.setVerticalAlignment(vAlign)
          if(fontWeight)
            range.setFontWeight(fontWeight);
        if(border)
          range.setBorder(true, true, true, true, true, true, border.color, getBorderStyle(border.style))
      }, 
      setNumberFormat: function(strRange){
        setFormat(strRange, '0');       
      },
      setDecimalFormat: function(strRange){
        setFormat(strRange, '0.00');
      },
      setCurrencyFormat: function(strRange){
        setFormat(strRange, '$0.00');
      },
      setPercentageFormat: function(strRange){
        // e.g: setPercentageFormat('A1'); // set cell
        // e.g: setPercentageFormat('A1:A10'); // set range
        
        setFormat(strRange, '0.00%');
      },
      setWeekFormat: function(strRange){
        setFormat(strRange, 'MMM dd');
      },
      setMonthFormat: function(strRange){
        setFormat(strRange, 'MMM');
      },
      setCellSumFormula: function(strRange, strCell){
        // e.g: setCellSumFormula('A1:A10', 'B1'); 
        // set SUM value of cells A1 to A10 to cell B1
        
        var cell = _sheet.getRange(strCell);
        cell.setFormula('=SUM(' + strRange + ')');
      },
      setCellAvgFormula: function(strRange, strCell){
        // e.g: setCellSumFormula('A1:A10', 'B1'); 
        // set AVG value of cells A1 to A10 to cell B1
        
        var cell = _sheet.getRange(strCell);
        cell.setFormula('=AVERAGE(' + strRange + ')');
      },
      setCellFormula: function(formula, strCell){
        // e.g: setCellFormula('=B3-C3', 'D3');         
		// e.g: setCellFormula('=$B3-$C3', 'D3:D9');   
        
        var cell = _sheet.getRange(strCell);
        cell.setFormula(formula);
      }        
  }; 
}

--------------------

/* SPREADSHEET LOADER */
var SpreadsheetLoader = {
  
  // ---  spreadSheets
  
  createSpreadSheet: function(spreadSheetName, folderName){
    Logger.log('CREATING %s ... ', spreadSheetName);
    var spreadsheet = SpreadsheetApp.create(spreadSheetName); // create new file         
    
    if(!folderName || folderName == '') 
      return spreadsheet; // folder not specified  - return spreadsheet
     
    // save in specific folder 
    
    for(var i=0;i<500000; i++); // delay

    var root_folder = DriveApp.getRootFolder();     
    var folder_iterator = root_folder.getFoldersByName(folderName);
    var folderExists = folder_iterator.hasNext();
    
    if(!folderExists) // no such folder - return the spreadsheet
    {
      Logger.log('%s NOT EXISTS!', folderName);
      return spreadsheet;
    }
    
    var folder = root_folder.getFoldersByName(folderName).next();
    var file = root_folder.getFilesByName(spreadSheetName).next();
    folder.addFile(file);
    root_folder.removeFile(file);

    return SpreadsheetApp.openById(file.getId());    
  }, 
  loadSpreadSheet: function(spreadSheetName, folderName){
	if(spreadSheetName == '') {
      Logger.log('EMPTY NAME!');
      return null;
    }

    var root_folder = DriveApp.getRootFolder();
    var folder = root_folder; // default 
    if(folderName && folderName != '')
    {
      var folder_iterator = root_folder.getFoldersByName(folderName);
      var folderExists = folder_iterator.hasNext();
      
      if(folderExists)
      {
        Logger.log('FOLDER %s', folderName);
        folder = root_folder.getFoldersByName(folderName).next();
      }
    }
    
    var file_iterator = folder.getFilesByName(spreadSheetName);
    var fileExists = file_iterator.hasNext();
    
    if(!fileExists){
      Logger.log('%s NOT EXISTS!', spreadSheetName);
      return null;
    }
    
    // file exists - load it
    Logger.log('LOADING %s ... ', spreadSheetName);
    var file = file_iterator.next();
    return SpreadsheetApp.openById(file.getId());    
  }, 
  loadSpreadSheetById: function(spreadSheetId){
    if(spreadSheetId == '') {
      Logger.log('EMPTY ID!');
      return null;
    }
    
    var file = DriveApp.getFileById(spreadSheetId);
    if(!file || file.isTrashed()){
      Logger.log('%s NOT EXISTS!', spreadSheetId);
      return null;
    }
    
    // file exists - load it
    Logger.log('LOADING %s ... ', spreadSheetId);
    return SpreadsheetApp.openById(file.getId());    
  },  
  loadSpreadSheetByURL: function(spreadSheetUrl){
    if(spreadSheetUrl == '') {
      Logger.log('EMPTY URL!');
      return null;
    }
    
    Logger.log('LOADING %s ... ', spreadSheetUrl);
    var spreadSheet = SpreadsheetApp.openByUrl(spreadSheetUrl);    
    
    if(!spreadSheet){
      Logger.log('%s NOT EXISTS!', spreadSheetUrl);
      return null;
    }
    
    return spreadSheet;
  }, 
  
  // ---  sheet Services
  
  loadSheetService: function(spreadSheetName, folderName){
    var spreadsheet = this.loadSpreadSheet(spreadSheetName, folderName);
    if(!spreadsheet) return null;
    return SheetService(spreadsheet.getActiveSheet());
  }, 
  loadSheetServiceById: function(spreadSheetId){
    var spreadsheet = this.loadSpreadSheetById(spreadSheetId);
    if(!spreadsheet) return null;
    return SheetService(spreadsheet.getActiveSheet());
  },  
  loadSheetServiceByURL: function(spreadSheetUrl){
    var spreadsheet = this.loadSpreadSheetByURL(spreadSheetUrl);
    if(!spreadsheet) return null;
    return SheetService(spreadsheet.getActiveSheet());
  },  
  createSheetService: function(spreadSheetName, folderName){
    var spreadsheet = this.createSpreadSheet(spreadSheetName, folderName);
    if(!spreadsheet) return null;
    return SheetService(spreadsheet.getActiveSheet());
  },
  
  // ---  spreadSheet Services
  
  loadSpreadSheetService: function(spreadSheetName, folderName){
    var spreadsheet = this.loadSpreadSheet(spreadSheetName, folderName);
    if(!spreadsheet) return null;
    return SpreadSheetService(spreadsheet);
  },
  loadSpreadSheetServiceById: function(spreadSheetId){
    var spreadsheet = this.loadSpreadSheetById(spreadSheetId);
    if(!spreadsheet) return null;
    return SpreadSheetService(spreadsheet);
  },  
  loadSpreadSheetServiceByURL: function(spreadSheetUrl){
    var spreadsheet = this.loadSpreadSheetByURL(spreadSheetUrl);
    if(!spreadsheet) return null;
    return SheetService(spreadsheet);
  },  
  createSpreadSheetService: function(spreadSheetName, folderName){
    var spreadsheet = this.createSpreadSheet(spreadSheetName, folderName);
    if(!spreadsheet) return null;
    return SpreadSheetService(spreadsheet);
  }
}

--------------------

/* CLIENT DATA SERVICE */
var ClientDataService = function(spreadSheetService) { 
  var activeSheetService = spreadSheetService.getActiveSheet(); //spreadSheetService.getSheetByName('Active');
  
  return {  
    getRowsToBackup: function(){
      var values = [];
      var rows = activeSheetService.getValues().slice(1); // slice(1) - remove the header row
      var nowSignature = HELPER.dateSignature(new Date());
      
      for(row in rows){
        var date = new Date(rows[row][1]);
        var dateSignature = HELPER.dateSignature(date); // e.g: 201510
        
        if(dateSignature < nowSignature){
          values.push({
            rowId: rows[row][0], 
            date: date, 
            impressions: rows[row][2], 
            clicks: rows[row][3], 
            ctr: rows[row][4], 
            cpc: rows[row][5], 
            convertedClicks: rows[row][6], 
            clickConversionRate: rows[row][7], 
            cost: rows[row][8]
          }); // add to backup 
        }
      }
      
      return values; // as dataItems rows    
    },
    deleteRowsAfterBackup: function(dateSignature){
      var deleted = 0;     
      var rows = activeSheetService.getValues().slice(1); // slice(1) - remove the header row      
      var nowSignature = HELPER.dateSignature(new Date());
      
      for(row in rows){
        var date = new Date(rows[row][1]);
        var dateSignature = HELPER.dateSignature(date); // e.g: 201510
        
        if(dateSignature < nowSignature){
          var rowId = rows[row][0];
          var rowIndex = activeSheetService.getRowIndex(1, rowId);
          activeSheetService.deleteRow(rowIndex);
          deleted++;
        }
      }   
      
      return deleted;
    },
    createBackupSheetIfNotExists: function(sheetName) {
      if(!spreadSheetService.isSheetExists(sheetName))
      {
        spreadSheetService.addNewSheet(sheetName);
        addDataHeader(sheetName);
      }
    },    
    addDataHeader: function(sheetName){
      sheetName = sheetName || activeSheetService.sheetName;      
      Logger.log(sheetName);
      var sheetService = spreadSheetService.getSheetByName(sheetName);    
     
      sheetService.addRow(['rowId', 'date', 'impressions', 'clicks', 'ctr', 'cpc', 'convertedClicks', 'clickConversionRate', 'cost']);
    },
    addDataRow: function(dataRow, sheetName){      
      // dataRow: {rowId, date, impressions, clicks, ctr, cpc, convertedClicks, clickConversionRate, cost}      
      sheetName = sheetName || activeSheetService.sheetName;      
      var sheetService = spreadSheetService.getSheetByName(sheetName);    
      
      sheetService.addRow([
        dataRow.rowId, 
        dataRow.date, 
        dataRow.impressions, 
        dataRow.clicks, 
        dataRow.ctr, 
        dataRow.cpc, 
        dataRow.convertedClicks, 
        dataRow.clickConversionRate, 
        dataRow.cost
      ]);
    },
    getSheetURL: function(){
      return spreadSheetService.getURL();
    } 
  }   
}

--------------------

/* ACCOUNTS MANAGER SERVICE */
var AccountsManagerService = function(sheetService) { 
  return {  
    getAccountsIds: function(){
      var values = [];
      
      var range = sheetService.getColumnValues(2, 1);
      for(r in range)
        for(c in range[r]){
          if(range[r][c] == '') continue; // ignore empty values
          values.push(range[r][c]);
        }
      return values;
    },
    getClientName: function(accountId){
      var row_index = sheetService.getRowIndex(1, accountId);
      if(row_index == -1) return [];
      return sheetService.getValue(row_index, 2).split(',');
    },
    getAccountEmails: function(accountId){
      var row_index = sheetService.getRowIndex(1, accountId);
      if(row_index == -1) return [];
      return sheetService.getValue(row_index, 3).split(',');
    },
    getAccountSchedule: function(accountId){
      var row_index = sheetService.getRowIndex(1, accountId);
      if(row_index == -1) return 0;
      
      var value = sheetService.getValue(row_index, 4); // empty column value
      if(value == '') return 0;
      
      return parseInt(value);
    },
    getReportLastSendDate: function(accountId){
      var row_index = sheetService.getRowIndex(1, accountId);
      if(row_index == -1) return '';
      return sheetService.getValue(row_index, 5);
    },  
    getAccountSheetId: function(accountId){
      var row_index = sheetService.getRowIndex(1, accountId);
      if(row_index == -1) return '';
      return sheetService.getValue(row_index, 6);
    },  
    setReportLastSendDate: function(accountId, date){
      var row_index = sheetService.getRowIndex(1, accountId);
      if(row_index == -1) return;     
      sheetService.setValue(row_index, 5, date);
    },
    setAccountSheetId: function(accountId, sheetId){
      var row_index = sheetService.getRowIndex(1, accountId);
      if(row_index == -1) return;     
      sheetService.setValue(row_index, 6, sheetId);
    }        
  }
}

--------------------

/* BID CHANGES SERVICE */
var BidChangesService = function(sheetService) { 
  var _bidChangesHistorySheet = sheetService;
  var _changes = []; // { accountId, [items] }
  
  _changes.indexOf = function(accountId){    
    for(var i=0;i<this.length;i++)
      if(this[i].accountId == accountId)
        return i;
    return -1;        
  };
  
  return {  
    hasChanges: function() { return _changes.length > 0 },
    addData: function(accountId, data){
      var accountIndex = _changes.indexOf(accountId);
   
      if(accountIndex == -1)
      {      
        _changes.push({ accountId: accountId, items: [] });      
        accountIndex = _changes.length - 1; // update the key index 
      }
      
      _changes[accountIndex].items.push(data);   
    }, 
    getAccountData: function(accountId){
      var accountIndex = _changes.indexOf(accountId);
      return _changes[accountIndex];
    }, 
    getAllData: function(){
      return _changes;
    },
    countAccountData: function(accountId){
      var accountIndex = _changes.indexOf(accountId);
      return _changes[accountIndex].items.length;
    }, 
    countAllData: function(){
      var counter = 0;
      
      HELPER.foreach(_changes, function(changesGroup){
        counter += changesGroup.items.length;
      });

      return counter;
    }, 
    toHTML: function(){
      var result = '';
      
      HELPER.foreach(_changes, function(changesGroup){
        result += '<h3>' + changesGroup.accountId + ' ' + '(' + changesGroup.items.length + ')' + '</h3>'
        
        HELPER.foreach(changesGroup.items, function(item){
          result += '<p style="font-size:11px;">' + item + '</p>'
        });
      });

      return result;
    }, 
    addToHistorySheet: function(){
      var date = new Date();
      HELPER.foreach(_changes, function(changesGroup){
        _bidChangesHistorySheet.addRow([date, changesGroup.accountId, changesGroup.items.length]);
      });  
    },
    addHistorySheetHeader: function(){
      _bidChangesHistorySheet.addRow(['date', 'account', 'changes']);
    }
  };
}

--------------------

/* ACCOUNT IMPRESSIONS SERVICE */
var AccountImpressionsService = function(sheetService) {
  var _sheetService = sheetService;
  
  return {
    getAccountData: function(accountId){
      var row_index = _sheetService.getRowIndex(1, accountId);
      if(row_index == -1) return null;
      
      var row = _sheetService.getRowValues(row_index);
      return { date: new Date(row[1]), impressions: parseInt(row[2]) };
    },
    addAccountData: function(accountId, impressions){
      _sheetService.addRow([accountId, new Date(), impressions]);
    },
    updateAccountData: function(accountId, impressions){
      var row_index = _sheetService.getRowIndex(1, accountId);
      _sheetService.setValue(row_index, 2, new Date());
      _sheetService.setValue(row_index, 3, impressions);
    }
  };
}

--------------------

/* MOST EXPENSIVE KEYWORD SERVICE */
var MostExpensiveKeywordService = function(sheetService) { 
  return {      
    getAdGroups: function(){
      var values = [];
      
      var range = sheetService.getColumnValues(2, 6);
      for(r in range)
        for(c in range[r]){
          if(range[r][c] == '') continue; // ignore empty values
          if(values.indexOf(range[r][c]) > -1) continue; // ignore duplicates
          values.push(range[r][c]);
        }

      return values;
      // return values.slice(1, 2);      
    },
    getAdGroupKeywods: function(adGroupName){
      var keywords = [];
      // index 5 - adGroupName column
      // index 9 - keywordName column
      // index 14 - suggestedBid column      
      var sheetValues = sheetService.getValues();
      for(r in sheetValues){        
        if(r == 0) continue; // skip the header
        if(sheetValues[r][5] == '' || sheetValues[r][9] == '') continue; // ignore empty values        
        if(sheetValues[r][5] != adGroupName) continue; // filter by adGroupName    
        if(keywords.indexOf(sheetValues[r][9]) > -1) continue; // ignore duplicates
        
        keywords.push({ text: sheetValues[r][9], bid: sheetValues[r][14]});
      }
      
      return keywords;
    },
    getCampaignName: function(){      
      return sheetService.getValue(2, 1);
    },
    findMostExpensiveKeyword: function(arrKeywords){
      // order list by bid value desc
      arrKeywords.sort(function(a, b) { return b.bid - a.bid; });
      return arrKeywords[0].text;
    },
    findMostExpensiveKeywordByLengthLimitation: function(arrKeywords, maxLength){
      // order list by bid value desc
      arrKeywords.sort(function(a, b) { return b.bid - a.bid; });
      
      for(var i=0;i<arrKeywords.length;i++)
        if(arrKeywords[i].text.length <= maxLength)
          return arrKeywords[i].text;
      return null;
    }    
  }
}

--------------------

/* HTML BUILDER SERVICE */
var HTMLBuilderService = function(){
  var _html = '';
  
  return {
    add: function(content){
      _html += content;
    },
    get: function(){
      return _html;
    },
    toPDF: function(pdfName){          
      var blob = Utilities.newBlob(_html, MimeType.HTML);
      var pdf = blob.getAs(MimeType.PDF);  
      pdf.setName(pdfName);
      return pdf;
    }  
  };
}

--------------------

// AD MANAGER SERVICE
var AdManagerService = function() { 
  return{
    createAdGroup: function(campaign, adGroupName, defaultBid){
      var adGroupBuilder = campaign.newAdGroupBuilder();
      var operation = adGroupBuilder
      .withName(adGroupName)
      .withCpc(defaultBid)
      // .withStatus('ENABLED')
      .build();
      
      if(!operation.isSuccessful())
        return null;
      return operation.getResult();
    },
    // createAd: function(adGroup, header1, header2, description, destinationURL, pathURL1, pathURL2)
    createAd: function(adGroup, header1, header2, header3, description1, description2, destinationURL, pathURL1, pathURL2){     
      if(header1.length > 30)
        header1 = header1.substr(0, 29);
      if(header2.length > 30)
        header2 = header2.substr(0, 29);
      if(description1.length > 90)
        description1 = description1.substr(0, 89);
     
      var builder = adGroup.newAd().expandedTextAdBuilder()
      .withHeadlinePart1(header1) // 30 characters      
      .withHeadlinePart2(header2) // 30 characters
      .withDescription1(description1) // 90 characters      
      .withFinalUrl(destinationURL) // 255 characters    
      .withMobileFinalUrl(destinationURL);
      
      /* parameters:
      
         syntax:
         {param<num>:<default value>}
         
         e.g: 
         product {param1: 'some product'} for only {param2: 0} $ - buy now!
      */

      if(pathURL1 && pathURL1.length <= 15)     
        builder.withPath1(pathURL1); // 15 characters (the first part after the siteURL) e.g: http://mydomain.com/pathURL1/pathURL2      
      
      if(pathURL2 && pathURL2.length <= 15)
        builder.withPath2(pathURL2); // 15 characters (the second part after the siteURL)

      if(header3){
      	if(header3.length > 30)
        	header3 = header3.substr(0, 29);
        
        builder.withHeadlinePart3(header3) // 30 characters
      }
      
      if(description2){
      	if(description2.length > 90)
        description2 = description2.substr(0, 89);
        
        builder.withDescription2(description2) // 90 characters  
      }
      
      var operation = builder.build();
      
      if(!operation.isSuccessful())
        return null;
      return operation.getResult();
    },
        
    createKeywords: function(adGroup, arrKeywods){
      // arrKeywods: [string]
      // match type: see 'Match Types'      
      for(i in arrKeywods){
        var keyword = arrKeywods[i];                                
        var operation = adGroup.newKeywordBuilder()        
        .withText(keyword)       
        // .withCpc(1.0)
        .build();        
      }
    },
    createNegativeKeywords: function(adGroup, arrKeywods){
      for(i in arrKeywods){
        var keyword = arrKeywods[i];
        adGroup.createNegativeKeyword(keyword);
      }
    },   
    
    createSiteLink: function(text, url){   
      var operation = AdWordsApp.extensions().newSitelinkBuilder()
        .withLinkText(text)
        .withFinalUrl(url)
        .build();

      if(!operation.isSuccessful())
        return null;
      return operation.getResult();
    },

    /*
	   important! 
	   use it before you add your match type signs! (calling the createKeywords method)
	   in order to prevent a deletion of those legitimate chars which add to represent the keyword match type ("keyword", [keyword], +keyword)

       Logger.log(adManagerService.clearKeyword('A!@%,*B'));
       Logger.log(adManagerService.clearKeyword('12%34'));
       Logger.log(adManagerService.clearKeyword('A B C D E F G H I J K L M N O P'));
       Logger.log(adManagerService.clearKeyword('A B C D E F G H I J K    L M N      O       P', true));
    */
    clearKeyword: function(keyword, clearSpacers){      
      // --- [validation] special characters ------//
      keyword = this.clearSpecialCharacters(keyword);      
      
      // --- [validation] words quantity ----------//
      var maxWordsAllowed = 10;
      
      // two many words
      // [error] Keywords cannot contain more than 10 words
      if(keyword.split(' ').length > maxWordsAllowed)
        keyword = keyword.split(' ').slice(0, 9).join(' '); // remove words
        
      // --- clear spacers -----------------------//
      if(clearSpacers == true)
        keyword = this.clearKeywordSpacers(keyword);
      
      return keyword;
    },
    clearSpecialCharacters: function(input){
      /* OLD VERSION
        var specialCharacters = ['!','@','%',',','*','(',')','.','&quot;','&','`',';','\'','-','"','+','[',']', '|', '>', '/'];

        // non allowed characters
        // [error] Keywords cannot contain non-standard characters like: ! @ % , *
        for(i in specialCharacters)
        {
          var c = specialCharacters[i];
          if(keyword.indexOf(c) == -1) continue;
          keyword = keyword.split(c).join(''); // replace all
        } 
      */   
      
      // any letter in the ASCII range 
      // \u0080-\uFFFF
      var specialCharactersPattern = /[^\.,&\/\-_'!\?\w\d\s{}:\u0080-\uFFFF]+/g;      
      return input.replace(specialCharactersPattern, ' ');
    },
    clearKeywordSpacers : function (input){
		var arrWords = input.split(' ');
		if(arrWords.length == 1) {
		// Logger.log('single word: /%s/', input);
		return input;
		}

		// clear extra middle spaces ('A B C' -> 'A B C')
		var temp = [];
		for(i in arrWords){ 
		var word = arrWords[i].trim();
		if(word == '' || word.length == 1) continue; 
		// Logger.log('word: /%s/', word);
		temp.push(word); 
		} 

		var output = temp.join(' ');
		// Logger.log('input: /%s/', input);
		// Logger.log('output: /%s/', output);
		return output; 
	},
    setKeywordParams: function(keyword, param1Value, param2Value, param3Value){      
      if(param1Value)
        keyword.setAdParam(1, param1Value);
      
      if(param2Value)
        keyword.setAdParam(2, param2Value);
      
      if(param3Value)
        keyword.setAdParam(3, param3Value);
    },
    getAds: function(campaign){
      var ads = [];
      
      var adsIter = campaign.ads()
      .withCondition('Type = EXPANDED_TEXT_AD')
      .withCondition('Status IN [ENABLED,PAUSED]')
      .get();
      
      while(adsIter.hasNext())      
        ads.push(adsIter.next().asType().expandedTextAd());
      
      return ads;      
    },  
    getAdsByAdgroup: function(adgroup){
      var ads = [];
      
      var adsIter = adgroup.ads()      
      .withCondition('Type = EXPANDED_TEXT_AD')
      .withCondition('Status IN [ENABLED]')
      .get();
      
      while(adsIter.hasNext())      
        ads.push(adsIter.next().asType().expandedTextAd());
      
      return ads;      
    },  
    checkIfAdExistsByTitle: function(campaign, adTitle){
      var ads = this.getAds(campaign);
      for(i in ads)
        if(ads[i].getHeadlinePart1() == adTitle)
          return true;
      return false;
    },
    checkIfAdGroupExistsByName: function(campaign, adGroupName){
      return this.getAdGroupByName(campaign, adGroupName) != null;
    },
    getAdGroupByName: function(campaign, adGroupName){
      adGroupName = adGroupName.toLowerCase();
      
      var adgroups = campaign.adGroups()
      .withCondition('Status IN [ENABLED,PAUSED]')
      .withCondition('Name STARTS_WITH_IGNORE_CASE "' + adGroupName + '"')
      .get()
      
      while(adgroups.hasNext())
      { 
        var adgroup = adgroups.next();
        if(adgroup.getName().toLowerCase() == adGroupName)
          return adgroup;
      }
      return null;
    },
    getAdGroupById: function(adGroupId){            
      var adgroup = AdWordsApp.adGroups()
      .withCondition('Status IN [ENABLED,PAUSED]')
      .withIds([adGroupId])
      .get()
      
      if(adgroup.hasNext())
        return adgroup.next();
      return null;
    },
    getCampaignById: function(campaignId){            
      var campaign = AdWordsApp.campaigns()
      .withCondition('Status IN [ENABLED,PAUSED]')
      .withIds([campaignId])
      .get()
      
      if(campaign.hasNext())
        return campaign.next();
      return null;
    },
    getKeywordParams: function(keyword){
      // [{index, text}]
      var result = [];
      
      var adParams = keyword.adParams().get();
      while (adParams.hasNext()) {
        var adParam = adParams.next();
        result.push({ 
          index: adParam.getIndex(),
          text: adParam.getInsertionText()
      	});
      }
      
      return result;
    },
    checkIfKeywordExists: function(campaign, keywordText){
      return campaign.keywords()
      .withCondition('Text = \'' + keywordText + '\'')
      .get()
      .hasNext();
    },
    checkIfKeywordExistsInAdGroup: function(adgroup, keywordText){
      return adgroup.keywords()
      .withCondition('Text = \'' + keywordText + '\'')
      .get()
      .hasNext();
    },
  };
}

--------------------

/* KARAOKE-4-FREE SERVICE */
var Karaoke4freeService = function(xService, adManagerService){
  var _xService = xService;
  var _adManagerService = adManagerService;
  
  (function(){ })();
  
  return {
    checkIfAdGroupExists: function(campaign, songInfo){   
      var songWithSinger = songInfo.songName.concat(' ', songInfo.singer);
      var adGroupName = songWithSinger;
      
      return _adManagerService.getAdGroupByName(campaign, adGroupName);
    },    
    getSongsURLs: function(){
      var urlNodes = _xService.getNodes('url');
      var locNodesFiltered = _xService.filter(urlNodes, 'loc', '^http:\/\/www\.karaoke4free.com\/singers\/[^\/<]+\/[^\/<]+\/[^\/<]+$');
      return locNodesFiltered;
    }, 
    
    // songInfo { singer, songName, songURL, price }
    getSongInfo: function(songURL){      
      try{      
        var response = UrlFetchApp.fetch(songURL);
        var statusCode = response.getResponseCode();
        
        if(statusCode != 200) // 200 = OK
        {
          Logger.log('status code %s', statusCode);
          return null;
        }
        
        var input = response.getContentText();      
        var pattern, regex;
        
        /*
        <h1 class="product-name">
        <a href="http://www.karaoke4free.com/singers/someSinger" title="">bla bla</a>&nbsp;|&nbsp;someSong				
        </h1>
        <p itemprop="price" content="48">48 </p>
        <p itemprop="price" content="32">32 </p>
        */      

        pattern = '<h1\\s+class="product-name">\\s*<a .*?>(.*?)</a>&nbsp;\\|&nbsp;(.*?)\\s*</h1>';      
        regex = new RegExp(pattern, 'i'); // i = ignoreCase
        var matchA = regex.exec(input);
        //Logger.log('%s %s', matchA[1], matchA[2]);
        
        if(!matchA)
          return null;
        
        pattern = '<p\\s+itemprop="price"\\s+content="(\\d+)">.*?</p>';      
        regex = new RegExp(pattern, 'gim'); // m = multilines, g = global
        
        var prices = [];        
        while ((match = regex.exec(input)) != null) {
          prices.push(match[1]);
        }
        // Logger.log('%s', prices);      
        
        var price = 0;
        if(prices.length > 0){
          prices.sort(); // sort the array by price
          price = prices[0]; // take the lower price
        }
        
        return { singer: matchA[1], songName: matchA[2], songURL: songURL, price: price  };
      }
      catch(e){
        return null;
      }
    },
    createSongProduct: function(campaign, songInfo){
      Logger.log('create song');

	  // clear keywords
      var songName = _adManagerService.clearKeyword(songInfo.songName);
	  var singer = _adManagerService.clearKeyword(songInfo.singer);

      var songWithSinger = songName.concat(' ', singer);
      var adGroupName = songWithSinger;
            
      var adGroup = _adManagerService.createAdGroup(campaign, adGroupName, 1.0);
      if(!adGroup)
      {
        Logger.log('adGroup is NULL!');
        return;
      }
      
      var prmPrice = ' ' + '{param1:' + songInfo.price + '}' + ' ' ;
      var adTitleMaxLength = 30;
      var adTitle = ' ' + songName;             
      var adTitle2 = singer;       
      var adDescription = '  !      ';
      
      var priceInheader = (adTitle2.length + prmPrice.length + 1/*spacer*/) < adTitleMaxLength;
           
      if(priceInheader)
        adTitle2 = adTitle2 + ' ' + prmPrice;
      else 
        adDescription = prmPrice + ' ' + adDescription;
        
      _adManagerService.createAd(adGroup, adTitle, adTitle2, adDescription, songInfo.songURL);    
      _adManagerService.createKeywords(adGroup, [ 
        '[ ' + songName + ']', 
        '[ ' + songName + '  ' + singer + ']', 
        '+' + '' + '+' + songName,
        '+' + '' + '+' + songName + '+' + singer,
      ]); 

      _adManagerService.createNegativeKeywords(adGroup, ['']);   
    },
    updateSongProduct: function(adgroup, songInfo){
      Logger.log('update song');
      
      var keywords = adgroup.keywords().get();
      while(keywords.hasNext())
        _adManagerService.setKeywordParams(keywords.next(), songInfo.price);
    },
    saveSongProduct: function(campaign, songInfo){
      var adgroup = this.checkIfAdGroupExists(campaign, songInfo);      
      if(adgroup) // update
        this.updateSongProduct(adgroup, songInfo);
      else // create
        this.createSongProduct(campaign, songInfo);
    }
  };
}

--------------------

/* SHOP SERVICE */

/*
<PRODUCT NUM="1">
    <PRODUCT_URL>
        <![CDATA[ http://avc.co.il/-7-2--ONKYO-TXNR646.html?___SID=U ]]>
    </PRODUCT_URL>
    <PRODUCT_NAME>
        <![CDATA[  7.2  ONKYO TXNR646 ]]>
    </PRODUCT_NAME>
    <MODEL>
        <![CDATA[ ]]>
    </MODEL>
    <DETAILS>
        <![CDATA[
          Lorem Ipsum is simply dummy text of the printing and typesetting industry..
        ]]>
    </DETAILS>
    <CATALOG_NUMBER>
        <![CDATA[ 1831583028 ]]>
    </CATALOG_NUMBER>
    <PRICE>3190.00</PRICE>
    <CURRENCY>ILS</CURRENCY>
    <SHIPMENT_COST>30</SHIPMENT_COST>
    <DELIVERY_TIME>7</DELIVERY_TIME>
    <MANUFACTURER>
        <![CDATA[ ]]>
    </MANUFACTURER>
    <WARRANTY/>
    <IMAGE>
        http://avc.co.il/media/catalog/product/cache/1/small_image/135x135/9df78eab33525d08d6e5fb8d27136e95/_/o/_onkyo_txnr646_1.jpg
    </IMAGE>
    <TAX>0%</TAX>
</PRODUCT>  
*/

var ShopService = function(xService, adManagerService){
  var _xService = xService;
  var _adManagerService = adManagerService;
  
  (function(){ })();
  
  return {   
    getProducts: function(){      
      var productsRoot = _xService.getNode('PRODUCTS');
      var productNodes = _xService.getNodes('PRODUCT', productsRoot);
      
      var products = [];      
      for(i in productNodes)
      {
        var productNode = productNodes[i];
        products.push({ 
          id: _xService.getNodeAttributeValue('NUM', productNode),
          name: _xService.getNodeValue('PRODUCT_NAME', productNode),
          url: _xService.getNodeValue('PRODUCT_URL', productNode),
          model: _xService.getNodeValue('MODEL', productNode),
          price: _xService.getNodeValue('PRICE', productNode),          
        });        
      }
      
      return products;
    },         
    createProduct: function(campaign, product){
      Logger.log('create product');
            
      var adGroupName = 'product-' + product.id;            
      var adGroup = _adManagerService.createAdGroup(campaign, adGroupName, Settings.defaultBid);
      if(!adGroup)
      {
        Logger.log('adGroup is NULL!');
        return;
      }
      
      // clear keywords
      var productName = _adManagerService.clearKeyword(product.name);
      
      var adTitle = productName;             
      var adTitle2 = ' ' + '{param1:' + product.price + '}' + ' ';       
      var adDescription = Settings.adDescription;
      
      _adManagerService.createAd(adGroup, adTitle, adTitle2, adDescription, product.url);    
      
      // set basic keywords (product name)
      var keywords = [
        '"' + productName + '"', 
      ];
      
      // add he/en splitted keywords
      var productNameEN = productName.replace(/[^a-zA-Z0-9\s]/gi, '').trim();
      var productNameHE = productName.replace(/[a-zA-Z0-9]/gi, '').trim();      
      
      // clear extra middle spaces ('A    B C' -> 'A B C')
      var tempEN = productNameEN.split(' ');
      var arrProductNameEN = [];
      for(i in tempEN){
        if(tempEN[i].trim() == '') continue;
        arrProductNameEN.push(tempEN[i].trim());      
      }    
           
      if(TEST_MODE)
        Logger.log('item: %s, length: %s', productNameEN, arrProductNameEN.length);
      
      if(arrProductNameEN.length > 1)
      {
        productNameEN = arrProductNameEN.join(' ');
        
        keywords = keywords.concat([
          '[' + productNameEN + ']', 
          '"' + productNameEN + '"', 
          '+' + productNameEN.split(' ').join('+')       
        ]);
      }       
      
      // clear extra middle spaces ('A    B C' -> 'A B C')
      var tempHE = productNameHE.split(' ');
      var arrProductNameHE = [];
        for(i in tempHE){
          if(tempHE[i].trim() == '') continue;
          arrProductNameHE.push(tempHE[i].trim());      
        }   
      
      if(TEST_MODE)
        Logger.log('item: %s, length: %s', productNameHE, arrProductNameHE.length);
      
      if(arrProductNameHE.length > 1)
      {   
        productNameHE = arrProductNameHE.join(' ');
        
        keywords = keywords.concat([
          '[' + productNameHE + ']', 
          '"' + productNameHE + '"',
          '+' + productNameHE.split(' ').join('+')        
        ]);
      }    
      
      // add model keywords
      if(product.model && product.model != '')
      {
        keywords = keywords.concat([
          product.model,
          '[' + productNameEN + ' ' + product.model + ']', 
          '"' + productNameEN + ' ' + product.model + '"', 
          '+' + productNameEN + '+' + product.model,       
          '[' + productNameHE + ' ' + product.model + ']', 
          '"' + productNameHE + ' ' + product.model + '"', 
          '+' + productNameHE + '+' + product.model,             
        ]);
      }
   
      // add extra (custom) keywords
      if(Settings.extraKeywords.length > 0)
        keywords = keywords.concat(Settings.extraKeywords);
      
      if(TEST_MODE)
        Logger.log(keywords);
      
      _adManagerService.createKeywords(adGroup, keywords); 

      var negativeKeywords = [''];
      
      // add extra (custom) negative keywords
      if(Settings.extraKeywords.length > 0)
        negativeKeywords = negativeKeywords.concat(Settings.extraNegativeKeywords);
      
      _adManagerService.createNegativeKeywords(adGroup, negativeKeywords);   
    },
    updateProduct: function(adgroup, product){
      Logger.log('update product');
      
      var keywords = adgroup.keywords().get();
      while(keywords.hasNext())
        _adManagerService.setKeywordParams(keywords.next(), product.price);
    },
    saveProduct: function(campaign, product){
      
      var adGroupName = 'product-' + product.id;  
      var adgroup = _adManagerService.getAdGroupByName(campaign, adGroupName);
      
      if(adgroup) // update
        this.updateProduct(adgroup, product);
      else // create
        this.createProduct(campaign, product);            
    }
  };
}

--------------------

/* INDIEBOOK READER SERVICE */
var IndiebookReaderService = function(csvService) { 
  var _csvService = null;  
  var _metrics = null;
  
  function getMetrics(){
    var rows = [];
    
    for(i in _csvService.document){
      var row = _csvService.document[i];
      if(row[0].length == 1) 
        continue;      
      rows.push(row);
    }
    return rows;
  };
  
  (function(){
     _csvService = csvService; 
    _metrics = getMetrics();    
  })();  
  
  return {      
     countRows: function(){       
       return _metrics.length;                
     },      
     getTitles: function(){
       return _metrics.slice(1).map(function(row){ 
         return row[1]; 
       });
     }
   }; 
}